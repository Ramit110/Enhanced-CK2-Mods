var qq=qq||{},qq=function(a){return{hide:function(){a.style.display="none";return this},attach:function(b,f){a.addEventListener?a.addEventListener(b,f,!1):a.attachEvent&&a.attachEvent("on"+b,f);return function(){qq(a).detach(b,f)}},detach:function(b,f){a.removeEventListener?a.removeEventListener(b,f,!1):a.attachEvent&&a.detachEvent("on"+b,f);return this},contains:function(b){return a==b?!0:a.contains?a.contains(b):!!(b.compareDocumentPosition(a)&8)},insertBefore:function(b){b.parentNode.insertBefore(a,
b);return this},remove:function(){a.parentNode.removeChild(a);return this},css:function(b){null!=b.opacity&&("string"!=typeof a.style.opacity&&"undefined"!=typeof a.filters)&&(b.filter="alpha(opacity="+Math.round(100*b.opacity)+")");qq.extend(a.style,b);return this},hasClass:function(b){return RegExp("(^| )"+b+"( |$)").test(a.className)},addClass:function(b){qq(a).hasClass(b)||(a.className+=" "+b);return this},removeClass:function(b){a.className=a.className.replace(RegExp("(^| )"+b+"( |$)")," ").replace(/^\s+|\s+$/g,
"");return this},getByClass:function(b){if(a.querySelectorAll)return a.querySelectorAll("."+b);for(var f=[],c=a.getElementsByTagName("*"),g=c.length,h=0;h<g;h++)qq(c[h]).hasClass(b)&&f.push(c[h]);return f},children:function(){for(var b=[],f=a.firstChild;f;)1==f.nodeType&&b.push(f),f=f.nextSibling;return b},setText:function(b){a.innerText=b;a.textContent=b;return this},clearText:function(){return qq(a).setText("")}}};
qq.log=function(a,b){if(window.console)if(!b||"info"===b)window.console.log(a);else if(window.console[b])window.console[b](a);else window.console.log("<"+b+"> "+a)};qq.isObject=function(a){return null!==a&&a&&"object"===typeof a&&a.constructor===Object};qq.extend=function(a,b,f){for(var c in b)b.hasOwnProperty(c)&&(f&&qq.isObject(b[c])?(void 0===a[c]&&(a[c]={}),qq.extend(a[c],b[c],!0)):a[c]=b[c])};
qq.indexOf=function(a,b,f){if(a.indexOf)return a.indexOf(b,f);f=f||0;var c=a.length;for(0>f&&(f+=c);f<c;f++)if(f in a&&a[f]===b)return f;return-1};qq.getUniqueId=function(){var a=0;return function(){return a++}}();qq.ie=function(){return-1!=navigator.userAgent.indexOf("MSIE")};qq.ie10=function(){return-1!=navigator.userAgent.indexOf("MSIE 10")};qq.safari=function(){return void 0!=navigator.vendor&&-1!=navigator.vendor.indexOf("Apple")};qq.chrome=function(){return void 0!=navigator.vendor&&-1!=navigator.vendor.indexOf("Google")};
qq.firefox=function(){return-1!=navigator.userAgent.indexOf("Mozilla")&&void 0!=navigator.vendor&&""==navigator.vendor};qq.windows=function(){return"Win32"==navigator.platform};qq.preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1};qq.toElement=function(){var a=document.createElement("div");return function(b){a.innerHTML=b;b=a.firstChild;a.removeChild(b);return b}}();
qq.obj2url=function(a,b,f){var c=[],g="&",h=function(a,f){var d=b?/\[\]$/.test(b)?b:b+"["+f+"]":f;"undefined"!=d&&"undefined"!=f&&c.push("object"===typeof a?qq.obj2url(a,d,!0):"[object Function]"===Object.prototype.toString.call(a)?encodeURIComponent(d)+"="+encodeURIComponent(a()):encodeURIComponent(d)+"="+encodeURIComponent(a))};if(!f&&b)g=/\?/.test(b)?/\?$/.test(b)?"":"&":"?",c.push(b),c.push(qq.obj2url(a));else if("[object Array]"===Object.prototype.toString.call(a)&&"undefined"!=typeof a){var d=
0;for(f=a.length;d<f;++d)h(a[d],d)}else if("undefined"!=typeof a&&null!==a&&"object"===typeof a)for(d in a)h(a[d],d);else c.push(encodeURIComponent(b)+"="+encodeURIComponent(a));return b?c.join(g):c.join(g).replace(/^&/,"").replace(/%20/g,"+")};qq.DisposeSupport={_disposers:[],dispose:function(){for(var a;a=this._disposers.shift();)a()},addDisposer:function(a){this._disposers.push(a)},_attach:function(){this.addDisposer(qq(arguments[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))}};
qq.UploadButton=function(a){this._options={element:null,multiple:!1,acceptFiles:null,name:"file",onChange:function(a){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,a);qq.extend(this,qq.DisposeSupport);this._element=this._options.element;qq(this._element).css({position:"relative",overflow:"hidden",direction:"ltr"});this._input=this._createInput()};
qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){this._input.parentNode&&qq(this._input).remove();qq(this._element).removeClass(this._options.focusClass);this._input=this._createInput()},_createInput:function(){var a=document.createElement("input");this._options.multiple&&a.setAttribute("multiple","multiple");this._options.acceptFiles&&a.setAttribute("accept",this._options.acceptFiles);a.setAttribute("type","file");a.setAttribute("name",this._options.name);qq(a).css({position:"absolute",
right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0});this._element.appendChild(a);var b=this;this._attach(a,"change",function(){b._options.onChange(a)});this._attach(a,"mouseover",function(){qq(b._element).addClass(b._options.hoverClass)});this._attach(a,"mouseout",function(){qq(b._element).removeClass(b._options.hoverClass)});this._attach(a,"focus",function(){qq(b._element).addClass(b._options.focusClass)});this._attach(a,"blur",function(){qq(b._element).removeClass(b._options.focusClass)});
window.attachEvent&&a.setAttribute("tabIndex","-1");return a}};
qq.FineUploaderBasic=function(a){this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{endpoint:"/server/upload",params:{},customHeaders:{},forceMultipart:!1,inputName:"qqfile"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,stopOnFirstInvalidFile:!0},callbacks:{onSubmit:function(a,f){},onComplete:function(a,f,c){},onCancel:function(a,f){},onUpload:function(a,f,c){},onProgress:function(a,f,c,g){},onError:function(a,f,c){},
onAutoRetry:function(a,f,c){},onManualRetry:function(a,f){},onValidate:function(a){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},
retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"}};qq.extend(this._options,a,!0);this._wrapCallbacks();qq.extend(this,qq.DisposeSupport);this._filesInProgress=0;this._storedFileIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._handler=this._createUploadHandler();this._options.button&&(this._button=this._createUploadButton(this._options.button));this._preventLeaveInProgress()};
qq.FineUploaderBasic.prototype={log:function(a,b){this._options.debug&&(!b||"info"===b)?qq.log("[FineUploader] "+a):b&&"info"!==b&&qq.log("[FineUploader] "+a,b)},setParams:function(a){this._options.request.params=a},getInProgress:function(){return this._filesInProgress},uploadStoredFiles:function(){for(;this._storedFileIds.length;)this._filesInProgress++,this._handler.upload(this._storedFileIds.shift(),this._options.request.params)},clearStoredFiles:function(){this._storedFileIds=[]},retry:function(a){return this._onBeforeManualRetry(a)?
(this._handler.retry(a),!0):!1},cancel:function(a){this._handler.cancel(a)},reset:function(){this.log("Resetting uploader...");this._handler.reset();this._filesInProgress=0;this._storedFileIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._button.reset()},_createUploadButton:function(a){var b=this,f=new qq.UploadButton({element:a,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),acceptFiles:this._options.validation.acceptFiles,onChange:function(a){b._onInputChange(a)}});
this.addDisposer(function(){f.dispose()});return f},_createUploadHandler:function(){var a=this,b;b=qq.UploadHandlerXhr.isSupported()?"UploadHandlerXhr":"UploadHandlerForm";return new qq[b]({debug:this._options.debug,endpoint:this._options.request.endpoint,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,demoMode:this._options.demoMode,log:this.log,onProgress:function(b,
c,g,h){a._onProgress(b,c,g,h);a._options.callbacks.onProgress(b,c,g,h)},onComplete:function(b,c,g,h){a._onComplete(b,c,g,h);a._options.callbacks.onComplete(b,c,g)},onCancel:function(b,c){a._onCancel(b,c);a._options.callbacks.onCancel(b,c)},onUpload:function(b,c,g){a._onUpload(b,c,g);a._options.callbacks.onUpload(b,c,g)},onAutoRetry:function(b,c,g,h){a._preventRetries[b]=g[a._options.retry.preventRetryResponseProperty];return a._shouldAutoRetry(b,c,g)?(a._maybeParseAndSendUploadError(b,c,g,h),a._options.callbacks.onAutoRetry(b,
c,a._autoRetries[b]+1),a._onBeforeAutoRetry(b,c),a._retryTimeouts[b]=setTimeout(function(){a._onAutoRetry(b,c,g)},1E3*a._options.retry.autoAttemptDelay),!0):!1}})},_preventLeaveInProgress:function(){var a=this;this._attach(window,"beforeunload",function(b){if(a._filesInProgress)return b=b||window.event,b.returnValue=a._options.messages.onLeave})},_onSubmit:function(a,b){this._options.autoUpload&&this._filesInProgress++},_onProgress:function(a,b,f,c){},_onComplete:function(a,b,f,c){this._filesInProgress--;
this._maybeParseAndSendUploadError(a,b,f,c)},_onCancel:function(a,b){clearTimeout(this._retryTimeouts[a]);var f=qq.indexOf(this._storedFileIds,a);this._options.autoUpload||0>f?this._filesInProgress--:this._options.autoUpload||this._storedFileIds.splice(f,1)},_onUpload:function(a,b,f){},_onInputChange:function(a){this._handler instanceof qq.UploadHandlerXhr?this._uploadFileList(a.files):this._validateFile(a)&&this._uploadFile(a);this._button.reset()},_onBeforeAutoRetry:function(a,b){this.log("Waiting "+
this._options.retry.autoAttemptDelay+" seconds before retrying "+b+"...")},_onAutoRetry:function(a,b,f){this.log("Retrying "+b+"...");this._autoRetries[a]++;this._handler.retry(a)},_shouldAutoRetry:function(a,b,f){return!this._preventRetries[a]&&this._options.retry.enableAuto?(void 0===this._autoRetries[a]&&(this._autoRetries[a]=0),this._autoRetries[a]<this._options.retry.maxAutoAttempts):!1},_onBeforeManualRetry:function(a){if(this._preventRetries[a])return this.log("Retries are forbidden for id "+
a,"warn"),!1;if(this._handler.isValid(a)){var b=this._handler.getName(a);if(!1===this._options.callbacks.onManualRetry(a,b))return!1;this.log("Retrying upload for '"+b+"' (id: "+a+")...");this._filesInProgress++;return!0}this.log("'"+a+"' is not a valid file ID","error");return!1},_maybeParseAndSendUploadError:function(a,b,f,c){if(!f.success)if(c&&200!==c.status&&!f.error)this._options.callbacks.onError(a,b,"XHR returned response code "+c.status);else this._options.callbacks.onError(a,b,f.error?f.error:
"Upload failure reason unknown")},_uploadFileList:function(a){var b,f;b=this._getValidationDescriptors(a);1<b.length&&(f=!1===this._options.callbacks.onValidate(b));if(!f)if(0<a.length)for(b=0;b<a.length;b++)if(this._validateFile(a[b]))this._uploadFile(a[b]);else{if(this._options.validation.stopOnFirstInvalidFile)break}else this._error("noFilesError","")},_uploadFile:function(a){a=this._handler.add(a);var b=this._handler.getName(a);!1!==this._options.callbacks.onSubmit(a,b)&&(this._onSubmit(a,b),
this._options.autoUpload?this._handler.upload(a,this._options.request.params):this._storeFileForLater(a))},_storeFileForLater:function(a){this._storedFileIds.push(a)},_validateFile:function(a){var b,f;a=this._getValidationDescriptor(a);b=a.name;f=a.size;if(!1===this._options.callbacks.onValidate([a]))return!1;if(this._isAllowedExtension(b)){if(0===f)return this._error("emptyError",b),!1;if(f&&this._options.validation.sizeLimit&&f>this._options.validation.sizeLimit)return this._error("sizeError",b),
!1;if(f&&f<this._options.validation.minSizeLimit)return this._error("minSizeError",b),!1}else return this._error("typeError",b),!1;return!0},_error:function(a,b){var f=this._options.messages[a],c=this._options.validation.allowedExtensions.join(", "),g=this._formatFileName(b),f=f.replace("{file}",g),f=f.replace("{extensions}",c),c=this._formatSize(this._options.validation.sizeLimit),f=f.replace("{sizeLimit}",c),c=this._formatSize(this._options.validation.minSizeLimit),f=f.replace("{minSizeLimit}",
c);this._options.callbacks.onError(null,b,f);return f},_formatFileName:function(a){33<a.length&&(a=a.slice(0,19)+"..."+a.slice(-13));return a},_isAllowedExtension:function(a){a=-1!==a.indexOf(".")?a.replace(/.*[.]/,"").toLowerCase():"";var b=this._options.validation.allowedExtensions;if(!b.length)return!0;for(var f=0;f<b.length;f++)if(b[f].toLowerCase()==a)return!0;return!1},_formatSize:function(a){var b=-1;do a/=1024,b++;while(99<a);return Math.max(a,0.1).toFixed(1)+"kB MB GB TB PB EB".split(" ")[b]},
_wrapCallbacks:function(){var a,b;a=this;b=function(b,f,h){try{return f.apply(a,h)}catch(d){a.log("Caught exception in '"+b+"' callback - "+d,"error")}};for(var f in this._options.callbacks)(function(){var c=a._options.callbacks[f];a._options.callbacks[f]=function(){return b(f,c,arguments)}})()},_parseFileName:function(a){return a.value?a.value.replace(/.*(\/|\\)/,""):null!==a.fileName&&void 0!==a.fileName?a.fileName:a.name},_parseFileSize:function(a){var b;a.value||(b=null!==a.fileSize&&void 0!==
a.fileSize?a.fileSize:a.size);return b},_getValidationDescriptor:function(a){var b,f;f={};b=this._parseFileName(a);a=this._parseFileSize(a);f.name=b;a&&(f.size=a);return f},_getValidationDescriptors:function(a){var b,f;f=[];for(b=0;b<a.length;b++)f.push(a[b]);return f}};
qq.FineUploader=function(a){qq.FineUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:!0,disableDefaultDropzone:!1},text:{uploadButton:"Upload a file",cancelButton:"Cancel",retryButton:"Retry",failUpload:"Upload failed",dragZone:"Drop files here to upload",formatProgress:"{percent}% of {total_size}",waitingForResponse:"Processing..."},template:'<div class="qq-uploader">'+(!this._options.listElement?'<ul class="qq-upload-list mbs"></ul>':
"")+(!this._options.dragAndDrop||!this._options.dragAndDrop.disableDefaultDropzone?'<div class="qq-upload-drop-area"><span class="qq-upload-drop-text">{dragZoneText}</span>':"")+(!this._options.button?'<br/><div class="qq-upload-button btn"><div>{uploadButtonText}</div></div>':"")+(!this._options.dragAndDrop||!this._options.dragAndDrop.disableDefaultDropzone?"</div>":"")+"</div>",fileTemplate:'<li><div class="qq-progress-bar"></div><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><a class="qq-upload-retry" href="#">{retryButtonText}</a><span class="qq-upload-status-text">{statusText}</span></li>',
classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",dropDisabled:"qq-upload-drop-area-disabled",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",size:"qq-upload-size",cancel:"qq-upload-cancel",retry:"qq-upload-retry",statusText:"qq-upload-status-text",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,
failIcon:null},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file"},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:!1},showMessage:function(a){alert(a)}},!0);qq.extend(this._options,a,!0);this._wrapCallbacks();this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone);this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,
this._options.text.uploadButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,"");this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,
"list");this._classes=this._options.classes;this._button||(this._button=this._createUploadButton(this._find(this._element,"button")));this._bindCancelAndRetryEvents();this._setupDragDrop()};qq.extend(qq.FineUploader.prototype,qq.FineUploaderBasic.prototype);
qq.extend(qq.FineUploader.prototype,{clearStoredFiles:function(){qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments);this._listElement.innerHTML=""},addExtraDropzone:function(a){this._setupExtraDropzone(a)},removeExtraDropzone:function(a){var b=this._options.dragAndDrop.extraDropzones,f;for(f in b)if(b[f]===a)return this._options.dragAndDrop.extraDropzones.splice(f,1)},getItemByFileId:function(a){for(var b=this._listElement.firstChild;b;){if(b.qqFileId==a)return b;b=b.nextSibling}},
reset:function(){qq.FineUploaderBasic.prototype.reset.apply(this,arguments);this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");this._options.button||(this._button=this._createUploadButton(this._find(this._element,"button")));this._bindCancelAndRetryEvents();this._setupDragDrop()},_leaving_document_out:function(a){return(qq.chrome()||qq.safari()&&qq.windows())&&0==a.clientX&&0==a.clientY||qq.firefox()&&!a.relatedTarget},_storeFileForLater:function(a){qq.FineUploaderBasic.prototype._storeFileForLater.apply(this,
arguments);var b=this.getItemByFileId(a);qq(this._find(b,"spinner")).hide()},_find:function(a,b){var f=qq(a).getByClass(this._options.classes[b])[0];if(!f)throw Error("element not found "+b);return f},_setupExtraDropzone:function(a){this._options.dragAndDrop.extraDropzones.push(a);this._setupDropzone(a)},_setupDropzone:function(a){var b=this,f=new qq.UploadDropZone({element:a,onEnter:function(f){qq(a).addClass(b._classes.dropActive);f.stopPropagation()},onLeave:function(a){},onLeaveNotDescendants:function(f){qq(a).removeClass(b._classes.dropActive)},
onDrop:function(f){b._options.dragAndDrop.hideDropzones&&qq(a).hide();qq(a).removeClass(b._classes.dropActive);1<f.dataTransfer.files.length&&!b._options.multiple?b._error("tooManyFilesError",""):b._uploadFileList(f.dataTransfer.files)}});this.addDisposer(function(){f.dispose()});this._options.dragAndDrop.hideDropzones&&qq(a).hide()},_setupDragDrop:function(){var a,b;a=this;this._options.dragAndDrop.disableDefaultDropzone||(b=this._find(this._element,"drop"),this._options.dragAndDrop.extraDropzones.push(b));
var f=this._options.dragAndDrop.extraDropzones,c;for(c=0;c<f.length;c++)this._setupDropzone(f[c]);!this._options.dragAndDrop.disableDefaultDropzone&&(!qq.ie()||qq.ie10())&&this._attach(document,"dragenter",function(g){if(!qq(b).hasClass(a._classes.dropDisabled)){b.style.display="block";for(c=0;c<f.length;c++)f[c].style.display="block"}});this._attach(document,"dragleave",function(b){if(a._options.dragAndDrop.hideDropzones&&qq.FineUploader.prototype._leaving_document_out(b))for(c=0;c<f.length;c++)qq(f[c]).hide()});
qq(document).attach("drop",function(b){if(a._options.dragAndDrop.hideDropzones)for(c=0;c<f.length;c++)qq(f[c]).hide();b.preventDefault()})},_onSubmit:function(a,b){qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(a,b)},_onProgress:function(a,b,f,c){qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments);var g,h,d,k;g=this.getItemByFileId(a);h=this._find(g,"progressBar");k=Math.round(100*(f/c));f===c?(d=this._find(g,"cancel"),qq(d).hide(),qq(h).hide(),qq(this._find(g,
"statusText")).setText(this._options.text.waitingForResponse),d=this._formatSize(c)):(d=this._formatProgress(f,c),qq(h).css({display:"block"}));qq(h).css({width:k+"%"});g=this._find(g,"size");qq(g).css({display:"inline"});qq(g).setText(d)},_onComplete:function(a,b,f,c){qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var g=this.getItemByFileId(a);qq(this._find(g,"statusText")).clearText();qq(g).removeClass(this._classes.retrying);qq(this._find(g,"progressBar")).hide();(!this._options.disableCancelForFormUploads||
qq.UploadHandlerXhr.isSupported())&&qq(this._find(g,"cancel")).hide();qq(this._find(g,"spinner")).hide();f.success?(qq(g).addClass(this._classes.success),this._classes.successIcon&&(this._find(g,"finished").style.display="inline-block",qq(g).addClass(this._classes.successIcon))):(qq(g).addClass(this._classes.fail),this._classes.failIcon&&(this._find(g,"finished").style.display="inline-block",qq(g).addClass(this._classes.failIcon)),this._options.retry.showButton&&!this._preventRetries[a]&&qq(g).addClass(this._classes.retryable),
this._controlFailureTextDisplay(g,f))},_onUpload:function(a,b,f){qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments);var c=this.getItemByFileId(a);this._showSpinner(c)},_onBeforeAutoRetry:function(a){var b,f,c,g,h;qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments);b=this.getItemByFileId(a);f=this._find(b,"progressBar");this._showCancelLink(b);f.style.width=0;qq(f).hide();this._options.retry.showAutoRetryNote&&(f=this._find(b,"statusText"),c=this._autoRetries[a]+1,g=
this._options.retry.maxAutoAttempts,h=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,c),h=h.replace(/\{maxAuto\}/g,g),qq(f).setText(h),1===c&&qq(b).addClass(this._classes.retrying))},_onBeforeManualRetry:function(a){if(qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)){var b=this.getItemByFileId(a);this._find(b,"progressBar").style.width=0;qq(b).removeClass(this._classes.fail);this._showSpinner(b);this._showCancelLink(b);return!0}return!1},_addToList:function(a,
b){var f=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.UploadHandlerXhr.isSupported()){var c=this._find(f,"cancel");qq(c).remove()}f.qqFileId=a;c=this._find(f,"file");qq(c).setText(this._formatFileName(b));qq(this._find(f,"size")).hide();this._options.multiple||this._clearList();this._listElement.appendChild(f)},_clearList:function(){this._listElement.innerHTML="";this.clearStoredFiles()},_bindCancelAndRetryEvents:function(){var a=this;this._attach(this._listElement,
"click",function(b){b=b||window.event;var f=b.target||b.srcElement;if(qq(f).hasClass(a._classes.cancel)||qq(f).hasClass(a._classes.retry)){qq.preventDefault(b);for(b=f.parentNode;void 0==b.qqFileId;)b=f=f.parentNode;qq(f).hasClass(a._classes.cancel)?(a.cancel(b.qqFileId),qq(b).remove()):(qq(b).removeClass(a._classes.retryable),a.retry(b.qqFileId))}})},_formatProgress:function(a,b){var f=this._options.text.formatProgress,c=Math.round(100*(a/b)),f=f.replace("{percent}",c),c=this._formatSize(b);return f=
f.replace("{total_size}",c)},_controlFailureTextDisplay:function(a,b){var f,c,g,h;f=this._options.failedUploadTextDisplay.mode;c=this._options.failedUploadTextDisplay.maxChars;g=this._options.failedUploadTextDisplay.responseProperty;"custom"===f?((f=b[g])?f.length>c&&(h=f.substring(0,c)+"..."):(f=this._options.text.failUpload,this.log("'"+g+"' is not a valid property on the server response.","warn")),qq(this._find(a,"statusText")).setText(h||f),this._options.failedUploadTextDisplay.enableTooltip&&
this._showTooltip(a,f)):"default"===f?qq(this._find(a,"statusText")).setText(this._options.text.failUpload):"none"!==f&&this.log("failedUploadTextDisplay.mode value of '"+f+"' is not valid","warn")},_showTooltip:function(a,b){a.title=b},_showSpinner:function(a){this._find(a,"spinner").style.display="inline-block"},_showCancelLink:function(a){if(!this._options.disableCancelForFormUploads||qq.UploadHandlerXhr.isSupported())this._find(a,"cancel").style.display="inline"},_error:function(a,b){var f=qq.FineUploaderBasic.prototype._error.apply(this,
arguments);this._options.showMessage(f)}});qq.UploadDropZone=function(a){this._options={element:null,onEnter:function(a){},onLeave:function(a){},onLeaveNotDescendants:function(a){},onDrop:function(a){}};qq.extend(this._options,a);qq.extend(this,qq.DisposeSupport);this._element=this._options.element;this._disableDropOutside();this._attachEvents()};
qq.UploadDropZone.prototype={_dragover_should_be_canceled:function(){return qq.safari()||qq.firefox()&&qq.windows()},_disableDropOutside:function(a){qq.UploadDropZone.dropOutsideDisabled||(this._dragover_should_be_canceled?qq(document).attach("dragover",function(a){a.preventDefault()}):qq(document).attach("dragover",function(a){a.dataTransfer&&(a.dataTransfer.dropEffect="none",a.preventDefault())}),qq.UploadDropZone.dropOutsideDisabled=!0)},_attachEvents:function(){var a=this;a._attach(a._element,
"dragover",function(b){if(a._isValidFileDrag(b)){var f=qq.ie()?null:b.dataTransfer.effectAllowed;b.dataTransfer.dropEffect="move"==f||"linkMove"==f?"move":"copy";b.stopPropagation();b.preventDefault()}});a._attach(a._element,"dragenter",function(b){if(a._isValidFileDrag(b))a._options.onEnter(b)});a._attach(a._element,"dragleave",function(b){if(a._isValidFileDrag(b)){a._options.onLeave(b);var f=document.elementFromPoint(b.clientX,b.clientY);if(!qq(this).contains(f))a._options.onLeaveNotDescendants(b)}});
a._attach(a._element,"drop",function(b){a._isValidFileDrag(b)&&(b.preventDefault(),a._options.onDrop(b))})},_isValidFileDrag:function(a){if(qq.ie()&&!qq.ie10())return!1;a=a.dataTransfer;var b=qq.safari(),f=qq.ie10()?!0:"none"!=a.effectAllowed;return a&&f&&(a.files||!b&&a.types.contains&&a.types.contains("Files"))}};
qq.UploadHandlerAbstract=function(a){this._options={debug:!1,endpoint:"/upload.php",maxConnections:999,log:function(a,f){},onProgress:function(a,f,c,g){},onComplete:function(a,f,c,g){},onCancel:function(a,f){},onUpload:function(a,f,c){},onAutoRetry:function(a,f,c,g){}};qq.extend(this._options,a);this._queue=[];this._params=[];this.log=this._options.log};
qq.UploadHandlerAbstract.prototype={add:function(a){},upload:function(a,b){var f=this._queue.push(a),c={};qq.extend(c,b);this._params[a]=c;f<=this._options.maxConnections&&this._upload(a,this._params[a])},retry:function(a){0<=qq.indexOf(this._queue,a)?this._upload(a,this._params[a]):this.upload(a,this._params[a])},cancel:function(a){this.log("Cancelling "+a);this._cancel(a);this._dequeue(a)},cancelAll:function(){for(var a=0;a<this._queue.length;a++)this._cancel(this._queue[a]);this._queue=[]},getName:function(a){},
getSize:function(a){},getQueue:function(){return this._queue},reset:function(){this.log("Resetting upload handler");this._queue=[];this._params=[]},_upload:function(a){},_cancel:function(a){},_dequeue:function(a){a=qq.indexOf(this._queue,a);this._queue.splice(a,1);var b=this._options.maxConnections;this._queue.length>=b&&a<b&&(a=this._queue[b-1],this._upload(a,this._params[a]))},isValid:function(a){}};
qq.UploadHandlerForm=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={};this._detach_load_events={}};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);
qq.extend(qq.UploadHandlerForm.prototype,{add:function(a){a.setAttribute("name",this._options.inputName);var b="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[b]=a;a.parentNode&&qq(a).remove();return b},getName:function(a){return this._inputs[a].value.replace(/.*(\/|\\)/,"")},isValid:function(a){return void 0!==this._inputs[a]},reset:function(){qq.UploadHandlerAbstract.prototype.reset.apply(this,arguments);this._inputs={};this._detach_load_events={}},_cancel:function(a){this._options.onCancel(a,
this.getName(a));delete this._inputs[a];delete this._detach_load_events[a];if(a=document.getElementById(a))a.setAttribute("src","javascript:false;"),qq(a).remove()},_upload:function(a,b){this._options.onUpload(a,this.getName(a),!1);var f=this._inputs[a];if(!f)throw Error("file with passed id was not added, or already uploaded or cancelled");var c=this.getName(a),g=this._createIframe(a),h=this._createForm(g,b);h.appendChild(f);var d=this;this._attachLoadEvent(g,function(){d.log("iframe loaded");var b=
d._getIframeContentJSON(g);setTimeout(function(){d._detach_load_events[a]();delete d._detach_load_events[a];qq(g).remove()},1);if(b.success||!d._options.onAutoRetry(a,c,b))d._options.onComplete(a,c,b),d._dequeue(a)});this.log("Sending upload request for "+a);h.submit();qq(h).remove();return a},_attachLoadEvent:function(a,b){var f=this;this._detach_load_events[a.id]=qq(a).attach("load",function(){f.log("Received response for "+a.id);if(a.parentNode){try{if(a.contentDocument&&a.contentDocument.body&&
"false"==a.contentDocument.body.innerHTML)return}catch(c){f.log("Error when attempting to access iframe during handling of upload response ("+c+")","error")}b()}})},_getIframeContentJSON:function(a){try{var b=a.contentDocument?a.contentDocument:a.contentWindow.document,f,c=b.body.innerHTML;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+c);c&&c.match(/^<pre/i)&&(c=b.body.firstChild.firstChild.nodeValue);f=eval("("+c+")")}catch(g){this.log("Error when attempting to parse form upload response ("+
g+")","error"),f={success:!1}}return f},_createIframe:function(a){var b=qq.toElement('<iframe src="javascript:false;" name="'+a+'" />');b.setAttribute("id",a);b.style.display="none";document.body.appendChild(b);return b},_createForm:function(a,b){var f=qq.toElement('<form method="'+(this._options.demoMode?"GET":"POST")+'" enctype="multipart/form-data"></form>'),c=qq.obj2url(b,this._options.endpoint);f.setAttribute("action",c);f.setAttribute("target",a.name);f.style.display="none";document.body.appendChild(f);
return f}});qq.UploadHandlerXhr=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]};qq.UploadHandlerXhr.isSupported=function(){var a=document.createElement("input");a.type="file";return"multiple"in a&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof(new XMLHttpRequest).upload};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);
qq.extend(qq.UploadHandlerXhr.prototype,{add:function(a){if(!(a instanceof File))throw Error("Passed obj in not a File (in qq.UploadHandlerXhr)");return this._files.push(a)-1},getName:function(a){a=this._files[a];return null!==a.fileName&&void 0!==a.fileName?a.fileName:a.name},getSize:function(a){a=this._files[a];return null!=a.fileSize?a.fileSize:a.size},getLoaded:function(a){return this._loaded[a]||0},isValid:function(a){return void 0!==this._files[a]},reset:function(){qq.UploadHandlerAbstract.prototype.reset.apply(this,
arguments);this._files=[];this._xhrs=[];this._loaded=[]},_upload:function(a,b){this._options.onUpload(a,this.getName(a),!0);var f=this._files[a],c=this.getName(a);this.getSize(a);this._loaded[a]=0;var g=this._xhrs[a]=new XMLHttpRequest,h=this;g.upload.onprogress=function(b){b.lengthComputable&&(h._loaded[a]=b.loaded,h._options.onProgress(a,c,b.loaded,b.total))};g.onreadystatechange=function(){4==g.readyState&&h._onComplete(a,g)};b=b||{};var d=qq.obj2url(b,this._options.endpoint);g.open(this._options.demoMode?
"GET":"POST",d,!0);g.setRequestHeader("X-Requested-With","XMLHttpRequest");g.setRequestHeader("X-File-Name",encodeURIComponent(c));g.setRequestHeader("Cache-Control","no-cache");this._options.forceMultipart?(d=new FormData,d.append(this._options.inputName,f),f=d):(g.setRequestHeader("Content-Type","application/octet-stream"),g.setRequestHeader("X-Mime-Type",f.type));for(key in this._options.customHeaders)g.setRequestHeader(key,this._options.customHeaders[key]);this.log("Sending upload request for "+
a);g.send(f)},_onComplete:function(a,b){if(this._files[a]){var f=this.getName(a),c=this.getSize(a),g;this._options.onProgress(a,f,c,c);this.log("xhr - server response received for "+a);this.log("responseText = "+b.responseText);try{g="function"===typeof JSON.parse?JSON.parse(b.responseText):eval("("+b.responseText+")")}catch(h){this.log("Error when attempting to parse xhr response text ("+h+")","error"),g={}}if(200===b.status&&g.success||!this._options.onAutoRetry(a,f,g,b))this._options.onComplete(a,
f,g,b),this._xhrs[a]=null,this._dequeue(a)}},_cancel:function(a){this._options.onCancel(a,this.getName(a));this._files[a]=null;this._xhrs[a]&&(this._xhrs[a].abort(),this._xhrs[a]=null)}});
var FacebookApiLoader=function(){function a(a){if("connected"===a.status&&a.authResponse.userID==active_user.facebook_uid()){a=a.authResponse;var b=(new Element("form",{action:"https://"+location.hostname+"/facebook_connection/update_auth_token",method:"post"})).setStyle({display:"none"});$(document.body).insert(b);b.insert(new Element("input",{type:"hidden",name:"access_token",value:a.accessToken}));b.insert(new Element("input",{type:"hidden",name:"expires",value:a.expiresIn}));new DynamicFrameTarget({form:b});
b.submit()}}function b(){FB.getLoginStatus(a)}var f=[],c=!1,g;(function(){$j.each(document.cookie.split(";"),function(a,b){var f=$j.trim(b.split("=")[0]);0===f.indexOf("fblo_")&&Cookie.erase(f,"/; domain="+document.location.hostname.replace(/^www/,""))})})();return g={populate:function(a,d){var k=new Element("div",{id:"fb-root"}),n=new Element("script",{async:!0,src:"https://connect.facebook.net/en_US/sdk.js?version=v2.2"});g.app_id=a;$$(".js_facebook_like_button").each(function(a){var b=active_user.valueOfSearchParameter,
f=(Math.floor(b("km_generation"))||-1)+1,c=new Template(a.innerHTML),d=active_user.siteVisitorUID();a.replace(c.evaluate({url:Object.toQueryString({kme:"Followed fb_like",source:"fb_like",km_orig_source:b("km_orig_source")||"fb_like",km_prev_source:b("km_source")||b("source"),km_orig_person:b("km_orig_person")||d,km_prev_person:d,km_generation:f})}))});window.fbAsyncInit=function(){FB.init({appId:a,version:"v2.6",status:!0,cookie:!0,xfbml:!0,channelUrl:d,oauth:!0});c=!0;f.each(function(a){a()});active_user.facebookAccessTokenNeedsUpdate()&&
b()};$$("head")[0].insert(k);k.insert(n)},addApiLoadedCallback:function(a){c?a():f.push(a)},updateLoginStatus:b}}(),Handlebars=function(){var a=function(){function a(b){this.string=b}a.prototype.toString=function(){return""+this.string};return a}(),b=function(a){function b(a){return c[a]||"&amp;"}var f={},c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},g=/[&<>"'`]/g,q=/[&<>"'`]/;f.extend=function(a,b){for(var f in b)Object.prototype.hasOwnProperty.call(b,f)&&(a[f]=b[f])};
var s=Object.prototype.toString;f.toString=s;var l=function(a){return"function"===typeof a};l(/x/)&&(l=function(a){return"function"===typeof a&&"[object Function]"===s.call(a)});f.isFunction=l;var m=Array.isArray||function(a){return a&&"object"===typeof a?"[object Array]"===s.call(a):!1};f.isArray=m;f.escapeExpression=function(f){if(f instanceof a)return f.toString();if(!f&&0!==f)return"";f=""+f;return!q.test(f)?f:f.replace(g,b)};f.isEmpty=function(a){return!a&&0!==a?!0:m(a)&&0===a.length?!0:!1};
return f}(a),f=function(){function a(f,c){var g;c&&c.firstLine&&(g=c.firstLine,f+=" - "+g+":"+c.firstColumn);for(var h=Error.prototype.constructor.call(this,f),s=0;s<b.length;s++)this[b[s]]=h[b[s]];g&&(this.lineNumber=g,this.column=c.firstColumn)}var b="description fileName lineNumber message name number stack".split(" ");a.prototype=Error();return a}(),c=function(a,b){function f(a,b){this.helpers=a||{};this.partials=b||{};c(this)}function c(a){a.registerHelper("helperMissing",function(a){if(2!==
arguments.length)throw new l("Missing helper: '"+a+"'");});a.registerHelper("blockHelperMissing",function(b,f){var c=f.inverse||function(){},d=f.fn;v(b)&&(b=b.call(this));return!0===b?d(this):!1===b||null==b?c(this):m(b)?0<b.length?a.helpers.each(b,f):c(this):d(b)});a.registerHelper("each",function(a,b){var f=b.fn,c=b.inverse,d=0,g="",h;v(a)&&(a=a.call(this));b.data&&(h=u(b.data));if(a&&"object"===typeof a)if(m(a))for(var l=a.length;d<l;d++)h&&(h.index=d,h.first=0===d,h.last=d===a.length-1),g+=f(a[d],
{data:h});else for(l in a)a.hasOwnProperty(l)&&(h&&(h.key=l,h.index=d,h.first=0===d),g+=f(a[l],{data:h}),d++);0===d&&(g=c(this));return g});a.registerHelper("if",function(a,b){v(a)&&(a=a.call(this));return!b.hash.includeZero&&!a||s.isEmpty(a)?b.inverse(this):b.fn(this)});a.registerHelper("unless",function(b,f){return a.helpers["if"].call(this,b,{fn:f.inverse,inverse:f.fn,hash:f.hash})});a.registerHelper("with",function(a,b){v(a)&&(a=a.call(this));if(!s.isEmpty(a))return b.fn(a)});a.registerHelper("log",
function(b,f){var c=f.data&&null!=f.data.level?parseInt(f.data.level,10):1;a.log(c,b)})}function g(a,b){r.log(a,b)}var q={},s=a,l=b;q.VERSION="1.3.0";q.COMPILER_REVISION=4;q.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};var m=s.isArray,v=s.isFunction,t=s.toString;q.HandlebarsEnvironment=f;f.prototype={constructor:f,logger:r,log:g,registerHelper:function(a,b,f){if("[object Object]"===t.call(a)){if(f||b)throw new l("Arg not supported with multiple helpers");s.extend(this.helpers,
a)}else f&&(b.not=f),this.helpers[a]=b},registerPartial:function(a,b){"[object Object]"===t.call(a)?s.extend(this.partials,a):this.partials[a]=b}};var r={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(a,b){if(r.level<=a){var f=r.methodMap[a];"undefined"!==typeof console&&console[f]&&console[f].call(console,b)}}};q.logger=r;q.log=g;var u=function(a){var b={};s.extend(b,a);return b};q.createFrame=u;return q}(b,f),g=function(a,b,f){function c(a,b,
f){var d=function(a,c){c=c||{};return b(a,c.data||f)};d.program=a;d.depth=0;return d}var g={},q=f.COMPILER_REVISION,s=f.REVISION_CHANGES;g.checkRevision=function(a){var f=a&&a[0]||1;if(f!==q){if(f<q)throw new b("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+s[q]+") or downgrade your runtime to an older version ("+s[f]+").");throw new b("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+
a[1]+").");}};g.template=function(f,g){if(!g)throw new b("No environment passed to template");var k={escapeExpression:a.escapeExpression,invokePartial:function(a,f,c,h,l,k){var B=g.VM.invokePartial.apply(this,arguments);if(null!=B)return B;if(g.compile)return B={helpers:h,partials:l,data:k},l[f]=g.compile(a,{data:void 0!==k},g),l[f](c,B);throw new b("The partial "+f+" could not be compiled when running in runtime-only mode");},programs:[],program:function(a,b,f){var d=this.programs[a];f?d=c(a,b,f):
d||(d=this.programs[a]=c(a,b));return d},merge:function(b,f){var c=b||f;b&&(f&&b!==f)&&(c={},a.extend(c,f),a.extend(c,b));return c},programWithDepth:g.VM.programWithDepth,noop:g.VM.noop,compilerInfo:null};return function(a,b){b=b||{};var c=b.partial?b:g,d,h;b.partial||(d=b.helpers,h=b.partials);c=f.call(k,c,a,d,h,b.data);b.partial||g.VM.checkRevision(k.compilerInfo);return c}};g.programWithDepth=function(a,b,f){var c=Array.prototype.slice.call(arguments,3),d=function(a,d){d=d||{};return b.apply(this,
[a,d.data||f].concat(c))};d.program=a;d.depth=c.length;return d};g.program=c;g.invokePartial=function(a,f,c,g,h,k){g={partial:!0,helpers:g,partials:h,data:k};if(void 0===a)throw new b("The partial "+f+" could not be found");if(a instanceof Function)return a(c,g)};g.noop=function(){return""};return g}(b,f,c);return function(a,b,f,c,g){var q=function(){var l=new a.HandlebarsEnvironment;c.extend(l,a);l.SafeString=b;l.Exception=f;l.Utils=c;l.VM=g;l.template=function(a){return g.template(a,l)};return l},
s=q();s.create=q;return s}(c,a,f,b,g)}();Handlebars.registerHelper("tr",function(a,b){var f;f=b.hash.description;delete b.hash.description;return tr8nProxy.tr(a,f,b.hash)});
(function(){this.HandlebarsTemplates||(this.HandlebarsTemplates={});this.HandlebarsTemplates["native_build_uploader/info"]=Handlebars.template(function(a,b,f,c,g){function h(a,b){var f;return f=""+("\n        <li>"+k(typeof a===d?a.apply(a):a)+"</li>\n      ")}this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);g=g||{};a="";var d="function",k=this.escapeExpression,n=this;if((c=f["if"].call(b,b&&b.messages,{hash:{},inverse:n.noop,fn:n.program(1,function(a,b){var c,d;c='\n  <div id="message" class="message mbm">\n    <ul>\n      ';
if((d=f.each.call(a,a&&a.messages,{hash:{},inverse:n.noop,fn:n.program(2,h,b),data:b}))||0===d)c+=d;return c+"\n    </ul>\n  </div>\n"},g),data:g}))||0===c)a+=c;a+="\n";if((c=f["if"].call(b,b&&b.errors,{hash:{},inverse:n.noop,fn:n.program(4,function(a,b){var c,d;c='\n  <div id="error" class="error mbm">\n    <ul>\n      ';if((d=f.each.call(a,a&&a.errors,{hash:{},inverse:n.noop,fn:n.program(2,h,b),data:b}))||0===d)c+=d;return c+"\n    </ul>\n  </div>\n"},g),data:g}))||0===c)a+=c;return a+"\n"});return this.HandlebarsTemplates["native_build_uploader/info"]}).call(this);
(function(){Handlebars.registerPartial("navigation/achievements/_badge_of_the_day",Handlebars.template(function(a,b,f,c,g){this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);g=g||{};var h,d;c=f.helperMissing;var k=this.escapeExpression;a='<dl id="main_nav_achievements_botd" class="main_nav_category mrl">\n  <dt class="main_nav_category_title pbs"><a href=\'/badges\' data-metric-tracker="js-wa-tc-Navigation-Badge_of_the_Day">';d={hash:{},data:g};if((d=(h=f.tr||b&&b.tr,h?h.call(b,"Badge of the Day &raquo;",
d):c.call(b,"tr","Badge of the Day &raquo;",d)))||0===d)a+=d;a+='</a></dt>\n  <dd class="mtm">\n    <p class="h6 intro mbs"><em>';d={hash:{},data:g};if((d=(h=f.tr||b&&b.tr,h?h.call(b,"Score 2x points",d):c.call(b,"tr","Score 2x points",d)))||0===d)a+=d;a+='!</em></p>\n    <div class="botd_outer media click_box regtextSml">\n      <div class="badge img mlm">\n        <div class="badge_image">\n          <a href="';(d=f.game_path)?d=d.call(b,{hash:{},data:g}):(d=b&&b.game_path,d="function"===typeof d?
d.call(b,{hash:{},data:g}):d);a+=k(d)+'" class="badge_link" data-metric-tracker="js-wa-tc-Navigation-Badge_of_the_Day">\n            <img alt="';(d=f.title)?d=d.call(b,{hash:{},data:g}):(d=b&&b.title,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=k(d)+'" src="';(d=f.icon_path)?d=d.call(b,{hash:{},data:g}):(d=b&&b.icon_path,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=k(d)+'" class="img" />\n          </a>\n        </div>\n        <div class="badge_border">\n          <a href="';
(d=f.game_path)?d=d.call(b,{hash:{},data:g}):(d=b&&b.game_path,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=k(d)+'" class="badge_link" data-metric-tracker="js-wa-tc-Navigation-Badge_of_the_Day">\n            <span class="';(d=f.earned_class)?d=d.call(b,{hash:{},data:g}):(d=b&&b.earned_class,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=k(d)+' spritegame spriteall">Badge of the Day</span>\n          </a>\n        </div>\n        <div class="badge_of_the_day_overlay">\n          <a href="';
(d=f.game_path)?d=d.call(b,{hash:{},data:g}):(d=b&&b.game_path,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=k(d)+'" class="badge_link" data-metric-tracker="js-wa-tc-Navigation-Badge_of_the_Day">\n            <span class="spriteall botd_badge_id_';(d=f.badge_id)?d=d.call(b,{hash:{},data:g}):(d=b&&b.badge_id,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=k(d)+'">Badge of the Day</span>\n          </a>\n        </div>\n      </div>\n      <p class="bd">\n        <strong><a href="';
(d=f.game_path)?d=d.call(b,{hash:{},data:g}):(d=b&&b.game_path,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=k(d)+'" class="game_link click_link" data-metric-tracker="js-wa-tc-Navigation-Badge_of_the_Day">';(d=f.title)?d=d.call(b,{hash:{},data:g}):(d=b&&b.title,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=k(d)+"</a></strong>\n        ";(d=f.description)?d=d.call(b,{hash:{},data:g}):(d=b&&b.description,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=k(d)+' in <a href="';
(d=f.game_path)?d=d.call(b,{hash:{},data:g}):(d=b&&b.game_path,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=k(d)+'" data-metric-tracker="js-wa-tc-Navigation-Badge_of_the_Day">';(d=f.game_title)?d=d.call(b,{hash:{},data:g}):(d=b&&b.game_title,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);return a+=k(d)+"</a>\n      </p>\n    </div>\n  </dd>\n</dl>\n"}))}).call(this);
(function(){Handlebars.registerPartial("navigation/achievements/_current_challenge",Handlebars.template(function(a,b,f,c,g){this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);g=g||{};var h,d,k=f.helperMissing;c=this.escapeExpression;a='<dl id="main_nav_achievements_challenge" class="main_nav_category mrl">\n  <dt class="main_nav_category_title pbs"><a href=\'/current_challenges\'>';d={hash:{},data:g};if((d=(h=f.tr||b&&b.tr,h?h.call(b,"Current Challenge",d):k.call(b,"tr","Current Challenge",
d)))||0===d)a+=d;a+=' &raquo;</a></dt>\n  <dd class="mtm">\n    <div class="media click_block">\n      <a href="';(d=f.game_path)?d=d.call(b,{hash:{},data:g}):(d=b&&b.game_path,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=c(d)+'">\n        <img alt="';(d=f.title)?d=d.call(b,{hash:{},data:g}):(d=b&&b.title,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=c(d)+'" src="';(d=f.icon_path)?d=d.call(b,{hash:{},data:g}):(d=b&&b.icon_path,d="function"===typeof d?d.call(b,{hash:{},data:g}):
d);a+=c(d)+'" class="img" />\n      </a>\n      <p class="bd">\n        <strong><a href="';(d=f.game_path)?d=d.call(b,{hash:{},data:g}):(d=b&&b.game_path,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=c(d)+'" class="game_link click_link">';(d=f.title)?d=d.call(b,{hash:{},data:g}):(d=b&&b.title,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=c(d)+"</a></strong>\n        ";(d=f.description)?d=d.call(b,{hash:{},data:g}):(d=b&&b.description,d="function"===typeof d?d.call(b,{hash:{},
data:g}):d);return a+=c(d)+"\n      </p>\n    </div>\n  </dd>\n</dl>\n"}))}).call(this);
(function(){Handlebars.registerPartial("navigation/achievements/_kongpanion",Handlebars.template(function(a,b,f,c,g){this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);g=g||{};var h,d;c=f.helperMissing;var k=this.escapeExpression;a='<dl id="main_nav_achievements_kongpanion" class="main_nav_category mrl">\n  <dt class="main_nav_category_title pbs"><a href=\'/kongpanions\'>';d={hash:{},data:g};if((d=(h=f.tr||b&&b.tr,h?h.call(b,"This Week's Kongpanion",d):c.call(b,"tr","This Week's Kongpanion",
d)))||0===d)a+=d;a+=' &raquo;</a></dt>\n  <dd class="mtm">\n    <div class="media click_block">\n      <img src="';(d=f.icon_path)?d=d.call(b,{hash:{},data:g}):(d=b&&b.icon_path,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=k(d)+'" class="img" />\n      <p class="bd">\n        <strong><a href=\'/kongpanions\' class="game_link click_link">';(d=f.name)?d=d.call(b,{hash:{},data:g}):(d=b&&b.name,d="function"===typeof d?d.call(b,{hash:{},data:g}):d);a+=k(d)+"</a></strong>\n        ";d={hash:{},
data:g};if((d=(h=f.tr||b&&b.tr,h?h.call(b,"Complete the Badge of the Day to unlock the Kongpanion!",d):c.call(b,"tr","Complete the Badge of the Day to unlock the Kongpanion!",d)))||0===d)a+=d;return a+"\n      </p>\n    </div>\n  </dd>\n</dl>\n"}))}).call(this);
(function(){Handlebars.registerPartial("navigation/achievements/_recently_badged_game",Handlebars.template(function(a,b,f,c,g){this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);g=g||{};var h=this.escapeExpression;a='<li class="game">\n  <a href="';(c=f.game_path)?c=c.call(b,{hash:{},data:g}):(c=b&&b.game_path,c="function"===typeof c?c.call(b,{hash:{},data:g}):c);a+=h(c)+'" class="media" data-metric-tracker="js-wa-tc-Navigation-Recently_Badged">\n    <img alt="Play ';(c=f.title)?c=c.call(b,
{hash:{},data:g}):(c=b&&b.title,c="function"===typeof c?c.call(b,{hash:{},data:g}):c);a+=h(c)+'" src="';(c=f.icon_path)?c=c.call(b,{hash:{},data:g}):(c=b&&b.icon_path,c="function"===typeof c?c.call(b,{hash:{},data:g}):c);a+=h(c)+'" class="img" />\n    <span class="bd">\n      <strong class="game_link">';(c=f.title)?c=c.call(b,{hash:{},data:g}):(c=b&&b.title,c="function"===typeof c?c.call(b,{hash:{},data:g}):c);a+=h(c)+'</strong>\n      <span class="badge_count"><span class="badge_icon spritesite mrs"></span>';
(c=f.badge_count)?c=c.call(b,{hash:{},data:g}):(c=b&&b.badge_count,c="function"===typeof c?c.call(b,{hash:{},data:g}):c);return a+=h(c)+"</span>\n    </span>\n  </a>\n</li>\n"}))}).call(this);
(function(){this.HandlebarsTemplates||(this.HandlebarsTemplates={});this.HandlebarsTemplates["navigation/achievements_tab"]=Handlebars.template(function(a,b,f,c,g){function h(a,b){var d,g,h;d="\n      ";if((h=n.invokePartial(c["navigation/achievements/_kongpanion"],"navigation/achievements/_kongpanion",(g=a&&a.achievements,null==g||!1===g?g:g.current_kongpanion),f,c,b))||0===h)d+=h;return d+"\n    "}this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);c=this.merge(c,a.partials);g=g||{};var d,
k,n=this,x=this.escapeExpression,q=f.helperMissing,s=f.blockHelperMissing;a='<div class="main_nav_menu_inner">\n  \x3c!-- BoTD Start --\x3e\n  ';if((k=n.invokePartial(c["navigation/achievements/_badge_of_the_day"],"navigation/achievements/_badge_of_the_day",(d=b&&b.achievements,null==d||!1===d?d:d.badge_of_the_day),f,c,g))||0===k)a+=k;a+="\n  \x3c!-- BoTD End --\x3e\n  \x3c!-- Challenge Start --\x3e\n  ";if((k=f["if"].call(b,(d=(d=b&&b.achievements,null==d||!1===d?d:d.current_challenge),null==d||
!1===d?d:d.title),{hash:{},inverse:n.program(3,function(a,b){var c,d,g;c="\n    ";if((g=f["if"].call(a,(d=(d=a&&a.achievements,null==d||!1===d?d:d.current_kongpanion),null==d||!1===d?d:d.name),{hash:{},inverse:n.noop,fn:n.program(4,h,b),data:b}))||0===g)c+=g;return c+"\n  "},g),fn:n.program(1,function(a,b){var d,g,h;d="\n    ";if((h=n.invokePartial(c["navigation/achievements/_current_challenge"],"navigation/achievements/_current_challenge",(g=a&&a.achievements,null==g||!1===g?g:g.current_challenge),
f,c,b))||0===h)d+=h;return d+"\n  "},g),data:g}))||0===k)a+=k;a+='\n  \x3c!-- Challenge End --\x3e\n  \x3c!-- Recently Badged Start --\x3e\n  <dl id="main_nav_achievements_recent" class="main_nav_category mrl">\n    <dt class="main_nav_category_title pbs"><a data-metric-tracker="js-wa-tc-Navigation-Recently_Badged" href="/badges?sort=newest">';k={hash:{},data:g};if((k=(d=f.tr||b&&b.tr,d?d.call(b,"Recently Badged Games",k):q.call(b,"tr","Recently Badged Games",k)))||0===k)a+=k;a+=' &raquo;</a></dt>\n    <dd class="mtm">\n      <ul class="main_nav_recently_badge_list">\n        ';
if((k=(d=(d=(d=b&&b.achievements,null==d||!1===d?d:d.recently_badged_games),"function"===typeof d?d.apply(b):d),s.call(b,d,{hash:{},inverse:n.noop,fn:n.program(6,function(a,b){var d,g;d="\n          ";if((g=n.invokePartial(c["navigation/achievements/_recently_badged_game"],"navigation/achievements/_recently_badged_game",a,f,c,b))||0===g)d+=g;return d+"\n        "},g),data:g})))||0===k)a+=k;a+='\n      </ul>\n    </dd>\n  </dl>\n  \x3c!-- Recently Badged End --\x3e\n  \x3c!-- Badges Start --\x3e\n  <dl id="main_nav_achievements_badges" class="main_nav_category">\n    <dt class="main_nav_category_title pbs"><a href=\'/badges\' data-metric-tracker="js-wa-tc-Navigation-Badges">';
k={hash:{},data:g};if((k=(d=f.tr||b&&b.tr,d?d.call(b,"Badges &raquo;",k):q.call(b,"tr","Badges &raquo;",k)))||0===k)a+=k;a+='</a></dt>\n    <dd class="mtm">\n      <ul class="main_nav_category_list">\n        <li><a href=\'/recommended-badges\' class="js-activate-inline-registration" data-metric-tracker="js-wa-tc-Navigation-Badges">';k={hash:{},data:g};if((k=(d=f.tr||b&&b.tr,d?d.call(b,"Recommended for Me",k):q.call(b,"tr","Recommended for Me",k)))||0===k)a+=k;a+="</a></li>\n        <li><a href='/badges?category=action' data-metric-tracker=\"js-wa-tc-Navigation-Badges\">";
k={hash:{},data:g};if((k=(d=f.tr||b&&b.tr,d?d.call(b,"Action Badges",k):q.call(b,"tr","Action Badges",k)))||0===k)a+=k;a+="</a></li>\n        <li><a href='/badges?sort=least_awarded' data-metric-tracker=\"js-wa-tc-Navigation-Badges\">";k={hash:{},data:g};if((k=(d=f.tr||b&&b.tr,d?d.call(b,"Rarest Badges",k):q.call(b,"tr","Rarest Badges",k)))||0===k)a+=k;a+="</a></li>\n        <li><a href='/badges?category=sports-racing' data-metric-tracker=\"js-wa-tc-Navigation-Badges\">";k={hash:{},data:g};if((k=
(d=f.tr||b&&b.tr,d?d.call(b,"Racing Badges",k):q.call(b,"tr","Racing Badges",k)))||0===k)a+=k;a+="</a></li>\n        <li><a href='/badges?sort=easiest&filter_by=unearned' data-metric-tracker=\"js-wa-tc-Navigation-Badges\">";k={hash:{},data:g};if((k=(d=f.tr||b&&b.tr,d?d.call(b,"Easiest Unearned",k):q.call(b,"tr","Easiest Unearned",k)))||0===k)a+=k;a+="</a></li>\n        <li><a href='/badges?category=puzzle' data-metric-tracker=\"js-wa-tc-Navigation-Badges\">";k={hash:{},data:g};if((k=(d=f.tr||b&&b.tr,
d?d.call(b,"Puzzle Badges",k):q.call(b,"tr","Puzzle Badges",k)))||0===k)a+=k;a+="</a></li>\n        <li><a href='/badges?sort=newest' data-metric-tracker=\"js-wa-tc-Navigation-Badges\">";k={hash:{},data:g};if((k=(d=f.tr||b&&b.tr,d?d.call(b,"Newest Badges",k):q.call(b,"tr","Newest Badges",k)))||0===k)a+=k;a+='</a></li>\n        <li class="more"><a href=\'/badges\' data-metric-tracker="js-wa-tc-Navigation-Badges">';k={hash:{},data:g};if((k=(d=f.tr||b&&b.tr,d?d.call(b,"All Badges",k):q.call(b,"tr","All Badges",
k)))||0===k)a+=k;a+='</a></li>\n      </ul>\n    </dd>\n  </dl>\n  \x3c!-- Badges End --\x3e\n  \x3c!-- Quests Start --\x3e\n  <dl id="main_nav_quests" class="main_nav_category mtl">\n    <dt class="main_nav_category_title pbs"><a href=\'/badge_quests/your_first\' data-metric-tracker="js-wa-tc-Navigation-Quests">';k={hash:{},data:g};if((k=(d=f.tr||b&&b.tr,d?d.call(b,"Quests &raquo;",k):q.call(b,"tr","Quests &raquo;",k)))||0===k)a+=k;a+='</a></dt>\n    <dd class="mtm">\n      <ul class="main_nav_category_list">\n        <li><a href=\'/badge_quests/your_first\' data-metric-tracker="js-wa-tc-Navigation-Quests">';
k={hash:{},data:g};if((k=(d=f.tr||b&&b.tr,d?d.call(b,"All Quests",k):q.call(b,"tr","All Quests",k)))||0===k)a+=k;a+="</a></li>\n        ";if((k=f["if"].call(b,(d=b&&b.user,null==d||!1===d?d:d.authenticated),{hash:{},inverse:n.noop,fn:n.program(8,function(a,b){var c,d,g;c=""+('\n          <li><a href="/accounts/'+x((d=(d=a&&a.user,null==d||!1===d?d:d.username),"function"===typeof d?d.apply(a):d))+'/awards" data-metric-tracker="js-wa-tc-Navigation-Quests">');g={hash:{},data:b};if((g=(d=f.tr||a&&a.tr,
d?d.call(a,"Your Medals",g):q.call(a,"tr","Your Medals",g)))||0===g)c+=g;return c+"</a></li>\n        "},g),data:g}))||0===k)a+=k;return a+"\n      </ul>\n    </dd>\n  </dl>\n  \x3c!-- Quests End --\x3e\n</div>\n"});return this.HandlebarsTemplates["navigation/achievements_tab"]}).call(this);
(function(){Handlebars.registerPartial("navigation/games/_game_lists",Handlebars.template(function(a,b,f,c,g){function h(a,b){var d,g,h;d="\n      ";if((h=q.invokePartial(c["navigation/games/_games"],"navigation/games/_games",(g=a&&a.games,null==g||!1===g?g:g.playlist),f,c,b))||0===h)d+=h;return d+"\n    "}function d(a,b){var c,d,g;c=""+('\n      <a href="'+l((d=(d=a&&a.user,null==d||!1===d?d:d.playlist_path),typeof d===s?d.apply(a):d))+'" class="no_games_block">\n        <span class="plus kong_ico" aria-hidden="true">+</span>\n        <strong class="title"><span class="icon kong_ico" aria-hidden="true">p</span> My Playlist</strong>\n        <span class="desc">');
g={hash:{},data:b};if((g=(d=f.tr||a&&a.tr,d?d.call(a,"Add games to play them later.",g):m.call(a,"tr","Add games to play them later.",g)))||0===g)c+=g;return c+"</span>\n      </a>\n    "}function k(a,b){var d,g,h;d="\n      ";if((h=q.invokePartial(c["navigation/games/_games"],"navigation/games/_games",(g=a&&a.games,null==g||!1===g?g:g.recommended),f,c,b))||0===h)d+=h;return d+"\n    "}function n(a,b){var c,d,g;c='\n      <a class="no_games_block" href="/games">\n        <span class="plus kong_ico" aria-hidden="true">+</span>\n        <strong class="title">';
g={hash:{},data:b};if((g=(d=f.tr||a&&a.tr,d?d.call(a,"Recommended Games",g):m.call(a,"tr","Recommended Games",g)))||0===g)c+=g;c+='</strong>\n        <span class="desc">';g={hash:{},data:b};if((g=(d=f.tr||a&&a.tr,d?d.call(a,"Start playing now.",g):m.call(a,"tr","Start playing now.",g)))||0===g)c+=g;return c+"</span>\n      </a>\n    "}this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);c=this.merge(c,a.partials);g=g||{};var x,q=this,s="function",l=this.escapeExpression,m=f.helperMissing;a=
"  ";if((b=f["if"].call(b,(x=b&&b.user,null==x||!1===x?x:x.authenticated),{hash:{},inverse:q.program(6,function(a,b){var d,g,h;d='\n  \x3c!-- Recent Games Start --\x3e\n  <div id="main_nav_games_im_playing" class="main_nav_category my_games_block mrl">\n    ';if((g=q.invokePartial(c["navigation/games/_recently_played"],"navigation/games/_recently_played",a,f,c,b))||0===g)d+=g;d+='\n  </div>\n  \x3c!-- Recent Games End --\x3e\n  \x3c!-- Recommended Games Start --\x3e\n  <div id="main_nav_recommended_games" class="main_nav_category my_games_block mrl">\n    <strong class="game_block_link">\n      <a href="'+
l((g=(g=a&&a.user,null==g||!1===g?g:g.recommended_games_path),typeof g===s?g.apply(a):g))+'" data-metric-tracker="js-wa-tc-Navigation-Recommended">';h={hash:{},data:b};if((h=(g=f.tr||a&&a.tr,g?g.call(a,"My Recommended &raquo;",h):m.call(a,"tr","My Recommended &raquo;",h)))||0===h)d+=h;d+="</a>\n    </strong>\n    ";if((h=f["if"].call(a,(g=a&&a.games,null==g||!1===g?g:g.recommended),{hash:{},inverse:q.program(9,n,b),fn:q.program(7,k,b),data:b}))||0===h)d+=h;d+='\n  </div>\n  \x3c!-- Recommended Games End --\x3e\n  \x3c!-- Playlist Games Start --\x3e\n  <div id="main_nav_my_playlist" class="main_nav_category my_games_block mrl">\n    <strong class="game_block_link">\n      <a href="'+
l((g=(g=a&&a.user,null==g||!1===g?g:g.playlist_path),typeof g===s?g.apply(a):g))+'" class="js-wa-tc-Navigation-Playlist">';h={hash:{},data:b};if((h=(g=f.tr||a&&a.tr,g?g.call(a,"My Playlist &raquo;",h):m.call(a,"tr","My Playlist &raquo;",h)))||0===h)d+=h;d+='</a>\n    </strong>\n    <a class="no_games_block js-activate-inline-registration" href="#">\n      <span class="plus kong_ico" aria-hidden="true">+</span>\n      <strong class="title"><span class="icon kong_ico" aria-hidden="true">p</span> ';
h={hash:{},data:b};if((h=(g=f.tr||a&&a.tr,g?g.call(a,"My Playlist",h):m.call(a,"tr","My Playlist",h)))||0===h)d+=h;d+='</strong>\n      <span class="desc">';h={hash:{},data:b};if((h=(g=f.tr||a&&a.tr,g?g.call(a,"Register to save games to play later.",h):m.call(a,"tr","Register to save games to play later.",h)))||0===h)d+=h;return d+"</span>\n    </a>\n  </div>\n  \x3c!-- Playlist Games End --\x3e\n  "},g),fn:q.program(1,function(a,b){var g,k,w;g='\n  \x3c!-- Recent Games Start --\x3e\n  <div id="main_nav_games_im_playing" class="main_nav_category my_games_block mrl">\n    ';
if((k=q.invokePartial(c["navigation/games/_recently_played"],"navigation/games/_recently_played",a,f,c,b))||0===k)g+=k;g+='\n  </div>\n  \x3c!-- Recent Games End --\x3e\n  \x3c!-- Recommended Games Start --\x3e\n  <div id="main_nav_recommended_games" class="main_nav_category my_games_block mrl">\n    <strong class="game_block_link">\n      <a href="'+l((k=(k=a&&a.user,null==k||!1===k?k:k.recommended_games_path),typeof k===s?k.apply(a):k))+'" data-metric-tracker="js-wa-tc-Navigation-Recommended">';
w={hash:{},data:b};if((w=(k=f.tr||a&&a.tr,k?k.call(a,"My Recommended &raquo;",w):m.call(a,"tr","My Recommended &raquo;",w)))||0===w)g+=w;g+="</a>\n    </strong>\n    ";if((w=q.invokePartial(c["navigation/games/_games"],"navigation/games/_games",(k=a&&a.games,null==k||!1===k?k:k.recommended),f,c,b))||0===w)g+=w;g+='\n  </div>\n  \x3c!-- Recommended Games End --\x3e\n  \x3c!-- Playlist Games Start --\x3e\n  <div id="main_nav_my_playlist" class="main_nav_category my_games_block mrl">\n    <strong class="game_block_link">\n      <a href="'+
l((k=(k=a&&a.user,null==k||!1===k?k:k.playlist_path),typeof k===s?k.apply(a):k))+'" data-metric-tracker="js-wa-tc-Navigation-Playlist">';w={hash:{},data:b};if((w=(k=f.tr||a&&a.tr,k?k.call(a,"My Playlist &raquo;",w):m.call(a,"tr","My Playlist &raquo;",w)))||0===w)g+=w;g+="</a>\n    </strong>\n    ";if((w=f["if"].call(a,(k=a&&a.games,null==k||!1===k?k:k.playlist),{hash:{},inverse:q.program(4,d,b),fn:q.program(2,h,b),data:b}))||0===w)g+=w;return g+"\n  </div>\n  \x3c!-- Playlist Games End --\x3e\n  "},
g),data:g}))||0===b)a+=b;return a+"\n"}))}).call(this);
(function(){Handlebars.registerPartial("navigation/games/_games",Handlebars.template(function(a,b,f,c,g){function h(a,b){var c,d;c='\n    <a href="';(d=f.game_path)?d=d.call(a,{hash:{},data:b}):(d=a&&a.game_path,d=typeof d===k?d.call(a,{hash:{},data:b}):d);c+=n(d)+'" class="main mbs" data-metric-tracker=\'js-wa-tc-Navigation-';(d=f.metric_category)?d=d.call(a,{hash:{},data:b}):(d=a&&a.metric_category,d=typeof d===k?d.call(a,{hash:{},data:b}):d);c+=n(d)+'\'>\n      <span class="game_icon">\n        <img alt="" src="';
(d=f.icon_path)?d=d.call(a,{hash:{},data:b}):(d=a&&a.icon_path,d=typeof d===k?d.call(a,{hash:{},data:b}):d);c+=n(d)+'" />\n      </span>\n      <span class="name truncate_one_line">';(d=f.title)?d=d.call(a,{hash:{},data:b}):(d=a&&a.title,d=typeof d===k?d.call(a,{hash:{},data:b}):d);return c+=n(d)+"</span>\n    </a>\n  "}function d(a,b){var c,d;c='\n    <a href="';(d=f.game_path)?d=d.call(a,{hash:{},data:b}):(d=a&&a.game_path,d=typeof d===k?d.call(a,{hash:{},data:b}):d);c+=n(d)+"\" class='truncate extra js-wa-tc-Navigation-";
(d=f.metric_category)?d=d.call(a,{hash:{},data:b}):(d=a&&a.metric_category,d=typeof d===k?d.call(a,{hash:{},data:b}):d);c+=n(d)+"'>";(d=f.title)?d=d.call(a,{hash:{},data:b}):(d=a&&a.title,d=typeof d===k?d.call(a,{hash:{},data:b}):d);return c+=n(d)+"</a>\n  "}this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);g=g||{};a="";var k="function",n=this.escapeExpression,x=this;if((b=f.each.call(b,b,{hash:{},inverse:x.noop,fn:x.program(1,function(a,b){var c,g;c="\n  ";if((g=f.unless.call(a,null==b||
!1===b?b:b.index,{hash:{},inverse:x.program(4,d,b),fn:x.program(2,h,b),data:b}))||0===g)c+=g;return c+"\n"},g),data:g}))||0===b)a+=b;return a+"\n"}))}).call(this);
(function(){Handlebars.registerPartial("navigation/games/_links",Handlebars.template(function(a,b,f,c,g){this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);g=g||{};var h,d=this.escapeExpression,k=f.helperMissing;a='\x3c!-- Categories Start --\x3e\n<dl id="main_nav_games_categories" class="main_nav_category">\n  <dt class="main_nav_category_title pbs"><a data-metric-tracker="js-wa-tc-Navigation-Categories" href=\'/games\'>';c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"Categories",
c):k.call(b,"tr","Categories",c)))||0===c)a+=c;a+='</a></dt>\n  <dd class="mtm">\n    <ul class="main_nav_category_list">\n      <li class="featured"><a data-metric-tracker="js-wa-tc-Navigation-Feature" href=\'/top-rated-games\'>';c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"Top Rated",c):k.call(b,"tr","Top Rated",c)))||0===c)a+=c;a+="</a></li>\n      <li><a data-metric-tracker=\"js-wa-tc-Navigation-Categories\" href='/action-games'>";c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,
"Action",c):k.call(b,"tr","Action",c)))||0===c)a+=c;a+="</a></li>\n      <li><a data-metric-tracker=\"js-wa-tc-Navigation-Categories\" href='/multiplayer-games'>";c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"Multiplayer",c):k.call(b,"tr","Multiplayer",c)))||0===c)a+=c;a+='</a></li>\n      <li class="featured"><a data-metric-tracker="js-wa-tc-Navigation-Feature" href=\'/top-rated-games?sort=newest\'>';c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"Hot New",c):k.call(b,"tr","Hot New",
c)))||0===c)a+=c;a+="</a></li>\n      <li><a data-metric-tracker=\"js-wa-tc-Navigation-Categories\" href='/mmo-games'>";c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"MMO",c):k.call(b,"tr","MMO",c)))||0===c)a+=c;a+="</a></li>\n      <li><a data-metric-tracker=\"js-wa-tc-Navigation-Categories\" href='/adventure-rpg-games'>";c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"Adventure &amp; RPG",c):k.call(b,"tr","Adventure &amp; RPG",c)))||0===c)a+=c;a+='</a></li>\n      <li class="featured">\n        ';
if((c=f["if"].call(b,(h=b&&b.user,null==h||!1===h?h:h.authenticated),{hash:{},inverse:this.program(3,function(a,b){var c,d,g;c='\n          <a data-metric-tracker="js-wa-tc-Navigation-Feature" class="js-activate-inline-registration" href="#">\n            <span>';g={hash:{},data:b};if((g=(d=f.tr||a&&a.tr,d?d.call(a,"My Favorites",g):k.call(a,"tr","My Favorites",g)))||0===g)c+=g;return c+"</span>\n          </a>\n        "},g),fn:this.program(1,function(a,b){var c,g,h;c=""+('\n          <a data-metric-tracker="js-wa-tc-Navigation-Feature" href=\''+
d((g=(g=a&&a.user,null==g||!1===g?g:g.favorites_path),"function"===typeof g?g.apply(a):g))+"'>");h={hash:{},data:b};if((h=(g=f.tr||a&&a.tr,g?g.call(a,"My Favorites",h):k.call(a,"tr","My Favorites",h)))||0===h)c+=h;return c+"</a>\n        "},g),data:g}))||0===c)a+=c;a+="\n      </li>\n      <li><a data-metric-tracker=\"js-wa-tc-Navigation-Categories\" href='/strategy-defense-games'>";c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"Strategy &amp; Defense",c):k.call(b,"tr","Strategy &amp; Defense",
c)))||0===c)a+=c;a+="</a></li>\n      <li><a data-metric-tracker=\"js-wa-tc-Navigation-Categories\" href='/shooter-games'>";c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"Shooter",c):k.call(b,"tr","Shooter",c)))||0===c)a+=c;a+="</a></li>\n      <li><a data-metric-tracker=\"js-wa-tc-Navigation-Categories\" href='/idle-games'>";c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"Idle",c):k.call(b,"tr","Idle",c)))||0===c)a+=c;a+="</a></li>\n      <li><a data-metric-tracker=\"js-wa-tc-Navigation-Categories\" href='/upgrades-games'>";
c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"Upgrades",c):k.call(b,"tr","Upgrades",c)))||0===c)a+=c;a+="</a></li>\n      <li><a data-metric-tracker=\"js-wa-tc-Navigation-Categories\" href='/tower-defense-games'>";c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"Tower Defense",c):k.call(b,"tr","Tower Defense",c)))||0===c)a+=c;a+="</a></li>\n      <li><a data-metric-tracker=\"js-wa-tc-Navigation-Categories\" href='/sports-racing-games'>";c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,
"Sports/Racing",c):k.call(b,"tr","Sports/Racing",c)))||0===c)a+=c;a+="</a></li>\n      <li><a data-metric-tracker=\"js-wa-tc-Navigation-Categories\" href='/5-minute-games'>";c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"5 Minute",c):k.call(b,"tr","5 Minute",c)))||0===c)a+=c;a+='</a></li>\n      <li class="more"><a data-metric-tracker="js-wa-tc-Navigation-Categories" href=\'/games\'>';c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"More Categories",c):k.call(b,"tr","More Categories",
c)))||0===c)a+=c;a+='</a></li>\n    </ul>\n  </dd>\n  <dd class="main_nav_sub">\n    <p class="main_nav_sub_title mbs"><em>';c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"For Developers:",c):k.call(b,"tr","For Developers:",c)))||0===c)a+=c;a+='</em></p>\n    <ul class="main_nav_sub_links">\n      <li><a data-metric-tracker="js-wa-tc-Navigation-Developers" href=\'/games/new\'>';c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"Upload your game",c):k.call(b,"tr","Upload your game",c)))||
0===c)a+=c;a+='</a></li>\n      <li><a data-metric-tracker="js-wa-tc-Navigation-Developers" href=\'http://developers.kongregate.com/\' target="_blank">';c={hash:{},data:g};if((c=(h=f.tr||b&&b.tr,h?h.call(b,"Developers Center",c):k.call(b,"tr","Developers Center",c)))||0===c)a+=c;return a+"</a></li>\n    </ul>\n  </dd>\n</dl>\n\x3c!-- Categories End --\x3e\n"}))}).call(this);
(function(){Handlebars.registerPartial("navigation/games/_recently_played",Handlebars.template(function(a,b,f,c,g){this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);c=this.merge(c,a.partials);g=g||{};var h,d,k=this,n=f.helperMissing;a=this.escapeExpression;a=""+('<strong class="game_block_link">\n  <a href="'+a((h=(h=b&&b.user,null==h||!1===h?h:h.recently_played_path),"function"===typeof h?h.apply(b):h))+'" data-metric-tracker="js-wa-tc-Navigation-Recently_Played">');d={hash:{},data:g};if((d=
(h=f.tr||b&&b.tr,h?h.call(b,"Recently Played &raquo;",d):n.call(b,"tr","Recently Played &raquo;",d)))||0===d)a+=d;a+="</a>\n</strong>\n";if((d=f["if"].call(b,(h=b&&b.games,null==h||!1===h?h:h.recently_played),{hash:{},inverse:k.program(3,function(a,b){var c,d,g;c='\n  <a class="no_games_block" href="/games">\n    <span class="plus kong_ico" aria-hidden="true">+</span>\n    <strong class="title">';g={hash:{},data:b};if((g=(d=f.tr||a&&a.tr,d?d.call(a,"Recently Played Games",g):n.call(a,"tr","Recently Played Games",
g)))||0===g)c+=g;c+='</strong>\n    <span class="desc">';g={hash:{},data:b};if((g=(d=f.tr||a&&a.tr,d?d.call(a,"Start playing now.",g):n.call(a,"tr","Start playing now.",g)))||0===g)c+=g;return c+"</span>\n  </a>\n"},g),fn:k.program(1,function(a,b){var d,g,h;d="\n  ";if((h=k.invokePartial(c["navigation/games/_games"],"navigation/games/_games",(g=a&&a.games,null==g||!1===g?g:g.recently_played),f,c,b))||0===h)d+=h;return d+"\n"},g),data:g}))||0===d)a+=d;return a+"\n"}))}).call(this);
(function(){this.HandlebarsTemplates||(this.HandlebarsTemplates={});this.HandlebarsTemplates["navigation/games_tab"]=Handlebars.template(function(a,b,f,c,g){this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);c=this.merge(c,a.partials);g=g||{};var h;a='<div class="main_nav_menu_inner">\n  ';if((h=this.invokePartial(c["navigation/games/_game_lists"],"navigation/games/_game_lists",b,f,c,g))||0===h)a+=h;a+="\n  ";if((h=this.invokePartial(c["navigation/games/_links"],"navigation/games/_links",
b,f,c,g))||0===h)a+=h;return a+"\n</div>\n"});return this.HandlebarsTemplates["navigation/games_tab"]}).call(this);(function(){Handlebars.registerPartial("navigation/mykong/_all_forums",Handlebars.template(function(a,b,f,c,g){this.compilerInfo=[4,">= 1.0.0"];this.merge(f,a.helpers);var h;a=this.escapeExpression;return b=""+('<li class="more"><a class="js-wa-tc-Navigation-Forums" href=\''+a((h=(h=b&&b.forums,null==h||!1===h?h:h.all_forums),"function"===typeof h?h.apply(b):h))+"'>All Forums</a></li>\n")}))}).call(this);
(function(){Handlebars.registerPartial("navigation/mykong/_common_forums",Handlebars.template(function(a,b,f,c,g){this.compilerInfo=[4,">= 1.0.0"];this.merge(f,a.helpers);var h;a=this.escapeExpression;return b=""+('<li><a data-metric-tracker="js-wa-tc-Navigation-Forums" href=\''+a((h=(h=b&&b.forums,null==h||!1===h?h:h.kongregate),"function"===typeof h?h.apply(b):h))+"'>Kongregate</a></li>\n<li><a data-metric-tracker=\"js-wa-tc-Navigation-Forums\" href='"+a((h=(h=b&&b.forums,null==h||!1===h?h:h.game_forums),
"function"===typeof h?h.apply(b):h))+"'>Game Forums</a></li>\n<li><a data-metric-tracker=\"js-wa-tc-Navigation-Forums\" href='"+a((h=(h=b&&b.forums,null==h||!1===h?h:h.general_gaming),"function"===typeof h?h.apply(b):h))+"'>General Gaming</a></li>\n<li><a data-metric-tracker=\"js-wa-tc-Navigation-Forums\" href='"+a((h=(h=b&&b.forums,null==h||!1===h?h:h.technical_support),"function"===typeof h?h.apply(b):h))+"'>Tech Support</a></li>\n<li><a data-metric-tracker=\"js-wa-tc-Navigation-Forums\" href='"+
a((h=(h=b&&b.forums,null==h||!1===h?h:h.game_programming),"function"===typeof h?h.apply(b):h))+"'>Game Development</a></li>\n")}))}).call(this);
(function(){Handlebars.registerPartial("navigation/mykong/_find_friends",Handlebars.template(function(a,b,f,c,g){this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);g=g||{};var h;a=this.escapeExpression;a=""+('<dt class="main_nav_category_title pbs"><a data-metric-tracker="js-wa-tc-Navigation-Find_Friends" href="/accounts/'+a((h=(h=b&&b.user,null==h||!1===h?h:h.username),"function"===typeof h?h.apply(b):h))+'/friends">Find Your Friends &raquo;</a></dt>\n<dd class="mtm">\n  <p>Locate your friends who are already on Kongregate <a data-metric-tracker="js-wa-tc-Navigation-Find_Friends" href="/findyourfriends">using your email contact list &raquo;</a></p>\n  ');
if((b=f.unless.call(b,(h=b&&b.user,null==h||!1===h?h:h.facebook_connected),{hash:{},inverse:this.noop,fn:this.program(1,function(a,b){return'\n    <a href="http://www.kongregate.com/#" data-metric-tracker="js-wa-tc-Navigation-Find_Friends" class="facebook_signin_medium sprite_facebook" onclick="new FacebookAuthenticator({}); return false;" title="Sign in with Facebook">Connect with Facebook</a>\n  '},g),data:g}))||0===b)a+=b;return a+"\n</dd>\n"}))}).call(this);
(function(){Handlebars.registerPartial("navigation/mykong/_mykong_guest",Handlebars.template(function(a,b,f,c,g){this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);c=this.merge(c,a.partials);g=g||{};var h,d,k=f.helperMissing;a='<div class="main_nav_menu_inner">\n  \x3c!-- Account Info Start --\x3e\n  <dl id="main_nav_mykong_activity" class="main_nav_category mrl">\n    <dt class="main_nav_category_title pbs">';d={hash:{},data:g};if((d=(h=f.tr||b&&b.tr,h?h.call(b,"Trending with Friends",d):
k.call(b,"tr","Trending with Friends",d)))||0===d)a+=d;a+='</dt>\n    <dd id="main_nav_activity_upsell" class="mtm">\n      <p><strong>';d={hash:{},data:g};if((d=(h=f.tr||b&&b.tr,h?h.call(b,"Activity Feed",d):k.call(b,"tr","Activity Feed",d)))||0===d)a+=d;a+='</strong></p>\n      <p class="media regtextLrg">\n        <span class="img kong_ico" aria-hidden="true">g</span>\n        <span class="bd"><a href="#" class=\'js-activate-inline-registration\'>';d={hash:{},data:g};if((d=(h=f.tr||b&&b.tr,h?h.call(b,
"Register",d):k.call(b,"tr","Register",d)))||0===d)a+=d;a+="</a>";d={hash:{},data:g};if((d=(h=f.tr||b&&b.tr,h?h.call(b," or ",d):k.call(b,"tr"," or ",d)))||0===d)a+=d;a+="<a href=\"#\" class='js-activate-inline-login'>";d={hash:{},data:g};if((d=(h=f.tr||b&&b.tr,h?h.call(b,"sign in",d):k.call(b,"tr","sign in",d)))||0===d)a+=d;a+="</a>";d={hash:{},data:g};if((d=(h=f.tr||b&&b.tr,h?h.call(b," to start receiving activity updates from around Kongregate!",d):k.call(b,"tr"," to start receiving activity updates from around Kongregate!",
d)))||0===d)a+=d;a+='</span>\n      </p>\n    </dd>\n  </dl>\n  \x3c!-- Account Info End --\x3e\n  \x3c!-- Forums Start --\x3e\n  <dl id="main_nav_mykong_forums" class="main_nav_category">\n    <dt class="main_nav_category_title pbs"><a href="/forums">';d={hash:{},data:g};if((d=(h=f.tr||b&&b.tr,h?h.call(b,"Forums &raquo;",d):k.call(b,"tr","Forums &raquo;",d)))||0===d)a+=d;a+='</a></dt>\n    <dd class="mtm">\n      <ul class="main_nav_category_list">\n        ';if((d=this.invokePartial(c["navigation/mykong/_common_forums"],
"navigation/mykong/_common_forums",b,f,c,g))||0===d)a+=d;a+="\n        ";if((d=this.invokePartial(c["navigation/mykong/_all_forums"],"navigation/mykong/_all_forums",b,f,c,g))||0===d)a+=d;return a+"\n      </ul>\n    </dd>\n  </dl>\n  \x3c!-- Forums End --\x3e\n</div>\n"}))}).call(this);
(function(){Handlebars.registerPartial("navigation/mykong/_mykong_user",Handlebars.template(function(a,b,f,c,g){function h(a,b){var c,g,h;c='\n      <ul class="avatars img">\n        ';if((h=f.each.call(a,(g=a&&a.user,null==g||!1===g?g:g.activity_feed_avatar_data),{hash:{},inverse:u.noop,fn:u.program(9,d,b),data:b}))||0===h)c+=h;c+='\n      </ul>\n      <a href="/community" class="bd" data-metric-tracker="js-wa-tc-Navigation-Activity_Feed">';h={hash:{friend:(g=a&&a.user,null==g||!1===g?g:g.activity_feed_friend_username)},
data:b};if((h=(g=f.tr||a&&a.tr,g?g.call(a,"Get activity updates from <em>{friend}</em> and 3 other friends on Kongregate &raquo;",h):v.call(a,"tr","Get activity updates from <em>{friend}</em> and 3 other friends on Kongregate &raquo;",h)))||0===h)c+=h;return c+"</a>\n      "}function d(a,b){var f,c;return f=""+('\n        <li><a data-metric-tracker="js-wa-tc-Navigation-Activity_Feed" href="/accounts/'+r((c=a&&a.username,typeof c===t?c.apply(a):c))+'"><img alt="'+r((c=a&&a.username,typeof c===t?c.apply(a):
c))+'" src="'+r((c=a&&a.avatar_url,typeof c===t?c.apply(a):c))+'" /></a></li>\n        ')}function k(a,b){var c,d,g;c="\n      ";if((g=f.each.call(a,(d=a&&a.user,null==d||!1===d?d:d.activity_feed_avatar_data),{hash:{},inverse:u.noop,fn:u.program(12,n,b),data:b}))||0===g)c+=g;c+='\n      <a href="/community" class="bd" data-metric-tracker="js-wa-tc-Navigation-Activity_Feed">';g={hash:{friend:(d=a&&a.user,null==d||!1===d?d:d.activity_feed_friend_username)},data:b};if((g=(d=f.tr||a&&a.tr,d?d.call(a,
"Get activity updates from <em>{friend}</em> and other friends on Kongregate &raquo;",g):v.call(a,"tr","Get activity updates from <em>{friend}</em> and other friends on Kongregate &raquo;",g)))||0===g)c+=g;return c+"</a>\n      "}function n(a,b){var f,c;return f=""+(' \n      <a href="/accounts/'+r((c=a&&a.username,typeof c===t?c.apply(a):c))+'" class="avatar img" data-metric-tracker"js-wa-tc-Navigation-Activity_Feed"><img alt="'+r((c=a&&a.username,typeof c===t?c.apply(a):c))+'" src="'+r((c=a&&a.avatar_url,
typeof c===t?c.apply(a):c))+'" /></a>\n      ')}function x(a,b){var c,d,g;c=""+('\n  <dl id="main_nav_mykong_friends" class="main_nav_category mrl">\n    <dt class="main_nav_category_title pbs"><a data-metric-tracker="js-wa-tc-Navigation-Find_Friends" href="/accounts/'+r((d=(d=a&&a.user,null==d||!1===d?d:d.username),typeof d===t?d.apply(a):d))+'/friends">');g={hash:{count:(d=a&&a.user,null==d||!1===d?d:d.friends_online_count)},data:b};if((g=(d=f.tr||a&&a.tr,d?d.call(a,"Friends Online ({count}) &raquo;",
g):v.call(a,"tr","Friends Online ({count}) &raquo;",g)))||0===g)c+=g;c+='</a></dt>\n    <dd class="mtm">\n      <ul class="main_nav_friends_list">\n        ';if((g=f.each.call(a,(d=a&&a.user,null==d||!1===d?d:d.friends_online),{hash:{},inverse:u.noop,fn:u.program(15,q,b),data:b}))||0===g)c+=g;return c+"\n      </ul>\n    </dd>\n  </dl>\n  "}function q(a,b){var c,d,g;c=""+('\n        <li class="media">\n          <a href="/accounts/'+r((d=a&&a.username,typeof d===t?d.apply(a):d))+'" class="img" data-metric-tracker="js-wa-tc-Navigation-Find_Friends">\n            <img alt="" src="'+
r((d=a&&a.avatar_url,typeof d===t?d.apply(a):d))+'" />\n          </a>\n          <span class="bd">\n            <strong><a data-metric-tracker="js-wa-tc-Navigation-Find_Friends" href="/accounts/'+r((d=a&&a.username,typeof d===t?d.apply(a):d))+'">'+r((d=a&&a.username,typeof d===t?d.apply(a):d))+"</a></strong>\n            <em>");g={hash:{},data:b};if((g=(d=f.tr||a&&a.tr,d?d.call(a,"playing ",g):v.call(a,"tr","playing ",g)))||0===g)c+=g;return c+='<a href="'+r((d=a&&a.last_game_url,typeof d===t?d.apply(a):
d))+'">'+r((d=a&&a.last_game_name,typeof d===t?d.apply(a):d))+"</a></em>\n          </span>\n        </li>\n        "}function s(a,b){var d,g;d='\n  <dl id="main_nav_mykong_friends" class="main_nav_category no_friends mrl">\n    ';if((g=u.invokePartial(c["navigation/mykong/_find_friends"],"navigation/mykong/_find_friends",a,f,c,b))||0===g)d+=g;return d+"\n  </dl>\n  "}this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);c=this.merge(c,a.partials);g=g||{};var l,m,v=f.helperMissing,t="function",
r=this.escapeExpression,u=this;a=""+('<div class="main_nav_menu_inner">\n  \x3c!-- Account Info Start --\x3e\n  <ul class="main_nav_profile">\n    \x3c!-- Info Start --\x3e\n    <li class="media main_nav_profile_sec mini_profile_sec">\n      <a href="/accounts/'+r((l=(l=b&&b.user,null==l||!1===l?l:l.username),typeof l===t?l.apply(b):l))+'" class="img" data-metric-tracker="js-wa-tc-Navigation-Profiles"><img alt="" src="'+r((l=(l=b&&b.user,null==l||!1===l?l:l.avatar_url),typeof l===t?l.apply(b):l))+
'" /></a>\n      <div class="bd">\n        <p class="user"><strong><a data-metric-tracker="js-wa-tc-Navigation-Profiles" href="/accounts/'+r((l=(l=b&&b.user,null==l||!1===l?l:l.username),typeof l===t?l.apply(b):l))+'">'+r((l=(l=b&&b.user,null==l||!1===l?l:l.username),typeof l===t?l.apply(b):l))+'<span class="spritesite levelbug level_'+r((l=(l=b&&b.user,null==l||!1===l?l:l.level),typeof l===t?l.apply(b):l))+'" title="Level '+r((l=(l=b&&b.user,null==l||!1===l?l:l.level),typeof l===t?l.apply(b):l))+
'" alt="Levelbug '+r((l=(l=b&&b.user,null==l||!1===l?l:l.level),typeof l===t?l.apply(b):l))+'"></span></a></strong></p>\n        ');if((m=f["if"].call(b,(l=b&&b.user,null==l||!1===l?l:l.is_max_level),{hash:{},inverse:u.program(3,function(a,b){var c,d,g;c='\n          <p class="points">';g={hash:{points_away:(d=a&&a.user,null==d||!1===d?d:d.points_away)},data:b};if((g=(d=f.tr||a&&a.tr,d?d.call(a,"[strong:{points_away} points] needed for the next level",g):v.call(a,"tr","[strong:{points_away} points] needed for the next level",
g)))||0===g)c+=g;c+='</p>\n          <p class="progress">\n            <span class="progress_bar">\n              <span class="progress_percent" style="width:'+r((d=(d=a&&a.user,null==d||!1===d?d:d.progress_bar_width),typeof d===t?d.apply(a):d))+'%"></span>\n            </span>\n            <strong class="level">\n              ';g={hash:{},data:b};if((g=(d=f.tr||a&&a.tr,d?d.call(a,"Level",g):v.call(a,"tr","Level",g)))||0===g)c+=g;return c+='\n              <span class="spritesite levelbug level_'+
r((d=(d=a&&a.user,null==d||!1===d?d:d.next_level),typeof d===t?d.apply(a):d))+'" title="Level '+r((d=(d=a&&a.user,null==d||!1===d?d:d.next_level),typeof d===t?d.apply(a):d))+'" alt="Levelbug '+r((d=(d=a&&a.user,null==d||!1===d?d:d.next_level),typeof d===t?d.apply(a):d))+'"></span>\n            </strong>\n          </p>\n        '},g),fn:u.program(1,function(a,b){var d,c,g;d='\n          <p class="points w_cake"><span class="cake_icon mrm"></span>';g={hash:{},data:b};if((g=(c=f.tr||a&&a.tr,c?c.call(a,
"Whoah, you're at our level cap. Good job, you rock! Here, have some cake.",g):v.call(a,"tr","Whoah, you're at our level cap. Good job, you rock! Here, have some cake.",g)))||0===g)d+=g;return d+"</p>\n        "},g),data:g}))||0===m)a+=m;a+='\n      </div>\n    </li>\n    \x3c!-- Info End --\x3e\n    <li class="main_nav_profile_sec points_sec">\n      <a href=\'/accounts/'+r((l=(l=b&&b.user,null==l||!1===l?l:l.username),typeof l===t?l.apply(b):l))+'/points\' data-metric-tracker="js-wa-tc-Navigation-Points" class="main_nav_profile_link">\n        <span class="num">'+
r((l=(l=b&&b.user,null==l||!1===l?l:l.points),typeof l===t?l.apply(b):l))+"</span>\n        <strong>";m={hash:{},data:g};if((m=(l=f.tr||b&&b.tr,l?l.call(b,"Points",m):v.call(b,"tr","Points",m)))||0===m)a+=m;a+='</strong>\n      </a>\n    </li>\n    <li class="main_nav_profile_sec profile_sec">\n      <a href=\'/accounts/'+r((l=(l=b&&b.user,null==l||!1===l?l:l.username),typeof l===t?l.apply(b):l))+'\' data-metric-tracker="js-wa-tc-Navigation-Profile" class="main_nav_profile_link">\n        <span class="kong_ico" aria-hidden="true">u</span>\n        <strong>';
m={hash:{},data:g};if((m=(l=f.tr||b&&b.tr,l?l.call(b,"Profile",m):v.call(b,"tr","Profile",m)))||0===m)a+=m;a+='</strong>\n      </a>\n    </li>\n    <li class="main_nav_profile_sec settings_sec">\n      <a href=\'/accounts/'+r((l=(l=b&&b.user,null==l||!1===l?l:l.username),typeof l===t?l.apply(b):l))+'/edit\' data-metric-tracker="js-wa-tc-Navigation-Settings" class="main_nav_profile_link">\n        <span class="kong_ico" aria-hidden="true">s</span>\n        <strong>';m={hash:{},data:g};if((m=(l=f.tr||
b&&b.tr,l?l.call(b,"Settings",m):v.call(b,"tr","Settings",m)))||0===m)a+=m;a+='</strong>\n      </a>\n    </li>\n    <li class="main_nav_profile_sec kreds_sec">\n      <a href=\'/accounts/'+r((l=(l=b&&b.user,null==l||!1===l?l:l.username),typeof l===t?l.apply(b):l))+'/kred_account\' data-metric-tracker="js-wa-tc-Navigation-Kreds" class="main_nav_profile_link">\n        <span class="kong_ico" aria-hidden="true">k</span>\n        <strong>';m={hash:{kreds_balance:(l=b&&b.user,null==l||!1===l?l:l.kreds_balance)},
data:g};if((m=(l=f.tr||b&&b.tr,l?l.call(b,"Kreds: {kreds_balance}",m):v.call(b,"tr","Kreds: {kreds_balance}",m)))||0===m)a+=m;a+='</strong>\n      </a>\n    </li>\n    <li class="main_nav_profile_sec messages_sec">\n      <a href=\'/accounts/'+r((l=(l=b&&b.user,null==l||!1===l?l:l.username),typeof l===t?l.apply(b):l))+"/"+r((l=(l=b&&b.user,null==l||!1===l?l:l.message_link_page),typeof l===t?l.apply(b):l))+'\' data-metric-tracker="js-wa-tc-Navigation-Index" class="main_nav_profile_link">\n        <span class="kong_ico" aria-hidden="true">m</span>\n        <strong>';
m={hash:{total_message_count:(l=b&&b.user,null==l||!1===l?l:l.total_message_count)},data:g};if((m=(l=f.tr||b&&b.tr,l?l.call(b,"Unread: {total_message_count}",m):v.call(b,"tr","Unread: {total_message_count}",m)))||0===m)a+=m;a+="</strong>\n      </a>\n    </li>\n  </ul>\n  \x3c!-- Account Info End --\x3e\n  \x3c!-- Activity Start --\x3e\n  ";if((m=f["if"].call(b,(l=b&&b.user,null==l||!1===l?l:l.no_friends),{hash:{},inverse:u.program(7,function(a,b){var d,c,g;d='\n  <dl id="main_nav_mykong_activity" class="main_nav_category mrl">\n    <dt class="main_nav_category_title pbs"><a data-metric-tracker="js-wa-tc-Navigation-Activity_Feed" href="/community">';
g={hash:{},data:b};if((g=(c=f.tr||a&&a.tr,c?c.call(a,"Activity Feed &raquo;",g):v.call(a,"tr","Activity Feed &raquo;",g)))||0===g)d+=g;d+='</a></dt>\n    <dd class="mtm media">\n      ';if((g=f["if"].call(a,(c=a&&a.user,null==c||!1===c?c:c.has_four_friends),{hash:{},inverse:u.noop,fn:u.program(8,h,b),data:b}))||0===g)d+=g;d+="\n\n      ";if((g=f["if"].call(a,(c=a&&a.user,null==c||!1===c?c:c.less_than_four_friends),{hash:{},inverse:u.noop,fn:u.program(11,k,b),data:b}))||0===g)d+=g;d+="\n\n    </dd>\n  </dl>\n  \x3c!-- Activity End --\x3e\n  \x3c!-- Friends Start --\x3e\n  ";
if((g=f["if"].call(a,(c=a&&a.user,null==c||!1===c?c:c.has_friends_online),{hash:{},inverse:u.program(17,s,b),fn:u.program(14,x,b),data:b}))||0===g)d+=g;return d+"\n  \x3c!-- Friends End --\x3e\n  "},g),fn:u.program(5,function(a,b){var d,g;d='\n  <dl id="main_nav_mykong_friends" class="main_nav_category no_activity no_friends mrl">\n    ';if((g=u.invokePartial(c["navigation/mykong/_find_friends"],"navigation/mykong/_find_friends",a,f,c,b))||0===g)d+=g;return d+"\n  </dl>\n  "},g),data:g}))||0===m)a+=
m;a+=' \n  \x3c!-- Forums Start --\x3e\n  <dl id="main_nav_mykong_forums" class="main_nav_category';if((m=f["if"].call(b,(l=b&&b.user,null==l||!1===l?l:l.no_friends),{hash:{},inverse:u.noop,fn:u.program(19,function(a,b){return" no_friends"},g),data:g}))||0===m)a+=m;a+='">\n    <dt class="main_nav_category_title pbs"><a data-metric-tracker="js-wa-tc-Navigation-Forums" href="/forums">';m={hash:{},data:g};if((m=(l=f.tr||b&&b.tr,l?l.call(b,"Forums &raquo;",m):v.call(b,"tr","Forums &raquo;",m)))||0===
m)a+=m;a+='</a></dt>\n    <dd class="mtm">\n      <ul class="main_nav_category_list">\n        ';if((m=u.invokePartial(c["navigation/mykong/_common_forums"],"navigation/mykong/_common_forums",b,f,c,g))||0===m)a+=m;a+="\n        ";if((m=f["if"].call(b,(l=b&&b.user,null==l||!1===l?l:l.moderator),{hash:{},inverse:u.program(23,function(a,b){var d,c,g;d=""+('\n        <li><a data-metric-tracker="js-wa-tc-Navigation-Forums" href=\''+r((c=(c=a&&a.forums,null==c||!1===c?c:c.forum_games),typeof c===t?c.apply(a):
c))+"'>");g={hash:{},data:b};if((g=(c=f.tr||a&&a.tr,c?c.call(a,"Forum Games",g):v.call(a,"tr","Forum Games",g)))||0===g)d+=g;return d+"</a></li>\n        "},g),fn:u.program(21,function(a,b){var d,c,g;d=""+('\n        <li><a data-metric-tracker="js-wa-tc-Navigation-Forums" href=\''+r((c=(c=a&&a.forums,null==c||!1===c?c:c.mod_forum),typeof c===t?c.apply(a):c))+"'>");g={hash:{},data:b};if((g=(c=f.tr||a&&a.tr,c?c.call(a,"Mod Forums",g):v.call(a,"tr","Mod Forums",g)))||0===g)d+=g;return d+"</a></li>\n        "},
g),data:g}))||0===m)a+=m;a+='\n        <li><a data-metric-tracker="js-wa-tc-Navigation-Forums" href=\''+r((l=(l=b&&b.forums,null==l||!1===l?l:l.off_topic),typeof l===t?l.apply(b):l))+"'>";m={hash:{},data:g};if((m=(l=f.tr||b&&b.tr,l?l.call(b,"Off-Topic",m):v.call(b,"tr","Off-Topic",m)))||0===m)a+=m;a+="</a></li>\n        ";if((m=u.invokePartial(c["navigation/mykong/_all_forums"],"navigation/mykong/_all_forums",b,f,c,g))||0===m)a+=m;return a+"\n      </ul>\n    </dd>\n  </dl>\n  \x3c!-- Forums End --\x3e\n</div>\n"}))}).call(this);
(function(){this.HandlebarsTemplates||(this.HandlebarsTemplates={});this.HandlebarsTemplates["navigation/mykong_tab"]=Handlebars.template(function(a,b,f,c,g){this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);c=this.merge(c,a.partials);g=g||{};a="";var h,d=this;if((b=f["if"].call(b,(h=b&&b.user,null==h||!1===h?h:h.authenticated),{hash:{},inverse:d.program(3,function(a,b){var g,h;g="\n  ";if((h=d.invokePartial(c["navigation/mykong/_mykong_guest"],"navigation/mykong/_mykong_guest",a,f,c,b))||
0===h)g+=h;return g+"\n"},g),fn:d.program(1,function(a,b){var g,h;g="\n  ";if((h=d.invokePartial(c["navigation/mykong/_mykong_user"],"navigation/mykong/_mykong_user",a,f,c,b))||0===h)g+=h;return g+"\n"},g),data:g}))||0===b)a+=b;return a+"\n"});return this.HandlebarsTemplates["navigation/mykong_tab"]}).call(this);
(function(a){function b(a,b){return function(c){return n(a.call(this,c),b)}}function f(a){return function(b){return this.lang().ordinal(a.call(this,b))}}function c(){}function g(a){d(this,a)}function h(a){var b=this._data={},c=a.years||a.year||a.y||0,d=a.months||a.month||a.M||0,f=a.weeks||a.week||a.w||0,g=a.days||a.day||a.d||0,h=a.hours||a.hour||a.h||0,l=a.minutes||a.minute||a.m||0,n=a.seconds||a.second||a.s||0;a=a.milliseconds||a.millisecond||a.ms||0;this._milliseconds=a+1E3*n+6E4*l+36E5*h;this._days=
g+7*f;this._months=d+12*c;b.milliseconds=a%1E3;n+=k(a/1E3);b.seconds=n%60;l+=k(n/60);b.minutes=l%60;h+=k(l/60);b.hours=h%24;g+=k(h/24);g+=7*f;b.days=g%30;d+=k(g/30);b.months=d%12;c+=k(d/12);b.years=c}function d(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function k(a){return 0>a?Math.ceil(a):Math.floor(a)}function n(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c}function x(a,b,c){var d=b._milliseconds,f=b._days;b=b._months;d&&a._d.setTime(+a+d*c);f&&a.date(a.date()+f*c);b&&(d=
a.date(),a.date(1).month(a.month()+b*c).date(Math.min(d,a.daysInMonth())))}function q(a,b){var c=Math.min(a.length,b.length),d=Math.abs(a.length-b.length),f=0,g;for(g=0;g<c;g++)~~a[g]!==~~b[g]&&f++;return f+d}function s(a){if(!a)return p.fn._lang;!C[a]&&J&&require("./lang/"+a);return C[a]}function l(a){var b=a.match(K),c,d;c=0;for(d=b.length;c<d;c++)b[c]=z[b[c]]?z[b[c]]:b[c].match(/\[.*\]/)?b[c].replace(/^\[|\]$/g,""):b[c].replace(/\\/g,"");return function(f){var g="";for(c=0;c<d;c++)g+="function"===
typeof b[c].call?b[c].call(f,a):b[c];return g}}function m(a,b){function c(b){return a.lang().longDateFormat(b)||b}for(var d=5;d--&&L.test(b);)b=b.replace(L,c);D[b]||(D[b]=l(b));return D[b](a)}function v(a){switch(a){case "DDDD":return Q;case "YYYY":return R;case "YYYYY":return S;case "S":case "SS":case "SSS":case "DDD":return T;case "MMM":case "MMMM":case "dd":case "ddd":case "dddd":case "a":case "A":return U;case "X":return V;case "Z":case "ZZ":return M;case "T":return W;case "MM":case "DD":case "YY":case "HH":case "hh":case "mm":case "ss":case "M":case "D":case "d":case "H":case "h":case "m":case "s":return X;
default:return RegExp(a.replace("\\",""))}}function t(a){var b,c=[];if(!a._d){for(b=0;7>b;b++)a._a[b]=c[b]=null==a._a[b]?2===b?1:0:a._a[b];c[3]+=a._tzh||0;c[4]+=a._tzm||0;b=new Date(0);a._useUTC?(b.setUTCFullYear(c[0],c[1],c[2]),b.setUTCHours(c[3],c[4],c[5],c[6])):(b.setFullYear(c[0],c[1],c[2]),b.setHours(c[3],c[4],c[5],c[6]));a._d=b}}function r(a){var b=a._f.match(K),c=a._i,d,f;a._a=[];for(d=0;d<b.length;d++)if((f=(v(b[d]).exec(c)||[])[0])&&(c=c.slice(c.indexOf(f)+f.length)),z[b[d]]){var g=a,h=void 0,
k=g._a;switch(b[d]){case "M":case "MM":k[1]=null==f?0:~~f-1;break;case "MMM":case "MMMM":h=s(g._l).monthsParse(f);null!=h?k[1]=h:g._isValid=!1;break;case "D":case "DD":case "DDD":case "DDDD":null!=f&&(k[2]=~~f);break;case "YY":k[0]=~~f+(68<~~f?1900:2E3);break;case "YYYY":case "YYYYY":k[0]=~~f;break;case "a":case "A":g._isPm="pm"===(f+"").toLowerCase();break;case "H":case "HH":case "h":case "hh":k[3]=~~f;break;case "m":case "mm":k[4]=~~f;break;case "s":case "ss":k[5]=~~f;break;case "S":case "SS":case "SSS":k[6]=
~~(1E3*("0."+f));break;case "X":g._d=new Date(1E3*parseFloat(f));break;case "Z":case "ZZ":g._useUTC=!0;if((h=(f+"").match(Y))&&h[1])g._tzh=~~h[1];h&&h[2]&&(g._tzm=~~h[2]);h&&"+"===h[0]&&(g._tzh=-g._tzh,g._tzm=-g._tzm)}null==f&&(g._isValid=!1)}a._isPm&&12>a._a[3]&&(a._a[3]+=12);!1===a._isPm&&12===a._a[3]&&(a._a[3]=0);t(a)}function u(a,b,c,d,f){return f.relativeTime(b||1,!!c,a,d)}function w(a,b,c){b=c-b;c-=a.day();c>b&&(c-=7);c<b-7&&(c+=7);return Math.ceil(p(a).add("d",c).dayOfYear()/7)}function G(b){var c=
b._i,f=b._f;if(null===c||""===c)return null;"string"===typeof c&&(b._i=c=s().preparse(c));if(p.isMoment(c))b=d({},c),b._d=new Date(+c._d);else if(f)if("[object Array]"===Object.prototype.toString.call(f)){for(var c=b,h,k,l=99;c._f.length;){h=d({},c);h._f=c._f.pop();r(h);f=new g(h);if(f.isValid()){k=f;break}h=q(h._a,f.toArray());h<l&&(l=h,k=f)}d(c,k)}else r(b);else if(k=b,c=k._i,f=Z.exec(c),c===a)k._d=new Date;else if(f)k._d=new Date(+f[1]);else if("string"===typeof c)if(f=k._i,aa.exec(f)){k._f="YYYY-MM-DDT";
for(c=0;4>c;c++)if(N[c][1].exec(f)){k._f+=N[c][0];break}M.exec(f)&&(k._f+=" Z");r(k)}else k._d=new Date(f);else"[object Array]"===Object.prototype.toString.call(c)?(k._a=c.slice(0),t(k)):k._d=c instanceof Date?new Date(+c):new Date(c);return new g(b)}function H(a,b){p.fn[a]=p.fn[a+"s"]=function(a){var c=this._isUTC?"UTC":"";return null!=a?(this._d["set"+c+b](a),this):this._d["get"+c+b]()}}function B(a){p.duration.fn[a]=function(){return this._data[a]}}function I(a,b){p.duration.fn["as"+a]=function(){return+this/
b}}for(var p,A=Math.round,y,C={},J="undefined"!==typeof module&&module.exports,Z=/^\/?Date\((\-?\d+)/i,K=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,L=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,X=/\d\d?/,T=/\d{1,3}/,Q=/\d{3}/,R=/\d{1,4}/,S=/[+\-]?\d{1,6}/,U=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i,M=/Z|[\+\-]\d\d:?\d\d/i,W=/T/i,V=/[\+\-]?\d+(\.\d{1,3})?/,
aa=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,N=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Y=/([\+\-]|\d\d)/gi,E="Month Date Hours Minutes Seconds Milliseconds".split(" "),F={Milliseconds:1,Seconds:1E3,Minutes:6E4,Hours:36E5,Days:864E5,Months:2592E6,Years:31536E6},D={},O="DDD w W M D d".split(" "),P="MDHhmswW".split(""),z={M:function(){return this.month()+1},MMM:function(a){return this.lang().monthsShort(this,
a)},MMMM:function(a){return this.lang().months(this,a)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(a){return this.lang().weekdaysMin(this,a)},ddd:function(a){return this.lang().weekdaysShort(this,a)},dddd:function(a){return this.lang().weekdays(this,a)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return n(this.year()%100,2)},YYYY:function(){return n(this.year(),4)},YYYYY:function(){return n(this.year(),
5)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return n(~~(this.milliseconds()/10),2)},SSS:function(){return n(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";0>a&&(a=-a,b="-");
return b+n(~~(a/60),2)+":"+n(~~a%60,2)},ZZ:function(){var a=-this.zone(),b="+";0>a&&(a=-a,b="-");return b+n(~~(10*a/6),4)},X:function(){return this.unix()}};O.length;)y=O.pop(),z[y+"o"]=f(z[y]);for(;P.length;)y=P.pop(),z[y+y]=b(z[y],2);z.DDDD=b(z.DDD,3);c.prototype={set:function(a){var b,c;for(c in a)b=a[c],"function"===typeof b?this[c]=b:this["_"+c]=b},_months:"January February March April May June July August September October November December".split(" "),months:function(a){return this._months[a.month()]},
_monthsShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),monthsShort:function(a){return this._monthsShort[a.month()]},monthsParse:function(a){var b,c;this._monthsParse||(this._monthsParse=[]);for(b=0;12>b;b++)if(this._monthsParse[b]||(c=p([2E3,b]),c="^"+this.months(c,"")+"|^"+this.monthsShort(c,""),this._monthsParse[b]=RegExp(c.replace(".",""),"i")),this._monthsParse[b].test(a))return b},_weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),weekdays:function(a){return this._weekdays[a.day()]},
_weekdaysShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),weekdaysShort:function(a){return this._weekdaysShort[a.day()]},_weekdaysMin:"Su Mo Tu We Th Fr Sa".split(" "),weekdaysMin:function(a){return this._weekdaysMin[a.day()]},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(a){var b=this._longDateFormat[a];!b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,
function(a){return a.slice(1)}),this._longDateFormat[a]=b);return b},meridiem:function(a,b,c){return 11<a?c?"pm":"PM":c?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},calendar:function(a,b){var c=this._calendar[a];return"function"===typeof c?c.apply(b):c},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",
dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(a,b,c,d){var f=this._relativeTime[c];return"function"===typeof f?f(a,b,c,d):f.replace(/%d/i,a)},pastFuture:function(a,b){var c=this._relativeTime[0<a?"future":"past"];return"function"===typeof c?c(b):c.replace(/%s/i,b)},ordinal:function(a){return this._ordinal.replace("%d",a)},_ordinal:"%d",preparse:function(a){return a},postformat:function(a){return a},week:function(a){return w(a,this._week.dow,this._week.doy)},
_week:{dow:0,doy:6}};p=function(a,b,c){return G({_i:a,_f:b,_l:c,_isUTC:!1})};p.utc=function(a,b,c){return G({_useUTC:!0,_isUTC:!0,_l:c,_i:a,_f:b})};p.unix=function(a){return p(1E3*a)};p.duration=function(a,b){var c=p.isDuration(a),d="number"===typeof a,f=c?a._data:d?{}:a;d&&(b?f[b]=a:f.milliseconds=a);d=new h(f);c&&a.hasOwnProperty("_lang")&&(d._lang=a._lang);return d};p.version="2.0.0";p.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";p.lang=function(a,b){if(!a)return p.fn._lang._abbr;b?(b.abbr=a,C[a]||(C[a]=
new c),C[a].set(b)):C[a]||s(a);p.duration.fn._lang=p.fn._lang=s(a)};p.langData=function(a){a&&(a._lang&&a._lang._abbr)&&(a=a._lang._abbr);return s(a)};p.isMoment=function(a){return a instanceof g};p.isDuration=function(a){return a instanceof h};p.fn=g.prototype={clone:function(){return p(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1E3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._d},toJSON:function(){return p.utc(this).format("YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},
toArray:function(){return[this.year(),this.month(),this.date(),this.hours(),this.minutes(),this.seconds(),this.milliseconds()]},isValid:function(){null==this._isValid&&(this._isValid=this._a?!q(this._a,(this._isUTC?p.utc(this._a):p(this._a)).toArray()):!isNaN(this._d.getTime()));return!!this._isValid},utc:function(){this._isUTC=!0;return this},local:function(){this._isUTC=!1;return this},format:function(a){a=m(this,a||p.defaultFormat);return this.lang().postformat(a)},add:function(a,b){var c;c="string"===
typeof a?p.duration(+b,a):p.duration(a,b);x(this,c,1);return this},subtract:function(a,b){var c;c="string"===typeof a?p.duration(+b,a):p.duration(a,b);x(this,c,-1);return this},diff:function(a,b,c){a=this._isUTC?p(a).utc():p(a).local();var d=6E4*(this.zone()-a.zone()),f;b&&(b=b.replace(/s$/,""));"year"===b||"month"===b?(d=432E5*(this.daysInMonth()+a.daysInMonth()),f=12*(this.year()-a.year())+(this.month()-a.month()),f+=(this-p(this).startOf("month")-(a-p(a).startOf("month")))/d,"year"===b&&(f/=12)):
(d=this-a-d,f="second"===b?d/1E3:"minute"===b?d/6E4:"hour"===b?d/36E5:"day"===b?d/864E5:"week"===b?d/6048E5:d);return c?f:k(f)},from:function(a,b){return p.duration(this.diff(a)).lang(this.lang()._abbr).humanize(!b)},fromNow:function(a){return this.from(p(),a)},calendar:function(){var a=this.diff(p().startOf("day"),"days",!0);return this.format(this.lang().calendar(-6>a?"sameElse":-1>a?"lastWeek":0>a?"lastDay":1>a?"sameDay":2>a?"nextDay":7>a?"nextWeek":"sameElse",this))},isLeapYear:function(){var a=
this.year();return 0===a%4&&0!==a%100||0===a%400},isDST:function(){return this.zone()<p([this.year()]).zone()||this.zone()<p([this.year(),5]).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null==a?b:this.add({d:a-b})},startOf:function(a){a=a.replace(/s$/,"");switch(a){case "year":this.month(0);case "month":this.date(1);case "week":case "day":this.hours(0);case "hour":this.minutes(0);case "minute":this.seconds(0);case "second":this.milliseconds(0)}"week"===a&&
this.day(0);return this},endOf:function(a){return this.startOf(a).add(a.replace(/s?$/,"s"),1).subtract("ms",1)},isAfter:function(a,b){b="undefined"!==typeof b?b:"millisecond";return+this.clone().startOf(b)>+p(a).startOf(b)},isBefore:function(a,b){b="undefined"!==typeof b?b:"millisecond";return+this.clone().startOf(b)<+p(a).startOf(b)},isSame:function(a,b){b="undefined"!==typeof b?b:"millisecond";return+this.clone().startOf(b)===+p(a).startOf(b)},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},
daysInMonth:function(){return p.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(a){var b=A((p(this).startOf("day")-p(this).startOf("year"))/864E5)+1;return null==a?b:this.add("d",a-b)},isoWeek:function(a){var b=w(this,1,4);return null==a?b:this.add("d",7*(a-b))},week:function(a){var b=this.lang().week(this);return null==a?b:this.add("d",7*(a-b))},lang:function(b){if(b===a)return this._lang;this._lang=s(b);return this}};for(y=0;y<E.length;y++)H(E[y].toLowerCase().replace(/s$/,""),E[y]);
H("year","FullYear");p.fn.days=p.fn.day;p.fn.weeks=p.fn.week;p.fn.isoWeeks=p.fn.isoWeek;p.duration.fn=h.prototype={weeks:function(){return k(this.days()/7)},valueOf:function(){return this._milliseconds+864E5*this._days+2592E6*this._months},humanize:function(a){var b=+this,c;c=!a;var d=this.lang(),f=A(Math.abs(b)/1E3),g=A(f/60),h=A(g/60),k=A(h/24),l=A(k/365),f=45>f&&["s",f]||1===g&&["m"]||45>g&&["mm",g]||1===h&&["h"]||22>h&&["hh",h]||1===k&&["d"]||25>=k&&["dd",k]||45>=k&&["M"]||345>k&&["MM",A(k/30)]||
1===l&&["y"]||["yy",l];f[2]=c;f[3]=0<b;f[4]=d;c=u.apply({},f);a&&(c=this.lang().pastFuture(b,c));return this.lang().postformat(c)},lang:p.fn.lang};for(y in F)F.hasOwnProperty(y)&&(I(y,F[y]),B(y.toLowerCase()));I("Weeks",6048E5);p.lang("en",{ordinal:function(a){var b=a%10;return a+(1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")}});J&&(module.exports=p);"undefined"===typeof ender&&(this.moment=p);"function"===typeof define&&define.amd&&define("moment",[],function(){return p})}).call(this);
KonduitEvent={INIT:"init",CONNECT:"connect",CONNECTED:"connected",DISCONNECT:"disconnect",LOGIN:"login",SWITCH_USER:"switch_user",JOIN_ROOM:"join_room",LEAVE_ROOM:"leave_room",USER_JOIN:"user_join",USER_DEPARTURE:"user_departure",USER_CHANGED:"user_changed",ROOM_MESSAGE:"room_message",SYSTEM_MESSAGE:"system_message",PRIVATE_MESSAGE:"private_message",ADMIN_MESSAGE:"admin_message",MESSAGE_ERROR:"message_error",SET_PRESENCE:"set_presence",GUEST_COUNT:"guest_count",ROOM_NOT_FOUND:"room_not_found",ROOM_FULL:"room_full",
REQUEST_CHAT_ROOM:"request_chat_room",CREATE_PRIVATE_ROOM:"create_private_room",DESTROY_PRIVATE_ROOM:"destroy_private_room",PRIVATE_ROOM_INVITATION:"private_room_invitation",PRIVATE_ROOM_KICK:"private_room_kick",PRIVATE_ROOM_INVITATION_SENT:"private_room_invitation_sent",JOIN_GUILD_ROOM:"join_guild_room",SILENCED:"silenced",PARTICIPATE:"participate",AMNESTY:"amnesty",API_INITIALIZED:"api_initialized",ADD_STATISTICS:"add_statistics",STATISTIC_UPDATED:"statistic_updated",STATISTIC_SUBMISSION:"statistic_submission",
STATISTICS_FLUSH:"statistics_flush",STATISTICS_FORCE_FLUSH:"statistics_force_flush",SET_ACCOMPLISHMENT_PROGRESS:"set_accomplishment_progress",NEW_HIGH_SCORE:"new_high_score",DISPLAY_SHOUT_BOX:"display_shout_box",DISPLAY_INVITATION_BOX:"display_invitation_box",SEND_PRIVATE_MESSAGE:"send_private_message",DISPLAY_FEED_POST_BOX:"display_feed_post_box",DISPLAY_SIGN_IN_LIGHTBOX:"display_sign_in_lightbox",DISPLAY_REGISTRATION_LIGHTBOX:"display_registration_lightbox",LIGHTBOX_OPENED:"lightbox_opened",LIGHTBOX_CLOSED:"lightbox_closed",
ACCOMPLISHMENT_TASK_PROGRESS:"accomplishment_task_progress",ACCOMPLISHMENT_COMPLETE:"accomplishment_complete",RESIZE_GAME:"resize_game",HANDLE_ITEM_CHECKOUT_REQUEST:"handle_item_checkout_request",KONDUIT_MESSAGE:"konduit_message",ANALYTICS_PAYLOAD:"analytics_payload",OP_EXTERNAL_MESSAGE:"ext.msg",OP_CONNECTED:"connected",OP_HELLO:"hello",OP_USER_INFO:"user.info",OP_SIGN_IN:"sign_in",PARAM_USER:"user",PARAM_USER_ID:"user_id",PARAM_GAME_AUTH_TOKEN:"auth_token",PURCHASE_RESULT:"purchase_result",PARAM_LOCALCONNECTION_ONLY:"localconnection_only",
CUSTOM_TAB_MESSAGE:"custom_tab_message",CUSTOM_TAB_SHOW:"custom_tab_show",CUSTOM_TAB_CLOSE:"custom_tab_close",CUSTOM_TAB_SHOWN:"custom_tab_shown",CUSTOM_TAB_CLEAR_MESSAGES:"custom_tab_clear_messages",OP_CHAT_TAB:"chat.tab",OP_CHAT_CLEAR_DIALOG:"chat.dlg.clear",OP_CHAT_DISPLAY:"chat.disp",OP_CHAT_MSG:"chat.msg",OP_CHAT_CANVAS_ELEMENT:"chat.elm",OP_CHAT_PRIVATE_MESSAGE:"chat.privateMessage",OP_CHAT_RESIZE_GAME:"chat.resizeGame",OP_CHAT_DISPLAY_INVITATION_BOX:"chat.invite",OP_CHAT_DISPLAY_FEED_POST_BOX:"chat.feedpost",
OP_CHAT_DISPLAY_REGISTRATION:"chat.registration",OP_CHAT_DISPLAY_SHOUT_BOX:"chat.shoutbox",PARAM_SHOUT_MESSAGE:"shout_message",PARAM_CANVAS_SIZE:"chat.canvas.size",PARAM_RESIZE_GAME_WIDTH:"chat.resizeGame.width",PARAM_RESIZE_GAME_HEIGHT:"chat.resizeGame.height",PARAM_INVITATION_MESSAGE:"invitation_message",PARAM_FRIEND_FILTER:"filter",PARAM_IMAGE_URI:"image_uri",PARAM_KV_PARAMS:"kv_params",PARAM_NAME:"name",PARAM_DESCRIPTION:"desc",PARAM_DATA:"data",OP_SHOUT_CALLBACK:"ext.shout_callback",PARAM_MESSAGE_TYPE:"ext.message_type",
PARAM_MESSAGE_RECIPIENTS:"ext.message_recipients",PARAM_ERROR:"error",PARAM_SUCCESS:"success",PARAM_REQUEST_ID:"req.id",OP_STATS_SUBMIT:"stat.submit",PARAM_STATS:"stats",ITEM_LIST:"mtx.item_list",ITEM_CHECKOUT:"mtx.checkout",PURCHASE_KREDS:"mtx.kred_purchase",ITEM_INSTANCES:"mtx.item_instances",USE_ITEM_INSTANCE:"mtx.use_item_instance",PARAM_PURCHASE_METHOD:"purchase_method",PARAM_ITEM_TAGS:"item_tags",PARAM_ITEMS:"items",PARAM_ORDER_INFO:"order_info",PARAM_ID:"id",ADS_INITIALIZE:"ads.initialize",
ADS_AVAILABLE:"ads.available",ADS_UNAVAILABLE:"ads.unavailable",ADS_SHOW_INCENTIVIZED:"ads.show_incentivized",AD_OPENED:"ads.ad_opened",AD_COMPLETED:"ads.ad_completed",AD_ABANDONED:"ads.ad_abandoned",PROCESSING_SAVE_SHARED_CONTENT:"processing_save_shared_content",SAVE_SHARED_CONTENT:"save_shared_content",SAVE_SHARED_CONTENT_COMPLETE:"shared_content_save_complete",LOAD_SHARED_CONTENT:"load_shared_content",BROWSE_SHARED_CONTENT:"browse_shared_content",OP_SAVE_SHARED_CONTENT:"save_shared_content",OP_BROWSE_SHARED_CONTENT:"browse_shared_content",
OP_LOAD_SHARED_CONTENT:"load_shared_content",OP_SHARED_CONTENT_SAVE_COMPLETE:"shared_content_save_complete",PARAM_CONTENT_TYPE:"content_type",PARAM_LABEL:"label",PARAM_IMAGE:"image",PARAM_PERMALINK:"permalink",OP_IMAGE_AVATAR_SUBMIT:"avatar.submit",OP_IMAGE_AVATAR_FINISHED:"avatar.finished",IMAGE_AVATAR_SUBMIT:"image_avatar_submit",IMAGE_AVATAR_COMPLETE:"image_avatar_complete",OP_ANALYTICS_PAYLOAD:"analytics.payload",HOLODECK_DATA:"holodeck_data",PARAM_HOLODECK_TYPE:"holodeck_type",FETCH_HISTORY:"fetch_history",
HISTORY_RECEIVED:"history_received",FAYE_DISCONNECT:"faye_disconnect"};KonduitChatErrorMessage={MESSAGE_TOO_LONG:"error_msg_too_long",RATE_LIMITED:"error_msg_rate_limit"};KonduitPresenceType={CHAT:"chat",AWAY:"away"};
function subjectChanged(a){if($("select_type")){var b=$F("select_type");b&&""!==b&&$("abuse_form_submit").enable();"ForumBanRequest"==b&&updateDescriptionPrompt(!0,a," Feel free to include links to specific forum posts:");"InappropriateChatReport"==b&&updateDescriptionPrompt(!0,a," We don't need chat logs:");("OtherAbuseReport"==b||"UnderageUserReport"==b||"PermabanRequest"==b)&&updateDescriptionPrompt(!0,a,"");("InappropriateUsernameReport"==b||"InappropriateAvatarReport"==b||"InappropriateProfileReport"==
b)&&updateDescriptionPrompt(!1,a,"")}}function updateDescriptionPrompt(a,b,f){b="Please describe your reason for reporting "+b+" using as much detail as possible."+f;a?$("abuse_report_description_label_block").update(b):$("abuse_report_description_label_block").update("Please add any other information that would be helpful.");$("description_field").show()}
function upd(a,b,f){a.checked||"always"==f?(f&&(index=a.id.substring(a.id.indexOf("[")+1,a.id.indexOf("]")),radio_id="handle["+index+"]",$(radio_id).checked="handle"),b&&b.show()):b&&b.hide()}
$j(function(){$(document).on("click",".js-activate-inline-login",function(a){active_user.isAuthenticated()||(a.preventDefault(),active_user.activateInlineLogin())});$(document).on("click",".js-activate-inline-registration",function(a){active_user.isAuthenticated()||(a.preventDefault(),active_user.activateInlineLogin({},!0))})});AjaxFileUploader=function(a){this.initialize(a)};
AjaxFileUploader.prototype={initialize:function(a){this._config=a;this._single_image=a.single_image;this._single_image=a.currentImageUrl||a.inputName&&a.inputName.match(/game_icon/)||this._single_image;var b={element:$(a.elementName),request:{endpoint:a.endpoint,forceMultipart:!0,inputName:a.inputName,params:a.params},multiple:!1,validation:{allowedExtensions:a.allowedExtensions||["jpeg","jpg","gif","png"]},failedUploadTextDisplay:{mode:"custom",responseProperty:"errors"},callbacks:{onComplete:this.onCompleteCallback.bind(this)},
text:{uploadButton:'<span id="game-icon-upload-button">Choose file</span>',dragZone:Prototype.Browser.IE?" ":"Drop files here to upload"},dragAndDrop:{hideDropzones:!1}};a.currentImageUrl?(b.text.uploadButton='<span id="game-icon-upload-button">Change image</span>',b.text.dragZone='<img src="'+a.currentImageUrl+'" alt="game icon" class="fineuploader_preview"/>'):a.screenshots&&(b.text.uploadButton='<span id="game-icon-upload-button">Choose screenshot</span>');this._uploader=new qq.FineUploader(b);
if(a.screenshots)for(b=0;b<a.screenshots.length;b++)$$("#"+this._config.elementName+" .qq-upload-button").first().insert({after:this.screenshotDiv(a.screenshots[b])})},screenshotDiv:function(a){var b="",b='<div id="screenshot'+a.id+'" class="screenshot_img mtm">',b=b+("<a href='"+a.url+"' onclick='window.open(this.href);return false;'>"),b=b+('<img src="'+a.url+'" alt="image" />'),b=b+"</a>"+("<a href='#' onclick='AjaxFileUploader.prototype.destroyScreenshot("+a.id+"); return false' class='close_button h6'>Remove</a>");
return b+="</div>"},destroyScreenshot:function(a){new Ajax.Request(document.location.pathname.replace("edit","screenshots/"+a).replace("version/new","screenshots/"+a),{method:"delete",onComplete:function(){$("screenshot"+a).remove()}})},onCompleteCallback:function(a,b,f){f.success&&(this._single_image?($("game-icon-upload-button").update("Change image"),$$("#"+this._config.elementName+" .qq-upload-drop-area span").first().update('<img src="'+f.filename+'" alt="uploaded image" class="fineuploader_preview"/>')):
$$("#"+this._config.elementName+" .qq-upload-button").first().insert({after:this.screenshotDiv({url:f.filename,id:f.id})}))}};AvailabilityCheck=function(a,b){this.initialize(a,b)};
AvailabilityCheck.prototype={initialize:function(a,b){b||(b={});this.text_input=a;this.form_block=a.up(".form_block");this.generatedUsername=b.generatedUsername;this.validateLength=!!b.validateLength;this.blurHandler=this.request=null;this.show_checking=b.show_checking||function(){this.clear();this.form_block.insert({bottom:(new Element("span",{"class":"name_validation"})).update(tr8nProxy.tr("Checking availability&hellip;"))})};this.clear=b.clear||function(){$$(".name_validation").each(Element.remove)};
this.success=b.success||function(){this.clear();this.form_block.insert({bottom:(new Element("span",{"class":"name_validation validation_symbol availability_success"})).update(tr8nProxy.tr("Username available"))})};this.failure=b.failure||function(a){this.clear();this.form_block.insert({bottom:(new Element("span",{"class":"name_validation validation_symbol availability_failure"})).update(tr8nProxy.tr(a))})};Event.observe(a,"blur",this.blur.bind(this));Event.observe(a,"keyup",this.keyup.bind(this))},
blur:function(a){(this.checker||a.target.value)&&this.makeRequest(a)},keyup:function(a){this.request&&(this.request.transport.abort(),this.request=null,this.clear());this.checker&&clearTimeout(this.checker);this.checker=setTimeout(this.makeRequest.bind(this,a),1E3)},makeRequest:function(a){var b=a.target.value;if(this.generatedUsername&&this.generatedUsername==b)this.clear(),this.success();else if(0==b.length)this.validateLength&&(this.clear(),this.failure("Username can't be blank"));else if(4>b.length)this.validateLength&&
(this.clear(),this.failure("Username is too short"));else if(16<b.length)this.validateLength&&(this.clear(),this.failure("Username is too long"));else if(null==this.request){this.show_checking();var f=this;this.request=new Ajax.Request("/accounts/availability",{parameters:{username:a.target.value},method:"get",onSuccess:function(a){a=String(a.responseText).evalJSON();f.clear();a.success?f.success():f.failure(a.error)}})}}};
function hideAllButOne(a,b){$$(a).each(function(a){Element.hide(a)});Element.show(b)}
Base64=function(){return{encode:function(a){var b="",f,c,g,h,d,k,n=0;a=a.replace(/\r\n/g,"\n");c="";g=0;for(h=a.length;g<h;g++)f=a.charCodeAt(g),128>f?c+=String.fromCharCode(f):(127<f&&2048>f?c+=String.fromCharCode(f>>6|192):(c+=String.fromCharCode(f>>12|224),c+=String.fromCharCode(f>>6&63|128)),c+=String.fromCharCode(f&63|128));for(a=c;n<a.length;)f=a.charCodeAt(n++),c=a.charCodeAt(n++),g=a.charCodeAt(n++),h=f>>2,f=(f&3)<<4|c>>4,d=(c&15)<<2|g>>6,k=g&63,isNaN(c)?d=k=64:isNaN(g)&&(k=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);return b},decode:function(a){var b="",f,c,g,h,d,k=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");k<a.length;)f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(k++)),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(k++)),
h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(k++)),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(k++)),f=f<<2|c>>4,c=(c&15)<<4|h>>2,g=(h&3)<<6|d,b+=String.fromCharCode(f),64!=h&&(b+=String.fromCharCode(c)),64!=d&&(b+=String.fromCharCode(g));a=b;b="";for(d=c1=c2=h=0;h<a.length;)d=a.charCodeAt(h),128>d?(b+=String.fromCharCode(d),h++):191<d&&224>d?(c2=a.charCodeAt(h+1),b+=String.fromCharCode((d&31)<<6|c2&63),h+=2):(c2=
a.charCodeAt(h+1),c3=a.charCodeAt(h+2),b+=String.fromCharCode((d&15)<<12|(c2&63)<<6|c3&63),h+=3);return b}}}();
CampaignAvatarPicker=function(a,b){var f=[],c=function(a){return(a.up("a")||a).readAttribute("data-avatar-id")},g=function(b){var f=c(b.element()),g="/accounts/"+active_user.username()+"/pick_campaign_avatar";new Ajax.Request(g,{parameters:{campaign_avatar_id:f},onCreate:function(){var b=$$(a).first();b.insert({after:new Element("img",{src:"/images/presentation/indicator_barbershop.gif",id:"campaign-avatar-picker-indicator"})});b.hide()},onSuccess:function(a){window.location.reload()},onFailure:function(b){alert("Sorry! We were unable to change your avatar. Please try again later.");
$$(a).first().show();$("campaign-avatar-picker-indicator").remove()}});b.preventDefault()},h=function(){$$(a+" li a").each(function(a){f.include(c(a))?(a.addClassName("locked"),a.observe("click",function(a){alert("Avatar locked!");a.preventDefault()})):a.observe("click",g)})};active_user.isAuthenticated()?b?new Ajax.Request("/campaign_avatar_groups/"+b+"/locked_avatars",{method:"GET",onSuccess:function(a){f=a.responseJSON;h()}}):h():$$(a+" li a").each(function(a){a.observe("click",function(a){active_user.activateInlineLogin({},
!0);a.preventDefault()})})};function onClickablePodClick(a){if("A"!=a.element().nodeName&&(a=a.element(),a=a.hasClassName("js_clickable_pod")?a:a.up(".js_clickable_pod")))a=a.down(".js_clickable_pod_link"),document.location=a.href}function observeClickablePods(){$$(".js_clickable_pod").each(function(a){a.observe("click",onClickablePodClick)})}
CreditCardForm=Class.create({initialize:function(a,b,f,c,g){this._tableElement=a;this._rows=[];this._second_rows=[];this._togglePayNow=g;this._ccImages={};this._secondTable=$("second_row");$H({visa:"/images/ccmark_visa.gif",master_card:"/images/ccmark_mastercard.png",american_express:"/images/ccmark_amex.png",discover:"/images/ccmark_discover.gif"}).each(function(a){this._ccImages[a.key]=new Element("img");this._ccImages[a.key].src=a.value}.bind(this));this._ccNumberRow=new FormCreditCardNumberRow(tr("Credit card number"),
"number","credit_card",c.number,this._checkAllRowsForValidity.bind(this),this._propagateCreditCardType.bind(this));this._firstNameRow=new FormNonEmptyRow(tr("First name"),"first_name","billing",tr("Please enter your first name exactly as it appears on your credit card"),c.first_name,this._checkAllRowsForValidity.bind(this),!1);this._lastNameRow=new FormNonEmptyRow(tr("Last name"),"last_name","billing",tr("Please enter your last name exactly as it appears on your credit card"),c.last_name,this._checkAllRowsForValidity.bind(this),
!1);this._expirationRow=new FormExpirationDateRow(tr("Expiration Date"),"","credit_card",b,f,c.month,c.year,this._checkAllRowsForValidity.bind(this));this._postalCodeRow=new FormNonEmptyRow(tr("Postal Code"),"postal_code","billing","",c.postal_code,this._checkAllRowsForValidity.bind(this),!0);this._cvvRow=new FormCvvRow(tr("Card security code"),"cvv","credit_card",c.cvv,this._checkAllRowsForValidity.bind(this));$("country_select").hide();$("credit_card_transaction_country").disable();$("second_table").show();
$j("#credit_card_transaction_new").addClass("simplify_credit_card_form");$j(".credit_card_transaction_new .submission_button").addClass("btn btn_action");$j("#second_table table").append($j("#store"));this._rows.push(this._firstNameRow);this._rows.push(this._lastNameRow);this._rows.push(this._postalCodeRow);this._second_rows.push(this._ccNumberRow);this._second_rows.push(this._expirationRow);this._second_rows.push(this._cvvRow);this._attachRowsToTableElement();"US"==active_user.countryCode()&&$j('label[for="credit_card_transaction_postal_code"]').html("Zip Code")},
getAddressFields:function(a){var b=[];b.push(new FormNonEmptyRow(tr("Billing address"),"street_address","billing",tr("Enter the street address where your statements are mailed to. (eg, 12 Maple Drive)"),a.street_address,this._checkAllRowsForValidity.bind(this),!1));b.push(new FormCanBeEmptyRow(tr("Billing address (cont)"),"extended_address","billing",tr("Apartment number, suite number or department"),a.extended_address,this._checkAllRowsForValidity.bind(this),!1));b.push(new FormNonEmptyRow(tr("City"),
"locality","billing","",a.locality,this._checkAllRowsForValidity.bind(this),!1));b.push(new FormNonEmptyRow(tr("State/Province/Region"),"region","billing","",a.region,this._checkAllRowsForValidity.bind(this),!1));return b},revertToDefaultForm:function(){if(!this.isSimplifiedFormDisabled()){this.disableSimplifiedForm();var a=this._rows[2];this.getAddressFields({}).each(function(a){Element.insert(this._tableElement,{before:a.getElement()})}.bind(this));this._second_rows.each(function(a){Element.insert(this._rows[0].getElement(),
{before:a.getElement()})}.bind(this));$("second_table").hide();$("country_select").show();Element.insert($("country_select"),{before:a.getElement()});Element.insert($("country_select"),{after:$("store")});$("credit_card_transaction_country").enable();$j("#credit_card_transaction_new").removeClass("simplify_credit_card_form");$j(".credit_card_transaction_new .submission_button").removeClass("btn btn_action")}},rowCount:function(){return this._rows.length+this._second_rows.length},reportAllErrors:function(){this._rows.each(function(a){a._callAllOnBlurHandlers()});
this._second_rows.each(function(a){a._callAllOnBlurHandlers()})},disableSimplifiedForm:function(){this.simplifiedFormDisabled=!0},isSimplifiedFormDisabled:function(){return!0===this.simplifiedFormDisabled},_checkAllRowsForValidity:function(){},_enablePayNow:function(){var a=$$(".checkout_button")[0];a.disabled=!1;a.removeClassName("disabled")},_disablePayNow:function(){var a=$$(".checkout_button")[0];this._togglePayNow&&(a.disabled=!0,a.addClassName("disabled"))},_attachRowsToTableElement:function(){this._rows.each(function(a){Element.insert(this._tableElement,
{before:a.getElement()})}.bind(this));this._second_rows.each(function(a){Element.insert(this._secondTable,{before:a.getElement()})}.bind(this))},_propagateCreditCardType:function(){var a=this._ccNumberRow.getCreditCardType();this._ccNumberRow._helpCreditCardFocusHandler._setImage(this._ccImages[a]);this._cvvRow.setCreditCardType(a)}});DynamicFrameTarget=function(a){this.initialize(a)};
DynamicFrameTarget.prototype={initialize:function(a){this.name="dynamic_frame_"+ +new Date;this.frame=new Element("iframe",{name:this.name,id:this.name});$(document.body).insert(this.frame);this.frame.setStyle({display:"none"});a.form.target=this.name;var b=window.location.protocol.sub(":",""),b=new Element("input",{type:"hidden",name:"source_protocol",value:b});a.form.appendChild(b);var f=this,b=function(){var a;this.contentDocument?a=this.contentDocument:this.contentWindow?a=this.contentWindow.document:
window.frames[this.name]?a=window.frames[iframe.name].document:f.frame.contentWindow.document&&(a=f.frame.contentWindow.document);a&&0<a.body.innerHTML.length&&(a=a.body,(a=String((0<a.childElementCount?a.children[0]:a).innerHTML))&&!a.blank()&&f.callback(a.evalJSON()))};this.frame.attachEvent?this.frame.attachEvent("onload",b):this.frame.onload=b;this.callback=a.callback?a.callback:function(b){b.success?a.success&&a.success(b):a.failure&&a.failure(b)}}};DynamicFrameTarget.subclasses=[];
var DynamicScriptLoader=function(){return{load:function(a,b){(function(){var b=new Element("script",{src:a,type:"text/javascript"});$$("head")[0].insert(b)}).runWhenDomLoaded(b)}}}(),facebook_api_timeout=5E3,FacebookApiWrapper=function(){function a(a,b){return function(h){f&&(clearTimeout(b),a(h))}}function b(a){f=!0;return setTimeout(function(){f=!1;a&&a()},facebook_api_timeout)}var f;return{api:function(c,f,h){h=b(h);FB.api(c,a(f,h))}}}(),FacebookAuthenticator=function(a){a||(a={});active_user.isGamePage()&&
(a.game_id=active_user.gameId());$("welcome_remember_me")&&$("welcome_remember_me").checked&&(a.remember_me=!0);"https:"===location.protocol&&(a.ssl_page=!0);Cookie.set("facebook_state_params",Object.toJSON(a));observePopup("https://"+location.host+"/auth/facebook?state="+encodeURIComponent($H(a).toQueryString()),"Log in with Facebook","menubar=no,toolbar=no,status=no,width=600,height=400",reenableFacebookButtons);disableFacebookButtons()};
FacebookApiLoader.addApiLoadedCallback(function(){!active_user.isAuthenticated()&&(!Cookie.get("FacebookLoginAttempt")&&!active_user.isNativeAppUser())&&FB.getLoginStatus(function(a){"connected"==a.status&&new Ajax.Request("/facebook_connection/status",{method:"get",parameters:{uid:a.authResponse.userID},onSuccess:function(a){"linked"==a.responseJSON.status&&(Cookie.set("FacebookLoginAttempt",!0),active_user.isGamePage()?(a=(new Element("form",{action:"/accounts/status",method:"get"})).setStyle({display:"none"}),
$(document.body).insert(a),new DynamicFrameTarget({form:a,success:function(a){user_status.setActiveUser(a)}}),a.insert(new Element("input",{type:"hidden",name:"from_facebook",value:!0})),a.insert(new Element("input",{type:"hidden",name:"game_id",value:active_user.gameId()})),a.insert(new Element("input",{type:"hidden",name:"authenticity_token",value:$$("meta[name=csrf-token]")[0]})),a.insert(new Element("input",{type:"hidden",name:"existing_user",value:!0})),a.submit()):(lightbox.prototype.initializeKongregateLightboxFromContent('<div class="fb_oauth_content"><span class="med_fb_logo spritesite">Facebook</span><h1 class="mbl">Just a moment</h1><p class="regtextLrg">Signing you back into your Kongregate account&hellip; <br/>automatically!</p></div>',
{done_class_name:"lightbox_login"}),window.location.reload()))}})})});var FacebookFriendFinder=function(a){var b=this;FB.getLoginStatus(function(f){"connected"===f.status&&FB.api("me/friends",function(c){var f=$A(c.data).pluck("id");c&&new Ajax.Request("/facebook_connection/friends",{parameters:{"uid[]":f},onSuccess:function(c){b.friends=c.responseJSON;b.friendIds=f;a(b)}})})},!0)};
FacebookFriendFinder.prototype.clickFriend=function(a){a.hasClassName("selected")?(a.removeClassName("selected"),a.down("input").checked=!1):(a.addClassName("selected"),a.down("input").checked=!0)};
FacebookFriendFinder.prototype.displayFriendForm=function(a,b,f){var c=new Template('<h2 class="h2 phn bright">#{friend_count} of your Facebook Friends #{is_or_are} on Kongregate</h2><p class="intro regtext mbm">Kongregate is more fun with friends.</p><form id="facebook_friends_form" class="pan" action="#"><span class="mll spinner" style="display: none;" id="friend_finder_spinner">Loading...</span><div class="select_users"><ul id="facebook_friends_list" class="users medium_user"></ul></div><input class="btn btn_wide btn_action" id="friend_finder_button" type="submit" value="Connect with Friends" /><a id="facebook_friends_skip" class="mrm" href="#">Skip this step</a></form>'),g=
new Template('<li class="user medium_user clickable selected" onclick="FacebookFriendFinder.prototype.clickFriend(this)"><input type="checkbox" name="user_id[]" value="#{id}" class="mtm img" checked="checked" /><span class="check_mark spritesite"></span><img width="40" height="40" class="user_avatar" src="#{avatar_url}" /><span class="names"><strong class="sprite_facebook facebook_name first_name truncate_one_line">#{first_name} #{last_name}</strong><em class="second_name truncate_one_line">(<span class="spritesite levelbug level_#{level}">#{username}</span>)</em></span></li>'),
h,d,k;b.update(c.evaluate({friend_count:this.friends.length,is_or_are:1==this.friends.length?"is":"are"}));h=$("facebook_friends_form");d=$("facebook_friends_skip");k=$("facebook_friends_list");h.observe("submit",function(b){b.preventDefault();$("friend_finder_button").hide();d.hide();$("friend_finder_spinner").show();new Ajax.Request(a,{parameters:h.serialize(),onSuccess:function(a){f()},onFailure:function(a){alert("There was an error while trying to create your new friends.");$("friend_finder_spinner").hide();
d.show();$("friend_finder_button").show()}})});d.observe("click",f);this.friends.each(function(a){a=$H(a).inject({},function(a,b){a[b[0]]=Object.isString(b[1])?b[1].escapeHTML():b[1];return a});k.insert(g.evaluate(a))})};
FileField=function(a,b){a.observe("mousemove",function(f){var c=f.pointerX();f=f.pointerY();var g=b.getOffsetParent().viewportOffset();b.setOpacity(0);this.containerPositon||(this.containerPositon=a.getBoundingClientRect());f>=this.containerPositon.top&&f<this.containerPositon.bottom&&c>=this.containerPositon.left&&c<this.containerPositon.right?(b.style.left=c-this.containerPositon.left+30-b.getWidth()+"px",b.style.top=f-g[1]-10+"px"):(b.style.left=0,b.style.top=0)}.bind(this))};
FocusHandler=Class.create({initialize:function(a,b,f){this._row=a;this._text=b;this._callback=f;this._elementsToInspect=a.getInputElements();this._elementToAffect=a.getHelpElement()},setText:function(a){this._text=a},_inputIsValid:void 0,onFocus:function(){FocusHandler._last_row=this._row},onBlur:function(){if(this._inputIsValid())return this._elementsToInspect.each(function(a){Element.removeClassName(a,"error_field")}),Element.removeClassName(this._elementToAffect,"error_msg"),this._elementToAffect.innerHTML=
"",!1;this._elementsToInspect.each(function(a){Element.addClassName(a,"error_field")});Element.addClassName(this._elementToAffect,"error_msg");this._elementToAffect.innerHTML=this._text;this._callback();return!0},_rowChanged:function(){return this._row!=FocusHandler._last_row}});
HelpFocusHandler=Class.create(FocusHandler,{initialize:function($super,b,f){$super(b,f,function(){})},onBlur:function(){var a=this._elementToAffect.childNodes[0];a&&a.remove();return!1},_createHelpDiv:function(){this._removeHelpDiv();var a=new Element("div");a.id="help_wrapper";var b=new Element("div");b.id="help_text";a.appendChild(b);this._elementToAffect.appendChild(a);return b},_removeHelpDiv:function(){var a=this._elementToAffect.childNodes[0];a&&a.remove()},_errorsArePresent:function(){return this._elementToAffect.hasClassName("error_msg")}});
HelpTextFocusHandler=Class.create(HelpFocusHandler,{initialize:function($super,b,f){$super(b,f)},onFocus:function($super){$super();if(this._errorsArePresent())return!1;this._text&&(this._createHelpDiv().innerHTML=this._text);return!0}});HelpImageFocusHandler=Class.create(HelpFocusHandler,{initialize:function($super,b,f){$super(b,null);this._imageElement=f},onFocus:function($super){$super();if(this._errorsArePresent())return!1;this._setImage(this._imageElement);return!0},_setImage:function(a){this._createHelpDiv().appendChild(a)}});
HelpCreditCardFocusHandler=Class.create(HelpImageFocusHandler,{initialize:function($super,b,f){$super(b,f);this._setImage(this._imageElement)},onBlur:function($super){}});NonEmptyInputFocusHandler=Class.create(FocusHandler,{initialize:function($super,b,f,c){$super(b,f,c)},_inputIsValid:function(){return""!=this._row.getInputValue()}});
CreditCardValidationFocusHandler=Class.create(FocusHandler,{initialize:function($super,b,f,c){$super(b,f,c)},_inputIsValid:function(){for(var a=[/^4\d{12}(\d{3})?$/,/^(5[1-5]\d{4}|677189)\d{10}$/,/^(6011|65\d{2})\d{12}$/,/^3[47]\d{13}$/],b=["visa","master_card","discover","american_express"],f=0,c=a.length;f<c;f++)if(this._row.getInputValue().match(a[f]))return this._creditCardType=b[f],!0;return!1},getCreditCardType:function(){return this._creditCardType}});
DateValidationFocusHandler=Class.create(FocusHandler,{initialize:function($super,b,f,c){$super(b,f,c)},_deferValidation:function(){return!this._rowChanged()&&this._isIncomplete()},_isIncomplete:function(){return!this._month()||!this._year()},_month:function(){return this._row.getInputElements()[0].value},_year:function(){return this._row.getInputElements()[1].value}});
CompleteDateValidationFocusHandler=Class.create(DateValidationFocusHandler,{initialize:function($super,b,f,c){$super(b,f,c)},_inputIsValid:function(){return this._deferValidation()?!0:6<=this._row.getInputValue().length}});
FutureDateValidationFocusHandler=Class.create(DateValidationFocusHandler,{initialize:function($super,b,f,c){$super(b,f,c)},_getCurrentDate:function(){return new Date},_inputIsValid:function(){if(this._deferValidation())return!0;var a=this._row.getInputValue().split("/"),b=this._getCurrentDate();return!(a[1]==b.getFullYear()&&a[0]<b.getMonth()+1)}});
CvvValidationFocusHandler=Class.create(FocusHandler,{initialize:function($super,b,f){this._requiredCvvLength=0;$super(b,"credit card number must be valid",f)},setCreditCardType:function(a){this._requiredCvvLength=this._getRequiredCvvLengthFor(a);this.setText("code must be "+this._requiredCvvLength+" digits")},_getRequiredCvvLengthFor:function(a){return"american_express"==a?4:"test"==a?1:3},_inputIsValid:function(){return this._row.getInputValue().length==this._requiredCvvLength}});
ValidInputCallbackFocusHandler=Class.create(FocusHandler,{initialize:function($super,b,f){$super(b,"",f)},onBlur:function(){this._callback();return!1}});
FormRow=Class.create({initialize:function(a,b,f,c,g){this._formCallback=g;this._tr=new Element("tr");a=this._createFieldNameColumn(a,b);this._tr.appendChild(a);f=this._createInputColumn(b,f,c);this._tr.appendChild(f);this._helpColumn=this._createHelpColumn(b);this._tr.appendChild(this._helpColumn);this._focusHandlers=[];this.getInputElements().each(function(a){a.onfocus=this._callAllOnFocusHandlers.bind(this);a.onblur=this._callAllOnBlurHandlers.bind(this)}.bind(this));this._hasValidInput=!1;this._setInputValidityTrue=
function(){this.setInputValidity(!0)}.bind(this);this._setInputValidityFalse=function(){this.setInputValidity(!1)}.bind(this)},hasValidInput:function(){return this._hasValidInput},setInputValidity:function(a){this._hasValidInput=a;this._formCallback()},_callAllOnFocusHandlers:function(){for(var a=0;a<this._focusHandlers.length&&!this._focusHandlers[a].onFocus();a++);},_callAllOnBlurHandlers:function(){for(var a=0;a<this._focusHandlers.length&&!this._focusHandlers[a].onBlur();a++);},getElement:function(){return this._tr},
getInputElements:function(){return[this.getColumn(1).childNodes[0]]},getInputValue:function(){return this.getColumn(1).childNodes[0].value},getHelpElement:function(){return this.getColumn(2)},getColumn:function(a){return this._tr.childNodes[a]},addFocusHandler:function(a){this._focusHandlers.push(a)},focusHandlerCount:function(){return this._focusHandlers.length},_createFieldNameColumn:function(a,b){var f=new Element("td");f.innerHTML='<label for="credit_card_transaction_'+b+'">'+a+"</label>";f.className=
"purchase_label";return f},_createInputColumn:function(a,b,f){var c=new Element("td");c.className="purchase_input";this._inputElement=new Element("input");this._inputElement.id="credit_card_transaction_"+a;this._inputElement.name="transaction["+b+"]["+a+"]";this._inputElement.size=30;this._inputElement.value=f?f:"";c.appendChild(this._inputElement);return c},_createHelpColumn:function(a){var b=new Element("td");b.id=a+"_help";return b}});
FormNonEmptyRow=Class.create(FormRow,{initialize:function($super,b,f,c,g,h,d,k){$super(b,f,c,h,d);k&&this.getInputElements().each(function(b){b.onkeyup=function(){""!=this.getInputValue()&&this._callAllOnBlurHandlers()}.bind(this)}.bind(this));b=new NonEmptyInputFocusHandler(this,tr("can't be blank"),this._setInputValidityFalse);this.addFocusHandler(b);this._validInputCallbackFocusHandler=new ValidInputCallbackFocusHandler(this,this._setInputValidityTrue);this.addFocusHandler(this._validInputCallbackFocusHandler);
g=new HelpTextFocusHandler(this,g);this.addFocusHandler(g)}});FormCanBeEmptyRow=Class.create(FormRow,{initialize:function($super,b,f,c,g,h,d){$super(b,f,c,h,d);this._hasValidInput=!0;b=new HelpTextFocusHandler(this,g);this.addFocusHandler(b)}});
FormCreditCardNumberRow=Class.create(FormRow,{initialize:function($super,b,f,c,g,h,d){$super(b,f,c,g,h);b=new NonEmptyInputFocusHandler(this,"can't be blank",this._setInputValidityFalse);this.addFocusHandler(b);this._ccNumberFocusHandler=new CreditCardValidationFocusHandler(this,"invalid account number",this._setInputValidityFalse);this.addFocusHandler(this._ccNumberFocusHandler);this._validInputCallbackFocusHandler=new ValidInputCallbackFocusHandler(this,d,this._setInputValidityFalse);this.addFocusHandler(this._validInputCallbackFocusHandler);
this._validInputCallbackFocusHandler=new ValidInputCallbackFocusHandler(this,this._setInputValidityTrue);this.addFocusHandler(this._validInputCallbackFocusHandler);d=new Element("img");d.src="/images/creditcard_marks.png";this._helpCreditCardFocusHandler=new HelpCreditCardFocusHandler(this,d);this.addFocusHandler(this._helpCreditCardFocusHandler)},getCreditCardType:function(){return this._ccNumberFocusHandler.getCreditCardType()},getInputValue:function(){return this.getColumn(1).childNodes[0].value.replace(/\s+/g,
"")}});
FormCvvRow=Class.create(FormRow,{initialize:function($super,b,f,c,g,h){$super(b,f,c,g,h);b=new NonEmptyInputFocusHandler(this,"can't be blank",this._setInputValidityFalse);this.addFocusHandler(b);this._cvvValidationFocusHandler=new CvvValidationFocusHandler(this,this._setInputValidityFalse);this.addFocusHandler(this._cvvValidationFocusHandler);this._validInputCallbackFocusHandler=new ValidInputCallbackFocusHandler(this,this._setInputValidityTrue);this.addFocusHandler(this._validInputCallbackFocusHandler);this._helpTextFocusHandler=
new HelpTextFocusHandler(this,"");this.addFocusHandler(this._helpTextFocusHandler)},setCreditCardType:function(a){this._cvvValidationFocusHandler.setCreditCardType(a);this._helpTextFocusHandler.setText("american_express"==a?"Please enter the four digit code that's printed on the front of your card, just to the right of the account number.":"Please enter the last three digits printed on the signature line on the back side of your card.")}});
FormExpirationDateRow=Class.create(FormRow,{initialize:function($super,b,f,c,g,h,d,k,n){this._formCallback=n;this._monthHTML=g;this._yearHTML=h;this._defaultMonth=d;this._defaultYear=k;$super(b,f+"cc_month",c,"",n);b=new CompleteDateValidationFocusHandler(this,"month &amp; year are required",this._setInputValidityFalse);this.addFocusHandler(b);b=new FutureDateValidationFocusHandler(this,"date must be in the future",this._setInputValidityFalse);this.addFocusHandler(b);this._validInputCallbackFocusHandler=
new ValidInputCallbackFocusHandler(this,this._setInputValidityTrue);this.addFocusHandler(this._validInputCallbackFocusHandler);b=new HelpTextFocusHandler(this,"");this.addFocusHandler(b)},_createInputColumn:function(){var a=new Element("td");a.addClassName("purchase_input");Element.insert(a,this._monthHTML);a.childNodes[0].value=this._defaultMonth;Element.insert(a,this._yearHTML);a.childNodes[1].value=this._defaultYear;return a},getInputElements:function(){return[this.getColumn(1).childNodes[0],this.getColumn(1).childNodes[1]]},
getInputValue:function(){return this.getColumn(1).childNodes[0].value+"/"+this.getColumn(1).childNodes[1].value},setMonthInput:function(a){this.getColumn(1).childNodes[0].selectedIndex=a},setYearInput:function(a){this.getColumn(1).childNodes[1].selectedIndex=a}});
var FormValidator=function(){function a(a){return""===$j.trim(a.val())?(f(a,"Cannot be blank"),!1):!0}function b(a){var b=RegExp(a.data("pattern"));return""!==$j.trim(a.val())&&!b.test(a.val())?(f(a,"Invalid"),!1):!0}function f(a,b){var c=a.siblings("span.error-message");0===c.length&&(c=$j('<span class="error-message">').insertAfter(a));c.html(b);a.addClass("error")}function c(a,b){a.siblings("span.error-message").empty();a.removeClass("error")}return function(g,h){function d(d){var g=!0;c(d);d.data("required")&&
(g=a(d));g&&d.data("pattern")&&(g=b(d));g&&$j.each(k,function(){var a=this[1];d.is(this[0])&&((a=a(d))?(f(d,a),g=!1):g=!0);return g});return g}var k,n;h||(h={});k=h.customValidations||[];n=$j.merge(["[data-pattern]","[data-required]"],$j.map(k,function(a){return a[0]})).join(",");g.on("blur",n,function(){d($j(this))});g.on("submit",function(a){var b=!0;g.find(n).each(function(){b=d($j(this))&&b});b||(a.stopImmediatePropagation(),g.trigger("failed_submit"));return b})}}();
$j(".error-message").on("click",function(){$j(this).prev().focus()});if(Prototype.Browser.IE8)$j(".kred_cc_form input, .kred_cc_form select").on("focus click",function(){$j(this).parent().find(".error-message").empty()});
var GameBrowser={highlightCurrentSidebarItem:function(a){$j(".browser-sidebar-"+a).addClass("active")},updateTagSidebarItem:function(a,b){a&&b&&($j(".browser-sidebar-tag-games-link").href=b,$j(".browser-sidebar-tag-games-link").text(a),$j(".browser-sidebar-tag-games").addClass("active"),$j(".browser-sidebar-tag-games").show())},showTagAutoCompleter:function(a,b){$j("#tag_filter_button").on("click",function(){$j("#tag_filter_text_box").focus()});var f=$j.map(a,function(a,b){return a}).sort(function(a,
b){return a.game_count>b.game_count?-1:a.game_count<b.game_count?1:0});$j("#tag_filter_text_box").autocomplete({autoFocus:!0,minLength:0,source:function(a,g){var h=RegExp(a.term,"i"),d=$j.map(f,function(a,c){if(a.synonyms.match(h)){var d=a.tag_name;b&&(d=d+"  ("+a.game_count+")");return{label:d,value:a.tag_name}}});g(d)}}).focus(function(){$j(this).autocomplete("search")});$j("#tag_filter_text_box").on("autocompleteselect",function(b,f){var h=a[f.item.value].tag_name.gsub(" ","+");GameBrowser.reloadWithQuery($j.query.set("tag",
h))});$j(".remove_current_tag").on("click",function(a,b){$j("#tag_filter_text_box").attr("placeholder","");$j(".remove_current_tag").hide();$j("#remove_current_tag_spinner").show();location.search=$j.query.remove("tag")});$j("#tag_filter_autocompleter").show()},showFilterControl:function(){$j("#sort_filter_control").on("click",function(a){$j("#game_browser_filters").toggle();$j("#sort_filter_control").toggleClass("opened")});$j("#game_browser_filters li").on("click",function(a){a=$j(a.target);var b=
a.parent().data().queryParam,f=a.data().queryValue;a.hasClass("selected")?GameBrowser.reloadWithQuery($j.query.remove(b)):GameBrowser.reloadWithQuery($j.query.set(b,f))});$j(".filter_x_control").each(function(a,b){b.on("click",function(a){var b=$j(a.target);a=$j(a.target).data();a.queryParam?param=a.queryParam:(param=b.parent().data().queryParam,b=b.parent());b.hide();$j("#remove_current_filter_or_sort_spinner").show();GameBrowser.reloadWithQuery($j.query.remove(param))})});$j(".game_browser_filter").show()},
reloadWithQuery:function(a){a=a.remove("pdis").remove("srid").toString();location.search=a.gsub("%2B","+")},setTagValueForIE:function(a){Prototype.Browser.IE&&(!Prototype.Browser.IE10&&!Prototype.Browser.IE11)&&$j("#tag_filter_text_box").val(a)}},hookup_hintables=function(){$$(".hintable").each(function(a){var b=a.title,f=a.form,c=f.restoreHints,g=function(){if(b==a.value||""==a.value)a.value="",a.removeClassName("hinted_value")},h=function(){""==a.value&&(a.value=b,a.addClassName("hinted_value"))},
d=a.form.onsubmit;h();a.observe("click",g);a.observe("focus",g);a.observe("blur",h);a.restoreHint=h;f.onsubmit=function(){var a=!0;g();if(d)try{a=d.apply(this,arguments)}catch(b){}h();return a};f.restoreHints=function(){h();c&&c.apply(this,arguments)}})};hookup_hintables();var HoverboxGroupFixed=function(){this.initialize()};
HoverboxGroupFixed.prototype={initialize:function(){this.below=!0;this.hoverbox=null;this.cache={};this.triggeredElement=!1;this.openDelay=500;this.clearTimeouts=function(){$j(this.timeoutIds).each(function(a,b){clearTimeout(b)});this.timeoutIds=[]}},registerHoverObservers:function(){$j(document).on("mouseenter",".js-game-hover",function(a){clearTimeout(this.openTimeout);this.hoverbox||(this.openTimeout=setTimeout(this.openHoverbox.bind(this,a.target),this.openDelay))}.bind(this));$j(document).on("mouseleave",
".js-game-hover",this.handleMouseLeave.bind(this));Event.observe(window,"resize",function(){this.cache={}}.bind(this));$j(document).on("mouseenter",".hover_profile",function(){clearTimeout(this.openTimeout);this.hoverbox&&this.closeHoverbox()}.bind(this));$j(document).on("mouseleave",".hover_profile",function(a){0!==$j(a.target).parents(".js-game-hover").length&&this.openHoverbox(a.target,!0)}.bind(this))},handleMouseLeave:function(a){clearTimeout(this.openTimeout);this.triggeredElement&&this.triggeredElement!=
$(this)||(this.clearTimeouts(),void 0!==$j(".hover_game_info_window").offset()&&this.hoverbox&&$j(document).mousemove(function(a){this.clearTimeouts();a=setTimeout(function(a){this.closeHoverbox(a)}.curry(a).bind(this),100);this.timeoutIds.push(a)}.bind(this)))},handleBoxOpened:function(a){$j(this.hoverbox.container).on({mouseenter:function(){$j(document).unbind("mousemove");this.clearTimeouts()}.bind(this),mouseleave:function(a){this.closeHoverbox(a)}.bind(this)});this.cache[a]=this.hoverbox;this.hoverbox.ajaxRequest&&
this.hoverbox.ajaxRequest.transport.evalScripts()},openHoverbox:function(a,b){this.clearTimeouts();$j(document).unbind("mousemove");triggeredElement=$(this);this.parent=$j(a).parents(".js-game-hover");0===this.parent.length&&(this.parent=$j(a));this.parent.addClass("game_hover_active");var f=this.parent.find("a.hover_game_info, a.badge_link").get(0)||this.parent.find("a").get(0);!f&&this.parent.hasClass("game_browser_icon")&&(f=this.parent.get()[0]);if($j(a).hasClass("hover_profile")){if("undefined"==
typeof b)return}else if(0!==$j(a).parents(".js-ignore-game-hover").length||$j(a).hasClass("close_remove")||"undefined"==typeof f)return;var c=f.pathname;"/"!==c[0]&&(c="/"+c);this.hoverbox=this.cache[c];this.hoverbox||(this.hoverbox=new Control.Window(f,{method:"GET",parameters:{},offsetLeft:0,offsetTop:0,className:"hover_game_info_window"}));this.hoverbox.sourceContainer.stopObserving("click");this.hoverbox.observe("bringToFront",this.handleBoxBeforeOpen.curry(a).bind(this));this.hoverbox.observe("afterOpen",
this.handleBoxOpened.curry(c).bind(this));this.hoverbox.href=c+"/show_hover";this.hoverbox.open()},handleBoxBeforeOpen:function(a){a=$j(this.hoverbox.container);a.addClass("alt_hover");a.removeClass("hoverbox_above_right");a.removeClass("hoverbox_above_left");a.removeClass("hoverbox_left");a.removeClass("hoverbox_above");a.removeClass("hoverbox_below");var b=this.parent.offset();this.parent.find(".game_icon, .badge_image");var f=a.outerHeight(),c=$j(window).width()+$j(window).scrollLeft(),g,h=this.parent.hasClass("browser_layout_split_test_game"),
d=h?25:15;g=h?20:0===this.parent.parents(".large_game_pod_column_one, .large_game_pod_column_two").length?20:35;a.removeClass("hover_right");b.left+a.outerWidth()+d<c?c=this.parent.hasClass("trending_img_outer")?b.left+g+22:b.left+g:(a.addClass("hover_right"),c=this.parent.hasClass("trending_img_outer")?b.left+this.parent.outerWidth()-a.outerWidth()-g-22:b.left+this.parent.outerWidth()-a.outerWidth()-g);h=h?-45:this.parent.hasClass("trending_img_outer")?-48:12;b.top-$j(window).scrollTop()-h<f?(this.below=
!1,this.hoverbox.options.position=[c,b.top+this.parent.outerHeight()+h],a.addClass("hoverbox_above")):(this.below=!0,a.addClass("hoverbox_below"),this.hoverbox.options.position=[c,b.top-f-h])},closeHoverbox:function(a){$j(document).unbind("mousemove");if(this.hoverbox){try{$j(this.hoverbox.container).find(".js-rating-unit").ratingUnit("hideRatingHoverBox")}catch(b){}this.hoverbox.stopObserving("afterOpen");this.hoverbox.stopObserving("bringToFront");$j(this.hoverbox.container).unbind("mouseenter");
$j(this.hoverbox.container).unbind("mouseleave");if(this.hoverbox.ajaxRequest){this.hoverbox.ajaxRequest.transport.abort();this.hoverbox.close();try{this.hoverbox.destroy()}catch(f){}}else this.hoverbox.close();this.hoverbox=null}this.parent.removeClass("game_hover_active");this.clearTimeouts();if(void 0!==a){a=document.elementFromPoint(a.clientX,a.clientY);var c=$j(a).parents(".js-game-hover");if(($j(a).hasClass("js-game-hover")||0!==c.length)&&!this.hoverbox)this.openTimeout=setTimeout(this.openHoverbox.bind(this,
a),this.openDelay)}}};GameInfoHoverGroup="undefined"==typeof GameInfoHoverGroup?new HoverboxGroupFixed:GameInfoHoverGroup;GameInfoHoverGroup.registerHoverObservers();
InteractiveHover=Class.create(Control.Window,{initialize:function($super,b,f){var c;$super(b,f);b=function(b){this.open(b);null!=c&&(clearTimeout(c),c=null)}.bind(this);f=function(b){c=setTimeout(function(){this.close(b)}.bind(this),1E3)}.bind(this);this.sourceContainer.observe("mouseenter",b);this.container.observe("mouseenter",b);this.sourceContainer.observe("mouseleave",f);this.container.observe("mouseleave",f)}});$j(".kpan_cal .week .badge_info").on("mouseover",function(){$j(this).prev().addClass("hover")});
$j(".kpan_cal .week .badge_info").on("mouseout",function(){$j(this).prev().removeClass("hover")});var detect=navigator.userAgent.toLowerCase(),total,thestring,DEFAULT_WIDTH=798,DEFAULT_HEIGHT=592,lightbox=Class.create();
lightbox.prototype={yPos:0,xPos:0,initialize:function(a,b){this.wait_for_shutdown=this._activated=!1;this.done_class_name="done";"string"==typeof a?(this.content=a,this.activate()):(this.content=a.href,a.observer_function=this.activate.bindAsEventListener(this),Event.observe(a,"click",a.observer_function,!0),a.onclick=function(){return!1});this._on_close_callbacks=[];b&&this._on_close_callbacks.push(b)},setEventDispatcher:function(a){this.eventDispatcher=a},dispatchEvent:function(a){this.eventDispatcher&&
this.eventDispatcher.dispatchEvent(a)},shutdown:function(){this.wait_for_shutdown||(this.stopListening(),this.deactivate.apply(this,arguments))},shutdownWithoutCallbacks:function(){this._on_close_callbacks=[];this.shutdown.apply(this,arguments)},addOnCloseCallback:function(a){this._on_close_callbacks||(this._on_close_callbacks=[]);this._on_close_callbacks.push(a)},clearOnCloseCallbacks:function(){this._on_close_callbacks=[]},initializeKredItemPurchaseFrame:function(a){this.addOnCloseCallback(function(){var a=
$j.extend({item_success:!1},this.data_store.data);a.success=a.item_success;delete a.item_success;a.success?"undefined"!==typeof holodeck&&holodeck.closeDiscountTab():new Ajax.Request("/kred_package_purchases/abandon_cart",{method:"post",onSuccess:function(a){discountOffered=a.responseJSON.discount_offered;discountExpiration=new Date(a.responseJSON.discount_expiration);discountOffered&&new Date<discountExpiration&&setTimeout(function(){holodeck.showDiscountTab(discountExpiration)},3E5)}});try{this.eventDispatcher.dispatchEvent({type:"purchase_result",
data:a})}catch(f){}});this.initializeKredPurchaseFrame(a)},initializeKredCardCartPurchaseFrame:function(a){this.addOnCloseCallback(function(){$j.extend({item_success:!1},this.data_store.data).item_success&&(top.location=top.location.href)});this.initializeKredPurchaseFrame(a)},secureUrlForPath:function(a){var b=window.location.host,f=window.lightboxSecureProtocol;if(b.match(/local/)||b.match(/webhop/))f="http://";return f+b+a},initializeKredPurchase:function(a,b){this.addOnCloseCallback(function(){$j.extend({success:!1},
this.data_store.data).success&&"undefined"!==typeof holodeck&&holodeck.closeDiscountTab()});var f=this.secureUrlForPath("/kred_package_purchases/new"),c={disable_instart_injection:"true"};a&&(c.purchase_method=a);b&&(c.tracking_code=b);c=Object.toQueryString(c);0<c.length&&(f=f+"?"+c);this.initializeKredPurchaseFrame(f)},initializeShoutFrame:function(a,b){this.initializeKongregateLightboxFromAjax("/api/new_shout?game_id="+a+"&message="+b,{done_class_name:"lightbox_login"})},initializeFeedPostFrame:function(a,
b,f,c){var g="";$H(c).each(function(a){g+="kv_params["+a[0]+"]="+a[1]+"&"});this.initializeKongregateLightboxFromAjax("/api/feed_post?game_id="+a+"&message="+b+"&image_uri="+f+"&"+g,{done_class_name:"lightbox_login"})},initializeInvitationFrame:function(a,b,f,c){var g="";$H(c).each(function(a){g+="kv_params["+a[0]+"]="+a[1]+"&"});this.initializeKongregateLightboxFromAjax("/api/new_invitation?game_id="+a+"&message="+b+"&filter="+f+"&"+g,{done_class_name:"lightbox_invite"})},initializeKredPurchaseFrame:function(a){this._kongregate_lightbox_wrapper_template||
(this._kongregate_lightbox_wrapper_template=new Template($("kongregate_lightbox_wrapper_template").innerHTML));this.staticContent=this._kongregate_lightbox_wrapper_template.evaluate({iframe_src:a});this.done_class_name="kred_purchase";this.activate()},initializeKredVerificationFrame:function(a){a="/accounts/"+("undefined"==typeof a?active_user.username():a)+"/kred_account_verification/edit?non_purchase=true";this._kongregate_lightbox_wrapper_template||(this._kongregate_lightbox_wrapper_template=new Template($("kongregate_lightbox_wrapper_template").innerHTML));
this.staticContent=this._kongregate_lightbox_wrapper_template.evaluate({iframe_src:a});this.done_class_name="kred_purchase";this.activate()},initializeTrueXVideoFrame:function(a,b,f){this.addOnCloseCallback(b);this.initializeKongregateLightboxFromContent('<div id="truex_target"></div>',{done_class_name:"truex_video",afterStaticContentLoad:a},f)},initializeHyprMXVideoFrame:function(a,b,f){a='<iframe src="'+a+'" />';this.addOnCloseCallback(b);this.initializeKongregateLightboxFromContent(a,{done_class_name:"hyprmx_video"},
f)},updateWithContent:function(a){$j("#lightbox_form").html(a)},userAuthenticated:function(){if(active_user.isAuthenticated())return!0;var a="/accounts/new/behind_login";"undefined"!=typeof holodeck&&(a=a+"?game_id="+holodeck.gameId());var b={done_class_name:"lightbox_login"};active_user.signinLightboxRegistrationFirst()&&(b.afterStaticContentLoad=lightbox.prototype.toggleRegistration);this.initializeKongregateLightboxFromAjax(a,b);return!1},initializePremiumMembershipPurchase:function(a,b){var f=
this.secureUrlForPath("/premium_membership_purchases/new?referer="+a),c=new Template($("kongregate_lightbox_wrapper_template").innerHTML);b&&(f+="&initial_tab="+b);this.staticContent=c.evaluate({iframe_src:f});this.done_class_name="kred_purchase";this.activate()},initializeKongregateLightboxFromAjax:function(a,b){b||(b={});this._kongregate_lightbox_wrapper_template_noframe||(this._kongregate_lightbox_wrapper_template_noframe=new Template($("kongregate_lightbox_wrapper_template_noframe").innerHTML));
this.staticContent=this._kongregate_lightbox_wrapper_template_noframe.evaluate({});this.staticContentDivUrl=a;this.afterStaticContentLoad=b.afterStaticContentLoad;void 0===b.no_class_name&&(this.done_class_name=["kred_purchase"].concat(b.done_class_name||[]).join(" "));this.activate()},initializeKongregateLightboxFromContent:function(a,b,f){b||(b={});var c=$(document.createElement("div"));c.innerHTML=(new Template($("kongregate_lightbox_wrapper_template_noframe").innerHTML)).evaluate({});c.down("#lightbox_form").update(a);
c.down("#kongregate_lightbox_spinner").hide();this.staticContent=c.innerHTML;this.done_class_name=["kred_purchase"].concat(b.done_class_name||[]).join(" ");this.afterStaticContentLoad=b.afterStaticContentLoad;this.activate(null,f)},keyUpHandler:function(a){27==a.keyCode&&(this.ajaxRequest&&(this.ajaxRequest.transport.abort(),this.ajaxRequest=null),this.deactivate())},clickHandler:function(a){"overlay"==a.target.id&&(this.ajaxRequest&&(this.ajaxRequest.transport.abort(),this.ajaxRequest=null),this.deactivate())},
activate:function(a,b){if($("lightbox")&&!this._activated){this._activated=!0;this.done_class_name||(this.done_class_name="done");Prototype.Browser.IE&&(this.getScroll(),this.prepareIE("100%","hidden"),this.setScroll(0,0),this.hideSelects("hidden"));"undefined"!==typeof holodeck&&(CinematicMode.deactivateCinematicMode(),this.eventDispatcher=this.eventDispatcher||holodeck.konduit());this.data_store=new CrossFrameDataStore({name:CrossFrameDataStore.LIGHTBOX_NAME,domain:location.host});var f=this;this.data_store.on("change",
function(a){a.close&&(delete a.close,f.shutdown(a))});this.cachedKeyUpHandler=this.keyUpHandler.bindAsEventListener(this);this.cachedClickHandler=this.clickHandler.bindAsEventListener(this);$(document).observe("keyup",this.cachedKeyUpHandler);$(document).observe("click",this.cachedClickHandler);this.hideHiddenElements();this.dispatchLightboxOpened(b);setTimeout(function(){$("lightbox").className="loading";this.displayLightbox("block")}.bind(this),10);a&&("object"==typeof a&&a.stopPropagation)&&a.stopPropagation()}},
deactivate:function(){if(this._activated){this._activated=!1;this.staticContent=void 0;var a=$("lbContent");a&&a.remove();this.data_store&&this.data_store.shutdown();Prototype.Browser.IE&&(this.setScroll(0,this.yPos),this.prepareIE("auto","auto"),this.hideSelects("visible"));$(document).stopObserving("keyup",this.cachedKeyUpHandler);$(document).stopObserving("click",this.cachedClickHandler);this.displayLightbox("none");this.done_class_name="done";(function(a,f){a.onClose.apply(a,f)}).defer(this,arguments);
this.showHiddenElements()}},prepareIE:function(a,b){Prototype.Browser.IE6&&$$("html, body").each(function(f){f.setStyle({height:a,overflow:b})})},hideSelects:function(a){selects=document.getElementsByTagName("select");for(i=0;i<selects.length;i++)selects[i].style.visibility=a},domElementsToHide:function(){return $$("object").concat($$(".ad")).select(function(a){return a&&"konduit"!=a.id&&"gamediv"!=a.id})},hideHiddenElements:function(){this.moveGameDivOffScreen();var a=this._dom_elements_actually_hidden=
[];this.domElementsToHide().each(function(b){"visible"==b.getStyle("visibility")&&(a.push(b),Prototype.Browser.Safari503?b.hide():b.setStyle({visibility:"hidden"}),b.hiddenByLightbox=!0)});this.hideGameInIFrame()},showHiddenElements:function(){this.moveGameDivOnScreen();this._dom_elements_actually_hidden&&(this._dom_elements_actually_hidden.each(function(a){Prototype.Browser.Safari503?a.show():a.setStyle({visibility:"visible"});a.hiddenByLightbox=!1}),this.showGameInIFrame())},hideGameInIFrame:function(){},
showGameInIFrame:function(){},shouldMoveGameDiv:function(){return active_user&&active_user.isGamePage()},moveGameDivOffScreen:function(){$("game")&&this.shouldMoveGameDiv()&&$("game").setStyle({top:"-10000px",left:"-10000px"})},moveGameDivOnScreen:function(){$("game")&&this.shouldMoveGameDiv()&&$("game").setStyle({top:"",left:""})},getScroll:function(){self.pageYOffset?this.yPos=self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?this.yPos=document.documentElement.scrollTop:
document.body&&(this.yPos=document.body.scrollTop)},setScroll:function(a,b){window.scrollTo(a,b)},reloadInfoFromUrl:function(a,b){$("lightbox_form")&&(b&&($("lightbox").className=b),$("lightbox_form").update(""),$("kongregate_lightbox_spinner").show(),new Ajax.Updater("lightbox_form",a,{method:"get",evalScripts:!0,onComplete:function(a){Element.hide("kongregate_lightbox_spinner");this.afterStaticContentLoad&&this.afterStaticContentLoad();this.afterStaticContentLoad=void 0}.bind(this)}))},displayLightbox:function(a){$("overlay").style.display=
a;$("lightbox").style.display=a;"none"!=a&&this.loadInfo()},loadInfo:function(){this.staticContent?(this.renderContents(this.staticContent),this.staticContent=void 0,this.staticContentDivUrl?(this.ajaxRequest=new Ajax.Updater("lightbox_form",this.staticContentDivUrl,{method:"get",evalScripts:!0,onComplete:function(a){Element.hide("kongregate_lightbox_spinner");this.afterStaticContentLoad&&this.afterStaticContentLoad();this.afterStaticContentLoad=void 0}.bind(this)}),this.staticContentDivUrl=void 0):
(this.afterStaticContentLoad&&this.afterStaticContentLoad(),this.afterStaticContentLoad=void 0)):new Ajax.Request(this.content,{method:"get",parameters:"",onComplete:this.processInfo.bindAsEventListener(this)})},processInfo:function(a){this.renderContents(a.responseText)},renderContents:function(a){a="<div id='lbContent'>"+a+"</div>";var b=$("lbLoadMessage");new Insertion.Before(b,a);b.hide();$("lightbox").className=this.done_class_name;this.actions()},actions:function(){lbActions=document.getElementsByClassName("lbAction");
var a=function(){return!1},b=document.getElementById("username");b&&(Prototype.Browser.Gecko&&Prototype.Platform.Macintosh)&&b.focus();for(i=0;i<lbActions.length;i++)Event.observe(lbActions[i],"click",this[lbActions[i].rel].bindAsEventListener(this),!1),lbActions[i].onclick=a},insert:function(a){link=Event.element(a).parentNode;Element.remove($("lbContent"));new Ajax.Request(link.href,{method:"post",parameters:"",onComplete:this.processInfo.bindAsEventListener(this)})},toggleRegistration:function(){var a=
$("lightbox"),b=$("lightboxlogin"),f=$("lightboxregister"),c,g,h;"block"==f.style.display?(c="none",g="block",h="kred_purchase lightbox_login",active_user.focusFormField("username")):(c="block",g="none",h="kred_purchase",active_user.focusFormField("user_username"));b&&(b.style.display=g);f.style.display=c;a.className=h;metricTracker&&(metricTracker.trackEvent("Registration","begin_create"),metricTracker.trackPageView("/accounts/begin_create"))},showConfirmation:function(a){var b=$("lightboxregister"),
f=$("lightboxconfirm");b&&f?(b.style.display="none",f.style.display="block",a&&this.addOnCloseCallback(function(){window.location.href=a})):a&&(window.location.href=a)},handleWideRegistrationLightbox:function(){var a=$("email");a&&a.value&&(active_user.focusFormField("lightbox_registration_form_password"),window.lightbox_registration_form_validator.initializeObservers(),window.lightbox_registration_form_validator.suggester.fetchSuggestion())},onClose:function(){var a=this._on_close_callbacks;this._on_close_callbacks=
[];if(a)for(var b=arguments;0<a.length;)a.pop().apply(this,b);this.dispatchEvent({type:KonduitEvent.KONDUIT_MESSAGE,opcode:KonduitEvent.LIGHTBOX_CLOSED})},stopListening:function(){$$(".lbOn").each(function(a){a.stopObserving("click",a.observer_function,!0);a.getElementsBySelector("a").each(function(a){a.original_onclick&&(a.onclick=a.original_onclick,a.original_onclick=null)})})},dispatchLightboxOpened:function(a){this.dispatchEvent({type:KonduitEvent.KONDUIT_MESSAGE,opcode:KonduitEvent.LIGHTBOX_OPENED,
params:a?a:{width:DEFAULT_WIDTH,height:DEFAULT_HEIGHT}})}};function initialize(){addLightboxMarkup();lbox=document.getElementsByClassName("lbOn");for(i=0;i<lbox.length;i++)valid=new lightbox(lbox[i])}
function addLightboxMarkup(){bod=document.getElementsByTagName("body")[0];overlay=document.createElement("div");overlay.id="overlay";lb=document.createElement("div");lb.id="lightbox";lb.className="loading";lb.innerHTML='<div id="lbLoadMessage"><p><img src="/images/presentation/indicator.gif" class="indicator" style="width: 16px; height: 16px;" /> Loading</p></div>';bod.appendChild(overlay);bod.appendChild(lb)}function LikesHoverbox(){this.initialize()}
LikesHoverbox.prototype={initialize:function(){this._hoverboxCache={};this._timeout=this._currentHoverElement=this._currentUserAnchor=this._hoverbox=null;this._mouseOverHandler=this.handleMouseOverUser.bindAsEventListener(this);this.refreshMouseOverObservers()},refreshMouseOverObservers:function(){$$(".like_count").each(function(a){a.observe("mouseover",this._mouseOverHandler)}.bind(this))},handleMouseOverUser:function(a){0!=parseInt(a.target.innerHTML.gsub(/[()]/,""))&&(this.cancelOrCloseOpen(),
this._currentUserAnchor=this._currentHoverElement=a.target,this._timeout=setTimeout(this.openHoverbox.bindAsEventListener(this),500),this._currentHoverElement.observe("mouseleave",this.cancelOrCloseOpen.bindAsEventListener(this)))},openHoverbox:function(){var a=this._currentHoverElement.cumulativeOffset();document.viewport.getDimensions();var b={},f=this._currentHoverElement.up("li").id.sub("feed_item_",""),c=this._currentHoverElement.hasClassName("hover_profile_simple");this._likeHref="/user_likes?feed_item_id="+
f;c&&(b.simple="true");this._hoverbox=this._hoverboxCache[this._likeHref];null!=this._hoverbox&&(this._hoverbox.destroy(),this._hoverbox=null,this._hoverboxCache[this._likeHref]=null);null==this._hoverbox&&(this._hoverbox=new Control.Window(this._currentUserAnchor,{method:"GET",parameters:b,offsetLeft:30,offsetTop:-8,className:"hover_likes_window"}),this._hoverbox._is_simple=c,this._hoverbox.sourceContainer.stopObserving("click"),this._hoverbox.observe("afterDestroy",this.handleBoxDestroy.bindAsEventListener(this,
this._hoverbox)));this._hoverbox.observe("bringToFront",this.handleBoxBeforeOpen.bindAsEventListener(this));this._hoverbox.observe("afterOpen",this.handleBoxOpened.bindAsEventListener(this));this._hoverbox.options.position=[a[0],a[1]];this._hoverbox.href="/user_likes?feed_item_id="+f;this._hoverbox.open();this._currentHoverElement.stopObserving("mouseleave");this._currentHoverElement.observe("mouseleave",this.handleMouseLeaveUser.bindAsEventListener(this))},handleMouseLeaveUser:function(a){null!=
this._hoverbox&&(this._hoverbox.isOpen?(this._currentHoverElement.stopObserving("mouseleave"),this.startCloseTimeout()):this.cancelOrCloseOpen())},cancelOrCloseOpen:function(){null!=this._hoverbox&&(this._hoverbox.stopObserving("afterOpen"),this._hoverbox.container.stopObserving("mouseenter"),this._hoverbox.container.stopObserving("mouseleave"),this._hoverbox.ajaxRequest?(this._hoverbox.ajaxRequest.transport.abort(),this._hoverbox.close(),this._hoverbox.destroy()):this._hoverbox.close(),this._hoverbox=
null);this._currentHoverElement=this._currentUserAnchor=null;this.cancelTimeout()},cancelTimeout:function(){null!=this._timeout&&(clearTimeout(this._timeout),this._timeout=null)},startCloseTimeout:function(){this._timeout=setTimeout(this.mouseLeaveTimeout.bindAsEventListener(this),500)},mouseLeaveTimeout:function(a){this.cancelOrCloseOpen()},handleBoxBeforeOpen:function(a){a=document.viewport.getDimensions();this._currentHoverElement.cumulativeOffset()[0]+this._currentHoverElement.getWidth()/2>a.width-
440?(this._hoverbox.options.offsetLeft=-this._hoverbox.container.getDimensions().width,$(this._hoverbox.container).addClassName("profile_left"),$(this._hoverbox.container).removeClassName("profile_right")):(this._hoverbox.options.offsetLeft=this._currentHoverElement.getWidth()/2,$(this._hoverbox.container).addClassName("profile_right"),$(this._hoverbox.container).removeClassName("profile_left"))},handleBoxOpened:function(a){this._hoverboxCache[this._likeHref]=this._hoverbox;this._hoverbox.container.observe("mouseenter",
this.cancelTimeout.bindAsEventListener(this));this._hoverbox.container.observe("mouseleave",this.startCloseTimeout.bindAsEventListener(this));a=this._hoverbox.container.down(".mini_profile_bio");if(void 0!=a){var b=a.next(".mini_profile_data");a.setStyle({width:b.getWidth()-20+"px"});a.show()}},handleBoxDestroy:function(a,b){b.container.remove()}};function registerLikeObservers(){"undefined"==typeof likesHoverbox?likesHoverbox=new LikesHoverbox:likesHoverbox.refreshMouseOverObservers()}registerLikeObservers();
(function(){if("undefined"!=typeof active_user.currentLocale()&&"en-US"!=active_user.currentLocale()){var a=active_user.currentLocale().split("-");document.body.addClassName("lang_other");document.body.addClassName("lang_"+a[0])}}).runWhenReady();
var NoteWatcher={watch:function(){var a=$("note"),b=$("submit");""!=a.value?b.enable():(b.disable(),a.focus())},setFocus:function(){$("note")&&$("note").focus()}},navActivateSignIn=function(){if(!active_user.isAuthenticated()){$("guest_user_welcome_content").show();var a=$("welcome_username"),b=$("welcome_password"),f=$("welcome"),c=new PeriodicalExecuter(function(c){var d,f;a.getValue().empty()?$("welcome_username_label").show():($("welcome_username_label").hide(),d=!0);b.getValue().empty()?$("welcome_password_label").show():
($("welcome_password_label").hide(),f=!0);d&&f&&c.stop()},0.5);a.observe("focus",function(){f.hasClassName("expanded")||f.addClassName("expanded");$("remember_holder").show();$("forgot_holder").show();$("welcome_username_label").hide();c.stop()});a.observe("blur",function(){a.getValue().empty()&&$("welcome_username_label").show()});b.observe("focus",function(){f.hasClassName("expanded")||f.addClassName("expanded");$("remember_holder").show();$("forgot_holder").show();$("welcome_password_label").hide();
c.stop()});b.observe("blur",function(){b.getValue().empty()&&$("welcome_password_label").show()});var g=$("nav_sign_in").down("#game_id");g&&g.setValue(active_user.gameId());(function(){c.stop()}).delay(45)}};
Navigation=function(a,b){if(b){"community"==b&&(b="mykong");var f=$("main_nav_"+b);f&&f.down("a").addClassName("active")}a.addOnAuthenticatedObserver(function(){$("welcome").removeClassName("expanded")});a.addRunWhenAuthenticatedObserver(function(){new WelcomeBox(a,{onMouseOverNavTab:function(){},clearResetTimer:function(){}});Navigation.fixMyKong()})};
Navigation.loadContent=function(a){$j.each(["games","achievements","mykong"],function(b,f){var c=$j($j("#main_nav_"+f+" .main_nav_menu")[0]),g=HandlebarsTemplates["navigation/"+f+"_tab"](a);c.html(g)});$j(".main_nav_item").toggleClass("guest",!active_user.isAuthenticated())};Navigation.fixMyKong=function(){if(Prototype.Browser.IE9||Prototype.Browser.IE8)mykong=$j("#main_nav_mykong > .main_nav_menu"),mykong.css("height",""),mykong.data("height",""+mykong.height()+"px"),mykong.css("height","0px")};
Navigation.hasHeader=function(){return 0<$j("#header").length};Navigation.hasHeader()&&(Navigation.loadContent(navigationData),navigationData.user.authenticated||navActivateSignIn());
(function(a){a.widget("kongregate.paneSelector",{_create:function(){var a,f,c;f=[];a="li[data-country-code=non_targeted][data-locale=global]"+(", li[data-country-code=non_targeted][data-locale="+active_user.currentLocale()+"]");["US","GB"].include(active_user.countryCode())&&(a+=", li[data-country-code="+active_user.countryCode()+"_only][data-locale=global]",a+=", li[data-country-code="+active_user.countryCode()+"_only][data-locale="+active_user.currentLocale()+"]");"US"!=active_user.countryCode()&&
(a=a+", li[data-country-code=Rest_Of_World_only][data-locale=global]"+(", li[data-country-code=Rest_Of_World_only][data-locale="+active_user.currentLocale()+"]"));f.push(a);a="li[data-guest-only=false]";active_user.isAuthenticated()||(a+=", li[data-guest-only=true]");f.push(a);c=a=$j("li.home_feat_item");f.each(function(a){c=c.filter(a)});this._panes=c;a.not(c).remove();this._nitems=c.length;c.first().addClass("focus")}})})(jQuery);
PremiumOnlyLinks={attachHandlers:function(){$$("a.premium_only").each(function(a){var b=a.onclick?a.onclick.bind(a):null;a.onclick=PremiumOnlyLinks.capturedSelectorWrapper.bindAsEventListener(active_user,b)});$$(".premium_icon").each(function(a){a.observe("click",function(){active_user.isPremium()||(a.up(".game")?lightbox.prototype.initializePremiumMembershipPurchase("beta_game","beta_tab"):lightbox.prototype.initializePremiumMembershipPurchase("username_icon","icon_tab"))})});active_user.isPremium()||
active_user.createCSS(".premium_icon","cursor: pointer");active_user.addRunWhenAuthenticatedObserver(function(){active_user.isPremium()&&active_user.createCSS(".premium_icon","cursor: default")})},capturedSelectorWrapper:function(a,b){var f="function"==typeof b;if(this.isPremium()){if(f)return b(a)}else return lightbox.prototype.initializePremiumMembershipPurchase("beta_game","beta_tab"),Event.stop(a),!1}};
var ProgressBar=function(a,b){b||(b={});this.value=b.value||0;this.maxValue=b.maxValue||100;a.addClassName("progress-bar");this.bar=new Element("div",{"class":"progress-bar-bar"});a.insert(this.bar);this.label=new Element("span",{"class":"progress-bar-label"});this.bar.insert(this.label);this.updateDisplay()};ProgressBar.prototype.setValue=function(a){this.value=a;this.updateDisplay()};ProgressBar.prototype.setMaxValue=function(a){this.maxValue=a;this.updateDisplay()};
ProgressBar.prototype.updateDisplay=function(){this.label.update('<a href="/accounts/'+active_user.getAttributes().username+'/points">'+this.value+" PTS</a>");var a=100*(this.value/this.maxValue);this.bar.setStyle({width:a+"%"});25>a&&this.label.addClassName("low_value")};function RatingHoverbox(a){this.initialize(a)}
RatingHoverbox.prototype={initialize:function(a){var b=a.userRating,f=a.ratedAlready,c=a.prefix,g=a.additionalHoverText,h=a.hoverClass,d=$(a.boxLocation),k=a="";void 0!=b&&(rating_value="number"==typeof b.rating?b.rating:b.rating.rating);void 0==b?a="You have already earned the 50 point maximum for ratings per day. Come back tomorrow to rate more!":f?4<=rating_value&&g?(a=String(g||""),k=h):a="You have updated your rating.":4<=rating_value&&g?(a=String(g||""),k=h):a="Sweet! You earned 1 point and improved your recommendations.";
var n;void 0==d&&(d=$(c+"rating-indicator").next(".star-rating"));void 0==d&&(d=$$("#star_ratings_block"+c.sub("game","").sub("-","")+" .star-rating-big").first());void 0==d&&(d=$(c+"rating-indicator").next(".star-rating-big"));d.addClassName("rating_message_hover_anchor");d.visible()||d.show();n=new Control.Window(null,{closeOnClick:!0,position:"relative",offsetLeft:d.getWidth()+11,offsetTop:function(){return"quicklinks_"==c?d.getHeight()/2-n.container.getHeight()+12:d.getHeight()/2-12}});n.observe("afterClose",
function(){n.destroy()});n.sourceContainer=d;n.container.insert('<div class="'+("quicklinks_"==c?"hover_high ":"")+"rating_message hover_item hover_long "+k+'"><div class="hover_arrow_1"></div><div class="hover_arrow_2"></div><div class="hover_container pam media"><span class="rating_icon spritesite img"></span><p class="bd">'+a+"</p></div></div>");n.open();setTimeout(function(){n.close()},8E3);this.ratingHoverBox=n}};
(function(a){function b(b){b=a(b.target).attr("data-rating");this.element.ratingUnit("setRating",b)}function f(a){this.element.ratingUnit("resetRating")}function c(b){b=a(b.target).attr("data-rating");this.element.ratingUnit("submitUserRating",b)}a.widget("kongregate.ratingUnit",{options:{callbacks:a([])},_create:function(){var g=this;this._calculateStarRatings();this.resetRating();this._on(this.element.find(".js-star"),{mouseenter:b,click:c});this._on({mouseleave:f});active_user.isAuthenticated()&&
(!this.options.predictedRating&&!this.options.userRating)&&a.getJSON("/game_ratings.json",{game_id:this._getGameId()}).done(function(a){g.setUserRating(a.rating)})},setRating:function(a){this.element.children(".js-star-group").width(20*parseFloat(a)+"%");return this},resetRating:function(){this.options.userRating?(this.element.addClass("rated"),this.element.removeClass("predicted"),this.setRating(this.options.userRating)):this.options.predictedRating?(this.element.addClass("predicted"),this.setRating(this.options.predictedRating)):
this.setRating(this.element.attr("data-game-rating"));return this},submitUserRating:function(b){var c=this;active_user.isAuthenticated()?a.ajax("/game_ratings.json",{type:"POST",dataType:"json",data:{user_id:active_user.id(),game_id:this._getGameId(),rating:b}}).done(function(a){c._sameGameRatingUnits().ratingUnit("setUserRating",b);var f="update"==a.action;a=a.success?{rating:b}:void 0;"yes"!==c._skipRatingHover()&&(c.options.ratingHoverBox=(new RatingHoverbox({userRating:a,ratedAlready:f,boxLocation:c.element[0]})).ratingHoverBox);
c.options.callbacks.each(function(){this()})}):active_user.activateInlineLogin({},!0)},setUserRating:function(a){this._setOption("userRating",a).resetRating()},hideRatingHoverBox:function(){this.options.ratingHoverBox&&this.options.ratingHoverBox.close()},addCallback:function(a){this.options.callbacks.push(a)},_sameGameRatingUnits:function(){return a(".js-rating-unit[data-game-id="+this._getGameId()+"]")},_getGameId:function(){return this.element.attr("data-game-id")},_skipRatingHover:function(){return this.element.attr("data-skip-rating-hover")},
_calculateStarRatings:function(){this.element.find(".js-star").each(function(){a(this).attr("data-rating",a(this).parent().find(".js-star").index(this)+1)})}});Kongregate.lightUpRatingUnits=function(){a(".js-rating-unit").ratingUnit()}})(jQuery);var RegistrationBirthDateDisplay=function(a){"undefined"!=typeof a&&a&&(this._yearSelect=a.down('[name="user[birth_date(1i)]"]'),this._monthSelect=a.down('[name="user[birth_date(2i)]"]'),this._daySelect=a.down('[name="user[birth_date(3i)]"]'),this.convertToYearOnly(a))};
RegistrationBirthDateDisplay.prototype.convertToYearOnly=function(a){function b(){var a;a=parseInt(this$._yearSelect.value,10);var b=parseInt(this$._monthSelect.value,10)-1,c=parseInt(this$._daySelect.value,10)||1;a=new Date(a,b,c);a=Date.now()-a.getTime();a=Math.abs((new Date(a)).getUTCFullYear()-1970);b=active_user.ageOfConsent();13>a?($j(".registration_age_concern").val("coppa"),g.hide(),h.hide()):a<b?($j(".registration_age_concern").val("parent"),h.show(),g.hide()):($j(".registration_age_concern").val("false"),
g.show(),h.hide())}function f(a,b){a.hide();a.value=b;a.disabled=!0}a=this._yearSelect.up(".form_block").down("label");var c=(new Date).getFullYear(),g=$j(".privacy_form_block"),h=$j(".parental_consent_form_block");this$=this;f(this._daySelect,"31");f(this._monthSelect,"12");a.update("When were you born?");this._yearSelect.insert({after:this._daySelect});this._yearSelect.insert({after:this._monthSelect});g.hide();h.hide();this._yearSelect.observe("change",function(){if(this.value>=c-active_user.ageOfConsent()){var a=
this$._daySelect;a.value="";a.show();a.disabled=!1;a=this$._monthSelect;a.value="";a.show();a.disabled=!1;$j(".registration_form_date_select").after(" ");$j(".lightbox_registration_form_date_select").after(" ")}else f(this$._daySelect,"31"),f(this$._monthSelect,"12"),$j(".registration_age_concern").val("false"),g.show(),h.hide()});this._monthSelect.observe("change",function(){b()});this._daySelect.observe("change",function(){b()})};UsernameSuggester=function(a){this.initialize(a)};
UsernameSuggester.prototype={initialize:function(a){a=$j.extend({},a);this.email=a.email;this.success=a.success;this.userEntered=!1},fetchSuggestion:function(){this.userEntered||this.email&&$j.getJSON("/accounts/suggest_username",{email:this.email},this.success)}};RegistrationFormValidator=function(a,b){this.initialize(a,b)};
RegistrationFormValidator.prototype={initialize:function(a,b){this.form_id=a;this.form_ele=$(a);this.captcha_reset_function=b;if(!this.form_ele)return null;if(active_user.underage())return this.showAgeMessage(),null;active_user.defaultToOptOut()&&$j(".opt-in-chk").prop("checked",!1);this.observers_initialized=!1;this.username=this.form_ele.down(this.prefixId("input#%s_username"));this.username_block=this.form_ele.down(this.prefixId("div#%s_username_block"));this.password=this.form_ele.down(this.prefixId("input#%s_password"));
this.email_address=this.form_ele.down(this.prefixId("input#%s_email_address"));this.birthdate=this.form_ele.down(this.prefixId("div#%s_birth_date_control_block"));this.submit_button=this.form_ele.down(this.prefixId("input#%s_submit_button"));this.base_error_ele=this.form_ele.down(this.prefixId("#%s_base_errors"));"sign-up-form"==this.form_id&&(this.base_error_ele=this.form_ele.down("#registration_form_base_errors"));try{this.email_address.focus()}catch(f){}this.suggester=new UsernameSuggester({success:function(a){c.clearErrorMessages(c.username);
c.username.removeClassName("with_error");a.suggestion&&(c.username.setValue(a.suggestion),c.displaySuccessMessage(c.username,tr8nProxy.tr("Here's our suggestion, but feel free to change it.")),c.username_block.addClassName("suggested"))}});var c=this;[this.username,this.password,this.email_address].each(function(a){a.observe("keypress",function(){c.initializeObservers()})});$j(".registration_form_date_select").on("change",function(){c.initializeObservers()})},initializeObservers:function(){if(!this.observers_initialized){var a=
this;new AvailabilityCheck(a.username,{clear:function(){$$(".name_validation").each(Element.remove);a.clearErrorMessages(a.username);a.username.removeClassName("with_error")},success:function(){$$(".name_validation").each(Element.remove);a.displaySuccessMessage(a.username,tr8nProxy.tr("Username available!"))},failure:function(b){$$(".name_validation").each(Element.remove);a.addErrorMessage(a.username,b)},validateLength:!0});this.password.observe("blur",function(b){b=b.element();a.clearErrorMessages(b);
a.validatePresence(b,"Password")&&a.validateMinimumLength(b,"Password",5)&&(b.removeClassName("with_error"),a.displaySuccessMessage(b))});this.email_address.observe("blur",function(b){b=b.element();a.clearErrorMessages(b);a.validatePresence(b,"Email address")&&a.validateEmailAddress(b)&&(b.removeClassName("with_error"),a.displaySuccessMessage(b),a.suggester.email=b.getValue(),a.suggester.fetchSuggestion())});this.username.observe("change",function(b){a.suggester.userEntered=!0;a.username_block.removeClassName("suggested")});
this.observers_initialized=!0}},validatePresence:function(a,b){return""===a.getValue()?(this.addErrorMessage(a,b+" can't be blank"),!1):!0},validateMinimumLength:function(a,b,f){return a.getValue().length<f?(this.addErrorMessage(a,b+" is too short","",{minimum:f}),!1):!0},validateEmailAddress:function(a){return!a.getValue().match(RFC822SingleEmailRegex)?(this.addErrorMessage(a,"Email Address is invalid"),!1):!0},displaySuccessMessage:function(a,b,f){a=$(this.errorElementId(a,f));a.insert((new Element("span",
{"class":"name_validation validation_symbol availability_success"})).update(b||"&nbsp;"));a.addClassName("success")},addErrorMessage:function(a,b,f,c){a&&a.addClassName("with_error");"base"==f?(this.base_error_ele.update(b),this.base_error_ele.style.display="block"):(a=$(this.errorElementId(a,f)),a.update(tr8nProxy.tr(b,"",c)),a.removeClassName("success"),this.markFormAsHavingErrors())},markFormAsHavingErrors:function(){var a=this.form_ele.up(".form_parent");a&&a.addClassName("form_errors")},clearErrorMessages:function(a){$(this.errorElementId(a)).innerHTML=
""},prefixId:function(a){return a.sub("%s",this.form_id)},buildBirthdate:function(){var a=this.prefixId(".%s_date_select"),a=$$(a),b=[],a=a.sortBy(function(a){a=a.readAttribute("name");return parseInt(a[a.indexOf("(")+1],10)});a.collect(function(a){b.push(a.getValue())});return b.join("-")},errorElementId:function(a,b){var f="";return f=a?a.id+"_error_block":$(this.prefixId("%s_"+b+"_error_block"))},clearAllErrorMessages:function(){$$(".error_block").each(function(a){a.innerHTML=""})},updateErrorMessages:function(a){this.base_error_ele&&
"undefined"!=typeof a.base&&(this.base_error_ele.style.display="none");if(this.notUnderage(a)){this.submit_button&&this.submit_button.restore();this.clearAllErrorMessages();var b=this;$H(a).each(function(a){var c=$(b.prefixId("%s_"+a.key));b.addErrorMessage(c,a.value,a.key)});"undefined"!==typeof this.captcha_reset_function&&this.captcha_reset_function&&this.captcha_reset_function()}},notUnderage:function(a){return $H(a).any(function(a){return a.value.match(/minimum age/)})?(this.showAgeMessage(),
!1):!0},showAgeMessage:function(){this.form_ele.update(tr8nProxy.tr("We're sorry, you do not meet the minimum age for this site."))},showIpLimitMessage:function(){this.form_ele.update(tr8nProxy.tr("Your account could not be created at this time. Please try again later."))}};function Roller(a){this.initialize(a)}
Roller.prototype={initialize:function(a){this._container=$(a.container);this._scrollDelay=a.scrollDelay;this._currentPane=0;this._paneScrollTimer=null;this._scrollDuration=a.scrollDuration?(a.scrollDuration||8E3)/1E3:1;this._effect=null;this._scrollablePane=$(a.scrollablePane)||this._container.down(".js-roller-scrollable");this._scrollCallbacks=[];this._showDots=void 0===a.showDots?!0:a.showDots;this._skipPaneClone=this._container.getAttribute("skip-pane-clone");var b,f,c;f=[];a.targetableCountryCodes&&
(b=".ind_pane.non_targeted.global, .ind_pane.non_targeted."+active_user.currentLocale(),a.targetableCountryCodes.include(active_user.countryCode())&&(b+=", .ind_pane."+active_user.countryCode()+"_only.global",b+=", .ind_pane."+active_user.countryCode()+"_only."+active_user.currentLocale()),"US"!=active_user.countryCode()&&(b=b+", .ind_pane.Rest_Of_World_only.global"+(", .ind_pane.Rest_Of_World_only."+active_user.currentLocale())),f.push(b));a.hasGuestOnlyItems&&(b=".ind_pane.not_guest_targeted",active_user.isAuthenticated()||
(b+=", .ind_pane.guest_only"),f.push(b));c=a=$j(this._scrollablePane).children(".ind_pane");f.each(function(a){c=c.filter(a)});this._panes=c;a.not(c).hide();if((this._nitems=c.length)&&!c[0].hasClassName("volatile")&&!c[0].hasClassName("loaded"))this._panes_loaded=[],this.loadPaneNumber(0);!this._skipPaneClone&&0<c.length&&(f=c[0].clone(!0),c[c.length-1].insert({after:f}),c.push(f));this._panes_loaded=c.map(function(a,b){return b.match(".volatile, .loaded")})},scrollToPane:function(a){this.loadPaneNumber(a);
var b=this._panes[a];a=b.positionedOffset();var f=this._scrollDuration;this._effect&&this._effect.cancel();this._effect=new Effect.Morph(this._scrollablePane,{style:"left:"+-a[0]+"px; top:0px;",duration:f,afterFinish:function(){$j(document).trigger("roller:rollComplete",[b])}});this._showDots&&this._container&&(this._container.down(".pane_dots").descendants().each(function(a){a.hasClassName("roller_dot")&&a.removeClassName("active_dot").addClassName("inactive_dot")}),this._container.down(".pane_dots").down(".dot_"+
(this._currentPane<this._nitems?this._currentPane:0)).removeClassName("inactive_dot").addClassName("active_dot"));var c=this._currentPane;this._scrollCallbacks.each(function(a){a(c)})},setPane:function(a){this.loadPaneNumber(a);var b=this._panes[a].positionedOffset();this._currentPane=a;this._effect&&this._effect.cancel();this._scrollablePane.setStyle({left:-b[0]+"px",top:"0px"})},loadPaneNumber:function(a){if(!this._panes_loaded[a]){var b=this._panes[a];this._panes_loaded[a]=!0;b.update(Base64.decode(b.down(".pane_contents").innerHTML));
b.addClassName("loaded");$H(active_user.split_treatments.feature_roll).each(function(a){$$(".ind_pane."+a[0]+" div.featured_split_treatment").each(Element.hide);$$("."+a.join(" div.")).each(Element.show)})}},scrollToNextPane:function(){this.scrollToNextPaneAndStop();this.setNextPaneScrollTimeout()},scrollToNextPaneAndStop:function(){clearTimeout(this._paneScrollTimer);this._hasClonedPane()?(this._currentPane==this._nitems&&(this._currentPane=0,this.isEffectRunning()||this.setPane(this._currentPane)),
this._currentPane++):this._currentPane=this._currentPane==this._nitems-1?0:this._currentPane+1;this.scrollToPane(this._currentPane)},scrollToPreviousPaneAndStop:function(){clearTimeout(this._paneScrollTimer);this._hasClonedPane()?(0===this._currentPane&&(this._currentPane=this._nitems,this.isEffectRunning()||this.setPane(this._currentPane)),this._currentPane--):this._currentPane=0===this._currentPane?this._nitems-1:this._currentPane-1;this.scrollToPane(this._currentPane)},scrollToPreviousPane:function(){this.scrollToPreviousPaneAndStop();
this.setNextPaneScrollTimeout()},setNextPaneScrollTimeout:function(){this._paneScrollTimer=setTimeout(this.scrollToNextPane.bind(this),this._scrollDelay)},isEffectRunning:function(){return this._effect&&"finished"!=this._effect.state},addOnScrollObserver:function(a){this._scrollCallbacks.push(a)},paneCount:function(){return this._nitems},stopScrolling:function(){clearTimeout(this._paneScrollTimer)},_hasClonedPane:function(){return!this._skipPaneClone}};Roller.rolodex={};
Roller.attachRollers=function(){$$(".js-roller").each(function(a){!Roller.rolodex[a.getAttribute("pod-name")]&&0<parseInt(a.getAttribute("pod-panes-count"),10)&&(Roller.rolodex[a.getAttribute("pod-name")]=new Roller({scrollDuration:500,container:a.id,showDots:!!a.down(".pane_dots")}))})};Roller.attachRollers();function AjaxRoller(a){this.initialize(a)}AjaxRoller.prototype=Object.extend(AjaxRoller.prototype,Roller.prototype);
AjaxRoller.prototype=Object.extend(AjaxRoller.prototype,{loadPaneNumber:function(a){if(!this._panes_loaded[a]){var b=this,f=document.location.pathname.split("/")[2];new Ajax.Request("/accounts/"+f+"/games_pod",{method:"get",parameters:{page:this._currentPane},onSuccess:function(c){c=c.responseJSON;var f=b._panes[a];b._panes_loaded[a]=!0;f.update(c.html);f.addClassName("loaded");active_user.isAdmin()&&$$(".admin_controls").each(Element.show)}})}}});AjaxRoller.rolodex={};
var Shim={shimaphore:!1,lock:function(){shimaphore=!0},unlock:function(){shimaphore=!1},shimElement:function(a,b){var f=$("shim")||this.createShim();f.show();f.absolutize();f.clonePosition(a);"undefined"!==typeof b&&f.writeAttribute("data-caller",b);this.hideIframe()},hide:function(a){if(!shimaphore){a="undefined"!==typeof a?a:null;var b=$("shim");b&&a==b.readAttribute("data-caller")&&(b.writeAttribute("data-caller",null),b.hide());this.showIframe()}},createShim:function(){var a=new Element("iframe",
{id:"shim",style:"display:none; z-index:1 ; border: 0;"});a.setOpacity(0);document.body.insert({top:a});return a},hideIframe:function(){var a=$("gameiframe");a&&!a.hasClassName("dont_hide")&&a.up("#game").setStyle({top:"-10000px",left:"-10000px"})},showIframe:function(){var a=$("gameiframe");a&&!a.hasClassName("dont_hide")&&a.up("#game").setStyle({top:"",left:""})}};function showTrailerPopup(a){window.open(a,"","width=520,height=400,status=no,resizable=no,scrollbars=no")}
var SiteStatsUpdater=function(){var a=new Template("<strong>#{users_online_count_with_delimiter}</strong> online playing <strong>#{games_count_with_delimiter}</strong> free games!"),b=new Template('<a onclick="holodeck.showChatTab(); return false;" href="#" class="spritegame">Join #{people_online_text} in chat right now!</a>');return{update:function(){(function(){new Ajax.Request("/site_stats.json",{method:"get",onSuccess:function(f){f=f.responseJSON;$("playing").update(a.evaluate(f));$("holodeck_chat_promotion")&&
$("holodeck_chat_promotion").update(b.evaluate(f));if(ls)try{metricTracker.trackEvent("LoadTime","SiteStatsFinished",document.location.pathname,(new Date).getTime()-ls)}catch(c){}}})}).runWhenDomLoaded(!0)}}}();function SkinChooser(a){this.initialize(a)}
SkinChooser.prototype={initialize:function(a){this._current_skin_class=a||"";this._default_style="background:#eee url(/images/default_profile_bg.png) repeat-x 0 0;";Roller.rolodex.user_skin_chooser=new Roller({scrollablePane:"user_skin_chooser_scrollable",scrollDuration:500,container:"user_skin_chooser_container",showDots:!1});try{$("new_user_skin").down(".scroll_left").observe("click",function(){Roller.rolodex.user_skin_chooser.scrollToPreviousPaneAndStop()}),$("new_user_skin").down(".scroll_right").observe("click",
function(){Roller.rolodex.user_skin_chooser.scrollToNextPaneAndStop()})}catch(b){}},updateSkin:function(a,b,f){$("skins_pod_spinner").visible()||($("skins_pod_spinner").show(),$("user_skin_skin_id").value=a,$("new_user_skin").onsubmit(),$("primarywrap").setStyle(b),this.setBodyClass(f),$("new_user_skin").hide())},setDefault:function(){$("skins_pod_spinner").visible()||($("skins_pod_spinner").show(),$("new_user_skin").hide());this.setBodyClass("");$("primarywrap").setStyle(this._default_style)},setBodyClass:function(a){var b=
$$("body").first();b.removeClassName(this._current_skin_class);this._current_skin_class=a;b.addClassName(this._current_skin_class)},onSkinSet:function(){$("skins_pod_spinner").hide();$("new_user_skin").show()}};
Element.addMethods({textNodes:function(a){return $A(a.childNodes).map(function(a){return 3==a.nodeType?[a]:1==a.nodeType?$(a).textNodes():[]}).flatten()},splitLongWords:function(a){var b=/\S{30,}/;a.textNodes().each(function(a){for(var c=a.parentNode,g;0<=(g=a.nodeValue.search(b));)if(/http:/.test(a.nodeValue.substr(0,g+30)))if(/^\s/.test(a.nodeValue))g=a.nodeValue.search(/\S/),a=a.splitText(g);else if(0<=(g=a.nodeValue.search(/\s+/)))a=a.splitText(g);else break;else a=a.splitText(g+30),c.insertBefore(Prototype.Browser.IE?
document.createElement("wbr"):document.createTextNode(String.fromCharCode(8203)),a)})}});$$(".splittext").invoke("splitLongWords");
function TrackingCodeService(a){var b=a.dataProvider,f=a.metricTracker,c={},g=function(){d(b().tracking_code,function(a){f.trackPageView(a);(a=k(a))&&f.trackEvent(a[0],a[1])});b().tracking_code=void 0},h=function(){d(b().minor_tracking_code,function(a){(a=k(a))&&f.trackEvent(a[0],a[1])});b().minor_tracking_code=void 0},d=function(a,b){if(a&&f){var d=(new Date).getTime(),g=c[a];if(!g||15E3<d-g)c[a]=d,b(a)}},k=function(a){if(!a)return null;if((a=a.match(/^\/([^\/]*)\/(.*)$/))&&3==a.length)return[TrackingCodeService.TRACKING_CODE_EVENT_CATEGORIES[a[1]],
a[2]]};a=function(){g();h()};a();return{reportTrackingCode:a}}TrackingCodeService.TRACKING_CODE_EVENT_CATEGORIES={games:"GameSubmission",accounts:"Registration",sessions:"Sessions"};
$j(document).on("click",function(a){var b=a.target,f=$j(b).parents(".click_box").length,c=$j(b).hasClass("click_box"),g;f&&(g=$j(b).parents(".click_box").find(".click_link").attr("href"));c&&(g=$j(b).find(".click_link").attr("href"));if(f&&!a.altKey&&g||c&&!a.altKey&&g)a.preventDefault(),a.stopPropagation(),$j(b).find(".click_link").attr("target")||a.metaKey||a.ctrlKey?window.open(g,"_blank"):window.location=g});
UniversalTabs=function(){var a=0,b=function(b){var f=b.readAttribute("href"),h="dynamic-tab-"+a++,d=b.up(".tab_container").down(".tab_group");b.writeAttribute("href","#"+h);d.insert({bottom:(new Element("div",{id:h,"class":"tab"})).update('<span class="spinner spinner_big">Loading...</span>')});new Ajax.Request(f,{method:"get",evalScripts:!0,onSuccess:function(a){$(h).update(a.responseText)},onFailure:function(a){$(h).update("")}})},f=function(a){var b=a.readAttribute("href"),b=$(b.sub("#",""));b.siblings().each(function(a){a.removeClassName("active")});
b.addClassName("active");a.up().siblings().each(function(a){a.down().removeClassName("active")});a.addClassName("active")};return{setup:function(){$$(".tab_container").each(function(a){$(a).addClassName("js")});$$(".tab_container .tab_index a").each(function(a){a.hasClassName("active")&&!a.readAttribute("href").include("#")&&(b(a),f(a));a.observe("click",function(g){g.stop();a.readAttribute("href").include("#")||b(a);f(a)})})}}}();UniversalTabs.setup();
jQuery.ajaxPrefilter(function(a,b,f){a.crossDomain||(a=jQuery('meta[name="csrf-token"]').attr("content"))&&f.setRequestHeader("X-CSRF-Token",a)});jQuery.csrfPost=function(a){a=jQuery.extend({},a,{type:"POST",beforeSend:function(a){a.setRequestHeader("X-CSRF-Token",jQuery('meta[name="csrf-token"]').attr("content"))}});return jQuery.ajax(a)};
jQuery.csrfDelete=function(a){a=jQuery.extend({},a,{type:"DELETE",beforeSend:function(a){a.setRequestHeader("X-CSRF-Token",jQuery('meta[name="csrf-token"]').attr("content"))}});return jQuery.ajax(a)};UserActionCounter=function(a){this.initialize(a)};
UserActionCounter.prototype={initialize:function(a){a=$j.extend({},a);this._usernameSigil="<USERNAME>";this._counterNameSigil="<COUNTERNAME>";this._urlBase="/accounts/"+this._usernameSigil+"/user_action_counters/"+this._counterNameSigil;this.username=a.username;this.counterName=a.counterName},buildUrl:function(){return this._urlBase.replace(this._usernameSigil,this.username).replace(this._counterNameSigil,this.counterName)},count:function(a){$j.getJSON(this.buildUrl()+"/count.json",a)},increment:function(a){$j.csrfPost({url:this.buildUrl()+
"/increment.json",success:a})}};function UserProfileHoverbox(){this.initialize()}
UserProfileHoverbox.prototype={initialize:function(){this._hoverboxCache={};this._timeout=this._currentHoverElement=this._currentUserAnchor=this._hoverbox=null;this._mouseOverHandler=this.handleMouseOverUser.bindAsEventListener(this);this.registerHoverProfileObservers()},registerHoverProfileObservers:function(){$j(document).on("mouseover",".hover_profile, .hover_profile_simple",this.handleMouseOverUser.bind(this))},handleMouseOverUser:function(a){a=a.currentTarget;var b=a.hasClassName("js_hover_profile_link")?
a:a.select("a.js_hover_profile_link")[0]||$j(a).parent().find("a")[0]||null;if(null!=b&&(b.hasClassName("js_hover_profile_link")||b.hasClassName("hover_profile")||b.hasClassName("hover_profile_simple"))&&!(null!=b&&null!=this._currentUserAnchor&&b.href==this._currentUserAnchor.href))this.cancelOrCloseOpen(),this._currentHoverElement=a,this._currentUserAnchor=b,this._timeout=setTimeout(this.openHoverbox.bindAsEventListener(this),500),this._currentHoverElement.observe("mouseleave",this.cancelOrCloseOpen.bindAsEventListener(this))},
openHoverbox:function(){var a=this._currentHoverElement.getBoundingClientRect();document.viewport.getDimensions();var b={},f=this._currentHoverElement.hasClassName("hover_profile_simple");f&&(b.simple="true");this._hoverbox=this._hoverboxCache[this._currentUserAnchor.href];null!=this._hoverbox&&this._hoverbox._is_simple!=f&&(this._hoverbox.destroy(),this._hoverbox=null,this._hoverboxCache[this._currentUserAnchor.href]=null);null==this._hoverbox&&(this._hoverbox=new Control.Window(this._currentUserAnchor,
{method:"GET",parameters:b,offsetLeft:30,offsetTop:-22,className:"hover_profile_window"}),this._hoverbox._is_simple=f,this._hoverbox.sourceContainer.stopObserving("click"),this._hoverbox.observe("afterDestroy",this.handleBoxDestroy.bindAsEventListener(this,this._hoverbox)));this._hoverbox.observe("bringToFront",this.handleBoxBeforeOpen.bindAsEventListener(this));this._hoverbox.observe("afterOpen",this.handleBoxOpened.bindAsEventListener(this));this._hoverbox.options.position=[a.left+this.getPageOffsets().x,
a.top+this.getPageOffsets().y];this._hoverbox.href+="/show_hover";this._hoverbox.open();this._currentHoverElement.stopObserving("mouseleave");this._currentHoverElement.observe("mouseleave",this.handleMouseLeaveUser.bindAsEventListener(this))},getPageOffsets:function(){if("undefined"!==typeof window.pageXOffset)return{x:window.pageXOffset,y:window.pageYOffset};e="CSS1Compat"===document.compatMode?window.document.documentElement:window.document.body;return{x:e.scrollLeft,y:e.scrollTop}},handleMouseLeaveUser:function(a){null!=
this._hoverbox&&(this._hoverbox.isOpen?(this._currentHoverElement.stopObserving("mouseleave"),this.startCloseTimeout()):this.cancelOrCloseOpen())},cancelOrCloseOpen:function(){null!=this._hoverbox&&(this._hoverbox.stopObserving("afterOpen"),this._hoverbox.container.stopObserving("mouseenter"),this._hoverbox.container.stopObserving("mouseleave"),this._hoverbox.ajaxRequest?(this._hoverbox.ajaxRequest.transport.abort(),this._hoverbox.close(),this._hoverbox.destroy()):this._hoverbox.close(),this._hoverbox=
null);this._currentHoverElement=this._currentUserAnchor=null;this.cancelTimeout()},cancelTimeout:function(){null!=this._timeout&&(clearTimeout(this._timeout),this._timeout=null)},startCloseTimeout:function(){this._timeout=setTimeout(this.mouseLeaveTimeout.bindAsEventListener(this),500)},mouseLeaveTimeout:function(a){this.cancelOrCloseOpen()},handleBoxBeforeOpen:function(a){a=document.viewport.getDimensions();this._currentHoverElement.cumulativeOffset()[0]+this._currentHoverElement.getWidth()/2>a.width-
440?(this._hoverbox.options.offsetLeft=-this._hoverbox.container.getDimensions().width,$(this._hoverbox.container).addClassName("profile_left"),$(this._hoverbox.container).removeClassName("profile_right"),$(this._hoverbox.container).down().addClassName("hoverbox_left"),$(this._hoverbox.container).down().removeClassName("hoverbox")):(this._hoverbox.options.offsetLeft=this._currentHoverElement.getWidth()/2,$(this._hoverbox.container).addClassName("profile_right"),$(this._hoverbox.container).removeClassName("profile_left"),
$(this._hoverbox.container).down().addClassName("hoverbox"),$(this._hoverbox.container).down().removeClassName("hoverbox_left"))},handleBoxOpened:function(a){this._hoverboxCache[this._currentUserAnchor.href]=this._hoverbox;this._hoverbox.container.observe("mouseenter",this.cancelTimeout.bindAsEventListener(this));this._hoverbox.container.observe("mouseleave",this.startCloseTimeout.bindAsEventListener(this));a=this._hoverbox.container.down(".mini_profile_bio");void 0!=a&&(a.setStyle({width:a.getWidth()+
"px"}),a.show())},handleBoxDestroy:function(a,b){b.container.remove()}};userProfileHoverbox=new UserProfileHoverbox;function UserProgressBar(a){this.initialize(a)}
UserProgressBar.prototype={initialize:function(a){this._active_user=a;this._progress_bar_container_node=$("user_progress_bar_container");this._progress_bar_steps_node=$("user_progress_bar_steps");this._target_node=$("progress_bar_target");this._active_step=null;this._progress_step_elements=this.makeListItemsForAvailableSteps();this.updateProgress()},updateProgress:function(){$("user_progress_preview").down(".tooltip").innerHTML=this._active_user.progressBarPercentPerStep()+"%";this._active_user.isKlientProgressBar()&&
($("klient_progress_bar_message").setStyle({display:"block"}),$("kongregate_progress_bar_message").setStyle({display:"none"}),$("user_progress_reward_image2").setStyle({display:"block"}),$("user_progress_close").addClassName("icon--klient"),$("user_progress_bar_frame").addClassName("progress--klient"),$("user_progress_bar").addClassName("bar--klient"),$("user_progress_preview").addClassName("preview--klient"),$("progress_bar_previous_control").addClassName("prev--klient"),$("progress_bar_next_control").addClassName("next--klient"),
$("user_progress_bar_steps").addClassName("step-list--klient"));var a=this,b=this._active_user.progressBarPercentComplete()+"%";$("user_progress_percentage_number").update(b);$("user_progress_bar").setStyle({width:b});this._active_user.onOwnProfilePage()?$("progress_bar_hide_control").remove():$("progress_bar_hide_control").observe("click",function(b){Event.stop(b);a.hideBar();return!1});this._target_node&&(this._progress_bar_container_node.remove(),this._target_node.update(this._progress_bar_container_node));
this._active_user.showProgressBarCompletionMessage()?(this._progress_bar_container_node.down(0).addClassName("complete"),this._active_user.isKlientProgressBar()&&this._progress_bar_container_node.down(0).addClassName("complete--klient")):(this._progress_step_elements.each(function(b){a._progress_bar_steps_node.insert(b)}),a._active_user.isGamePage()&&$$(".user_step_link").map(function(a){a.observe("click",function(b){Event.stop(b);window.open(a.href);return!1})}),$("progress_bar_next_control").observe("click",
function(b){Event.stop(b);a.gotoNextStep();return!1}),$("progress_bar_previous_control").observe("click",function(b){Event.stop(b);a.gotoPrevStep();return!1}),$$(".user-step-link").invoke("observe","mouseenter",function(a){$("user_progress_preview").addClassName("show")}).invoke("observe","mouseleave",function(a){$("user_progress_preview").removeClassName("show")}),this._active_step=this._progress_bar_steps_node.down("li").addClassName("active"));this._progress_bar_container_node.show()},makeListItemsForAvailableSteps:function(){var a=
this,b=new Template($("user_progress_bar_step_template").innerHTML);return this._active_user.availableProgressBarSteps().map(function(f){return b.evaluate({icon_id:f[0]+"_icon",link_content:f[1],link_path:f[2].sub("Guest",a._active_user.username()),klient_step:a._active_user.isKlientProgressBar()?"step--klient":"",onclick_content:a._active_user.isGamePage()?'onclick="window.open(this.href);return false"':""})})},gotoNextStep:function(){var a=this._active_step.readAttribute("id"),b=this.nextStep().readAttribute("id");
$(a).removeClassName("active").removeClassName("f-prev").removeClassName("f-next");$(b).addClassName("active f-next");this._active_step=this.nextStep()},gotoPrevStep:function(){var a=this._active_step.readAttribute("id"),b=this.prevStep().readAttribute("id");$(a).removeClassName("active").removeClassName("f-prev").removeClassName("f-next");$(b).addClassName("active f-prev");this._active_step=this.prevStep()},nextStep:function(){return this._active_step.next(0)||this._active_step.siblings().first()},
prevStep:function(){return this._active_step.previous(0)||this._active_step.siblings().last()},hideBar:function(){if(Cookie.get("kong_progress_bar_hidden")){var a=$("progress_never_show_again_message"),b=$("progress_never_show_again_confirm"),f=$("progress_never_show_again_deny"),c=this;b.observe("click",function(b){a.remove();Event.stop(b);new Ajax.Request("/accounts/"+c._active_user.username()+"/progress_bar_opt_out",{method:"post",onSuccess:function(){c._progress_bar_container_node.remove()}});
return!1});f.observe("click",function(b){Event.stop(b);a.remove();c._progress_bar_container_node.remove()});this._progress_bar_container_node.addClassName("dimmed");a.show()}else this._progress_bar_container_node.remove(),Cookie.set("kong_progress_bar_hidden","true",1E4,"/")},hideForBlueBar:function(){this._progress_bar_container_node.hide()}};UserStatus=function(){this.initialize()};
UserStatus.prototype={initialize:function(){this.delayed_response=null;this.triggerGoogleTagDelayed()},destination:function(a){var b=$$("link[rel=destination]")[0];if(b)return b.href;if(a.destination_uri)return a.destination_uri},handleSignup:function(a){a.success?this.accountCreationSuccess(a):this.accountCreationFailure(a)},facebookSignInSuccess:function(a){active_user.isAuthenticated()&&a.new_facebook_connection?this.existingUserConnected():a.existing_user?this.setActiveUser(a):this.accountCreationSuccess(a)},
existingUserConnected:function(){new FacebookFriendFinder(function(a){try{lightbox.prototype.shutdown()}catch(b){}lightbox.prototype.initializeKongregateLightboxFromAjax("/facebook_connection/confirm",{done_class_name:0<a.friends.length?"wide":"fb_confirm_narrow",afterStaticContentLoad:function(){0<a.friends.length?a.displayFriendForm("/account"+active_user.username()+"/friends/create_many",$("facebook_friends"),function(){try{lightbox.prototype.shutdown()}catch(a){}}):$("facebook_friends_wrapper").hide();
lightbox.prototype.addOnCloseCallback(function(){active_user.isGamePage()?$$(".facebook_nav_item").invoke("hide"):window.location.reload()})}})})},accountCreationSuccess:function(a){if(a.game){active_user.setJustRegisteredOnGamePage();if(a.from_facebook){try{lightbox.prototype.shutdown()}catch(b){}lightbox.prototype.initializeKongregateLightboxFromAjax(a.full_finalize_form_facebook_connection_url,{done_class_name:"lightbox_login"});this.delayed_response=a}else this.setActiveUser(a,!0),lightbox.prototype.showConfirmation();
active_user.isGamePage()&&this.googleTagRegistration()}else if(a.from_facebook){this.delayed_response=a;try{lightbox.prototype.shutdown()}catch(f){}lightbox.prototype.initializeKongregateLightboxFromAjax(a.full_finalize_form_facebook_connection_url,{done_class_name:"lightbox_login"})}else this.setupJustRegisteredCookie(),a=this.destination(a),lightbox.prototype.showConfirmation(a)},triggerGoogleTagDelayed:function(){null!==Cookie.get("just_registered")&&(Cookie.erase("just_registered","/"),setTimeout(this.googleTagRegistration.bind(this),
0))},googleTagRegistration:function(){var a=active_user.src()?"_"+active_user.src():"";dataLayer.push({event:"registration"+a})},accountCreationFailure:function(a){"undefined"!=typeof tracking_code_service&&tracking_code_service.reportTrackingCode();a.banned?a.from_lightbox?$("lightbox_email_register").replace(a.content):window.location.href=a.banned_url:a.ip_limit_reached?a.from_lightbox?parent.lightbox_registration_form_validator.showIpLimitMessage():parent.registration_form_validator.showIpLimitMessage():
a.from_lightbox?parent.lightbox_registration_form_validator.updateErrorMessages(a.errors):a.errors&&parent.registration_form_validator.updateErrorMessages(a.errors)},sessionStatus:function(a){window.frames.secure_login_frame&&(window.frames.secure_login_frame.location.href="about:blank");if(Cookie.accept())if(a.authenticated)if(a.game)user_status.setActiveUser(a);else{try{$("welcome_box_sign_in_button").disable()}catch(b){}window.location.href=user_status.destination(a)}else if(a.ban_id)window.location.href=
a.banned_url;else if("/session/new"==window.location.pathname)window.location.href="http://"+window.location.hostname+"/session/new";else{a.from_lightbox&&$("lightboxlogin").replace(a.content);try{$("welcome_box_sign_in_button").restore()}catch(f){}try{$("sessions_new_form_spinner").restore()}catch(c){}a.native_app||active_user.activateInlineLogin()}else window.location.href="http://"+window.location.hostname+"/session/new"},finalizeCompletion:function(a){response=a&&a.response?a.response:this.delayed_response;
this.setActiveUser(response,!0);try{lightbox.prototype.shutdown()}catch(b){}lightbox.prototype.initializeKongregateLightboxFromAjax("/accounts/new/confirmation");if(!active_user.isGamePage()||!0===response.user_blocked_from_game){var f=this.destination(response);lightbox.prototype.addOnCloseCallback(function(){f?window.location.href=this.destination(response):window.location.reload()})}},finalizeFailure:function(a){$("lightbox").visible()||holodeck.isShowingSignupTab()?($j.each(a.errors,function(b){$j("#user_"+
b+"_error_block").html(a.errors[b])}),$("facebook_signup_submit_button").restore()):this.setActiveUser(this.delayed_response)},showFriendFinderForm:function(a,b){var f="/accounts/"+b.username+"/friends/create_many",c=function(){b.new_facebook_connection=!1;this.setActiveUser(b)}.bind(this);try{lightbox.prototype.shutdownWithoutCallbacks()}catch(g){}lightbox.prototype.initializeKongregateLightboxFromContent('<div id="facebook_friends"></div>',{done_class_name:"lightbox_login",afterStaticContentLoad:function(){a.displayFriendForm(f,
$("facebook_friends"),function(){try{lightbox.prototype.shutdown()}catch(a){}});lightbox.prototype.addOnCloseCallback(c)}})},setupWelcomeMessageCookie:function(a){if(a=Cookie.get("temp_flash_message"))Cookie.set(FlashMessages.COOKIE_NAME,Object.toJSON({messages:[a]})),Cookie.erase("temp_flash_message","/")},setupJustRegisteredCookie:function(){Cookie.set("just_registered","true",10,"/")},setActiveUser:function(a,b){if(a&&a.new_facebook_connection)new FacebookFriendFinder(function(c){0<c.friends.length&&
$("facebook_friends")?this.showFriendFinderForm(c,a):(a.new_facebook_connection=!1,this.setActiveUser(a,b))}.bind(this));else{try{b||CrossFrameDataStore.closeLightbox(),"undefined"!=typeof tracking_code_service&&tracking_code_service.reportTrackingCode()}catch(f){}if(!active_user.isGamePage()||!0===a.user_blocked_from_game){if(this.setupWelcomeMessageCookie(a),this.setupJustRegisteredCookie(),!b)try{this.destination(a)&&!a.from_facebook?window.location.href=this.destination(a):window.location.reload()}catch(c){window.location.reload()}}else active_user.updateAttributes(a.user_data_hash),
active_user.acceptedPrivacyPolicy()||window.location.reload(),Navigation.loadContent(Kongregate.navigationData(active_user,a.nav_data_hash)),Navigation.fixMyKong(),window.holodeck?(holodeck.switchUser(a.chat_username,a.chat_password,a.user_chat_hash,a.game_auth_token,a.user_id,!0),holodeck.closeSignupTab(),holodeck.closeSigninTab(),holodeck.rebootstrapChat(),GameMetricsUpdater.update(),a.default_nag&&holodeck.updateDefaultChatNag(a.default_nag),active_user.runCapturedFunction(),holodeck.redoPromptSavedSharedContent(),
holodeck.redoShowSharedContentsIndex(),holodeck.loadAdminControls(active_user),a.has_pending_collaborators&&holodeck.loadCollaborators(),holodeck.loadDiscussions(),holodeck.prepareAvatarTab()):(active_user.runCapturedFunction(),GameMetricsUpdater.update())}}};var user_status=new UserStatus;function WelcomeBox(a,b){this.initialize(a,b)}
WelcomeBox.prototype={initialize:function(a,b){var f=this;this._user=a;this._navigation=b;this.updateValues();a.addAttributesObserver(function(){f.updateValues()})},updateValues:function(){if(this._user.isAuthenticated()){var a=this._user.getAttributes(),b=$("welcome");this.updateFriendInfo(b);this.updatePlaylist();this.updateFavorites();var f=(new Element("img")).writeAttribute({id:"welcome_box_small_user_avatar",src:a.avatar_url,title:a.username,name:"user_avatar",alt:"Avatar for "+a.username,height:28,
width:28});b.down("span#small_avatar_placeholder").update(f);b.select(".facebook_nav_item").each(function(a){active_user.isFacebookConnected()&&a.hide()});$("mini-profile-level").writeAttribute({"class":"spritesite levelbug level_"+a.level,title:"Level "+a.level});active_user.populateUserSpecificLinks(b);b.select(".username_holder").each(function(a){a.update(active_user.username())});a=active_user.unreadShoutsCount()+active_user.unreadWhispersCount()+active_user.unreadGameMessagesCount();0<a&&($("profile_bar_messages").addClassName("alert_messages"),
$("profile_control_unread_message_count").update(a),$("profile_control_unread_message_count").addClassName("mls has_messages"),$("my-messages-link").setAttribute("title",active_user.unreadShoutsCount()+" shouts, "+active_user.unreadWhispersCount()+" whispers"),0!==active_user.unreadWhispersCount()?$("my-messages-link").setAttribute("href","/accounts/"+active_user.username()+"/private_messages"):0!==active_user.unreadGameMessagesCount()&&$("my-messages-link").setAttribute("href","/accounts/"+active_user.username()+
"/game_messages"));$("guest_user_welcome_content").hide();$("nav_welcome_box").show()}},updatePlaylist:function(){var a=this._user.playLatersCount();$$(".play-laters-count-link").each(function(b){b.title=a+" games in your playlist.";b.down(".play-laters-count").update(a)})},updateFavorites:function(){var a=this._user.favoritesCount();$$(".favorites-count-link").each(function(b){b.title=a+" favorites.";b.down(".favorites-count").update(a)})},updateFriendInfo:function(a){a.select(".friends_online_count").each(function(a){a.update(active_user.friendsOnlineCount())});
0<active_user.friendsOnlineCount()?a.select(".friends_online_link").each(function(a){a.title=active_user.friendsOnlineNames()}):a.select(".friends_online_link").each(function(a){a.title="No friends online."})}};
(function(a){function b(a){if(0!==$j(".home_feat_items:not(.changing)").length){$j(".home_feat_items").addClass("changing").addClass(a);var b=$j(".home_feat_item").length,c=$j(".home_feat_item.focus"),f=$j(c).index(),g;"prev"==a&&0!==f&&(g=$j(c).prev());"prev"==a&&0===f&&(g=$j(c).siblings().last());"next"==a&&b-1!=f&&(g=$j(c).next());"next"==a&&b-1==f&&(g=$j(c).siblings().first());g&&$j("body").hasClass("no-cssanimation")&&($j(c).removeClass("focus").fadeOut(320),$j(g).addClass("focus").fadeIn(320,
function(){$j(".home_feat_items").removeClass("changing").removeClass(a)}));g&&0!==$j("body:not(.no-cssanimation)").length&&($j(c).removeClass("focus"),$j(g).addClass("focus"),setTimeout(function(){$j(document).trigger("roller:rollComplete",[g]);$j(".home_feat_items").removeClass("changing").removeClass(a)},360))}}function f(a){37==a.keyCode&&(window.clearInterval(h),b("prev"));39==a.keyCode&&(window.clearInterval(h),b("next"))}function c(a){window.clearInterval(h);b("prev")}function g(a){window.clearInterval(h);
b("next")}var h;a.widget("kongregate.wideRoller",{stopScrolling:function(){window.clearInterval(h)},startScrolling:function(){h=setInterval(function(){b("next")},9E3)},_create:function(){$j("body").hasClass("no-cssanimation")&&($j(".home_feat_item").fadeOut(0),$j(".home_feat_item.focus").fadeIn(0));this.startScrolling();this._on({keydown:f});this._on(this.element.find(".home_feat_nav .prev"),{click:c});this._on(this.element.find(".home_feat_nav .next"),{click:g});active_user.isAuthenticated()||(this._on(this.element.find("#email"),
{focus:this.stopScrolling}),this._on(this.element.find("#email"),{blur:this.startScrolling}))}})})(jQuery);
